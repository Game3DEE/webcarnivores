{"version":3,"sources":["kaitai/C3df.js","kaitai/Vertex.js","kaitai/Face.js","kaitai/Map.js","kaitai/Rsc.js","kaitai/Car.js","kaitai/carnivores_map.js","kaitai/Ivector.js","legacy/utils.ts","legacy/hunt.ts","legacy/CPCTerrainMaterial.ts","components/Terrain.tsx","Player.tsx","components/Sky.tsx","legacy/C3DFLoader.ts","components/Scenery.tsx","legacy/CARLoader.ts","components/HUD.tsx","components/EnvSound.tsx","components/World.tsx","pages/Home.tsx","legacy/BMPLoader.js","pages/Main.tsx","components/Canvas.tsx","pages/MapEditor.tsx","pages/ModelEditor.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["root","factory","define","undefined","this","KaitaiStream","Vertex","Face","C3df","_io","_parent","_root","_read","prototype","vertCount","readU4le","faceCount","nodeCount","textureSize","faces","Array","i","vertices","nodes","Node","textureData","readBytes","name","bytesToStr","bytesTerminate","x","readF4le","y","z","owner","readS2le","hide","readU2le","Object","defineProperty","get","_m_textureWidth","_m_textureHeight","Math","floor","textureWidth","amd","module","exports","require","v1","v2","v3","tax","readS4le","tbx","tcx","tay","tby","tcy","fDoubleSide","readBitsIntLe","fDarkBack","fOpacity","fTransparent","fMortal","fPhong","fEnvmap","fNeedvc","fUnused","fDarkFront","alignToByte","dMask","distant","next","group","reserved","Map","heightMap","mapSize","readU1","textureMap1","version","textureMap2","objectMap","flagsMap","FlagsV1","FlagsV2","dawnLightMap","dayLightMap","nightLightMap","waterMap","objectHeightMap","fogsMap","ambientMap","fTexDirection","fModelDirection","fNoWay","fReverse","fWater","unused1","fTex2Direction","unused2","fWater2","_m_mapSize","_m_yScale","_m_version","size","_m_tileSize","_m_isValid","Rsc","AudioReverb","freeze","GENERIC","PLATE","FOREST","MOUNTAIN","CANYON","CAVE","SPECIAL2","UNUSED","0","1","2","3","4","5","6","7","textureCount","modelCount","dawnSkyRgb","Rgb","daySkyRgb","nightSkyRgb","dawnSkyTRgb","daySkyTRgb","nightSkyTRgb","textures","Texture","models","Model","dawnSkyTexture","skyTextureWidth","skyTextureHeight","daySkyTexture","nightSkyTexture","cloudsMap","fogCount","fogList","FogEntry","randomSoundCount","randomSounds","RandomSound","ambientSoundCount","ambientSounds","AmbientSound","waterCount","waters","Water","r","g","b","radius","yLo","yHi","lineLength","lIntensity","circleRad","cIntensity","fPlaceWater","fPlaceGround","fPlaceUser","fCircle","fBound","fNoBmp","fNoLight","fDefaultLight","fGroundLight","fNoSoft","fNoSoft2","fIsAnimated","grRad","refLight","lastAniTime","boundR","model","billboard","animation","ModelAnimation","Trd","rNumber","rVolume","rFrequency","rEnvironment","rfNotAtNight","rfUnused","vc0","vc1","vc2","kps","frameCount","frames","textureIndex","level","opacity","fogRgb","yBegin","mortal","transp","fLimit","pcmSize","pcm","rData","rsfxCount","aVolume","data","width","height","_m_width","_m_height","_m_skyTextureWidth","_m_skyTextureHeight","Ivector","Car","msc","animationCount","soundEffectCount","animations","Animation","soundEffects","SoundEffect","animSoundMap","isEof","push","pcmLength","framesPerSecond","Frame","Carnivores1Map","isV1","lightMap","isV2","_m_isV1","_m_isV2","ix","iy","iz","_m_x","_m_y","_m_z","getUS5551","texData","useAlpha","j","pixel","createTexture","Uint16Array","offset","tex","DataTexture","RGBAFormat","UnsignedShort5551Type","getLandings","map","landingList","getHeight","yScale","Vector3","tileSize","mapUrl","rscUrl","getLandH","getObjectH","getLandQHNoObj","a","max","R","hr","h","hmap","compensation","cx","cy","dx","dy","h1","h2","h3","h4","fetch","then","body","arrayBuffer","mapBuffer","rscBuffer","MAP","rsc","RSC","console","log","landings","miniMapSize","minimapData","off","tidx","length","tx","ty","miniMap","flipY","getHeightAt","CPCTerrainMaterial","vertexMap","fragmentMap","textureArray","heightmapMatrix","fog","defines","onBeforeCompile","s","uniforms","value","vs","vertexShader","replace","fs","fragmentShader","MeshBasicMaterial","Terrain","viewDistance","position","material","React","useMemo","Uint8Array","RGIntegerFormat","UnsignedByteType","internalFormat","buildVertexMap","flags","RGBIntegerFormat","buildFragmentMap","DataTexture2DArray","type","UnsignedShort565Type","format","RGBFormat","wrapT","wrapS","RepeatWrapping","createTextureArray","Matrix4","makeScale","geometry","geo","PlaneBufferGeometry","rotateX","PI","translate","controls","forward","backward","left","right","run","handleKeys","event","down","key","toLowerCase","preventDefault","Player","velocityRef","useRef","initialRef","useEffect","document","addEventListener","removeEventListener","direction","_vector","initPos","current","random","clock","Clock","useFrame","camera","delta","getDelta","velocity","copy","Number","normalize","spd","setFromMatrixColumn","matrix","addScaledVector","crossVectors","up","Sky","clipFar","ref","skyTexture","anisotropy","repeat","set","halfMapWorld","args","side","DoubleSide","C3DFLoader","url","onLoad","onProgress","onError","buffer","parse","catch","e","c3dfObject","C3DF","_parse","textureHeight","uv","forEach","f","c","BufferGeometry","setAttribute","Float32BufferAttribute","computeVertexNormals","alphaTest","transparent","Mesh","Loader","Scenery","halfTileSize","angleScale","parent","Group","matrices","matrix2","obj","fullX","fullY","makeRotationY","makeTranslation","multiply","apply","toArray","loader","mdl","count","mesh","InstancedMesh","fromArray","setMatrixAt","add","object","CARLoader","car","CAR","flatMap","morphVertices","addVert","origVIdx","u","v","frame","idx","morphAttributes","globalFrameIndex","anim","_","frIdx","attr","mat","seq","clip","AnimationClip","CreateFromMorphTargetSequence","HUD","useThree","gl","scene","virtualScene","Scene","virtualCam","dir","sph","Spherical","compass","useLoader","wind","image","getWorldDirection","setFromVector3","rotation","theta","autoClear","render","clearDepth","createPortal","OrthographicCamera","makeDefault","rotation-x","scale","rRand","siRand","EnvSound","useState","AudioListener","listener","audio","Audio","rAudio","PositionalAudio","ambNo","randomTime","ambientSound","createAudioBuffer","context","createBuffer","channelFloats","getChannelData","dv","DataView","byteOffset","getInt16","setLoop","setRefDistance","isPlaying","stop","remove","tileX","tileZ","ambSnd","error","setBuffer","setVolume","play","rBuffer","setAmbientSound","World","enableHUD","enableScenery","enableSky","enableAudio","world","setWorld","loadArea","shadows","linear","fov","near","far","Stats","PointerLockControls","Suspense","fallback","Html","center","levelNames","levelSources","Home","levelName","renderDistance","setData","onDragOver","ev","onDrop","dataTransfer","files","toUpperCase","endsWith","URL","createObjectURL","className","onUpdate","updated","indexOf","path","label","options","BMPLoader","view","getUint16","Error","fileSize","getUint32","imageDataOffset","headerSize","imageWidth","getInt32","imageHeight","colorPlanes","bitsPerPixel","compressionMethod","paletteColorCount","Uint8ClampedArray","generateMipmaps","minFilter","LinearMipmapLinearFilter","DataTextureLoader","RawLoader","areas","minX","maxX","minY","maxY","val","min","id","texToImageData","ImageData","RegisterMenu","mainOff","TGALoader","mainOn","mainMap","highlitedId","canvasRef","getContext","putImageData","style","onMouseMove","hovered","getId","clientX","clientY","prev","onMouseDown","onKeyDown","Main","Canvas","drawContent","props","canvas","fillStyle","fillRect","generateHeightmap","field","imageData","BitSelect","bitCount","onChange","parseFloat","target","fill","MapEditor","setMap","mapName","setMapName","bitR","setBitR","bitG","setBitG","bitB","setBitB","mode","setMode","getImageData","bitToColorChannel","bit","generateFlagsMap","buf","margin","userSelect","parseInt","onClick","createElement","ctx","dataImage","toDataURL","link","click","WrapperLoader","split","uri","load","useAnimations","actions","ModelViewer","modelUri","anims","OrbitControls","ModelEditor","setModelUri","App","exact","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.f37a2989.chunk.js","sourcesContent":["// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream', './Vertex', './Face'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'), require('./Vertex'), require('./Face'));\n  } else {\n    root.C3df = factory(root.KaitaiStream, root.Vertex, root.Face);\n  }\n}(typeof self !== 'undefined' ? self : this, function (KaitaiStream, Vertex, Face) {\n/**\n * @see {@link https://carnivores.fandom.com/wiki/3DF|Source}\n */\n\nvar C3df = (function() {\n  function C3df(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  C3df.prototype._read = function() {\n    this.vertCount = this._io.readU4le();\n    this.faceCount = this._io.readU4le();\n    this.nodeCount = this._io.readU4le();\n    this.textureSize = this._io.readU4le();\n    this.faces = new Array(this.faceCount);\n    for (var i = 0; i < this.faceCount; i++) {\n      this.faces[i] = new Face(this._io, this, null);\n    }\n    this.vertices = new Array(this.vertCount);\n    for (var i = 0; i < this.vertCount; i++) {\n      this.vertices[i] = new Vertex(this._io, this, null);\n    }\n    this.nodes = new Array(this.nodeCount);\n    for (var i = 0; i < this.nodeCount; i++) {\n      this.nodes[i] = new Node(this._io, this, this._root);\n    }\n    this.textureData = this._io.readBytes(this.textureSize);\n  }\n\n  var Node = C3df.Node = (function() {\n    function Node(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Node.prototype._read = function() {\n      this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(32), 0, false), \"utf8\");\n      this.x = this._io.readF4le();\n      this.y = this._io.readF4le();\n      this.z = this._io.readF4le();\n      this.owner = this._io.readS2le();\n      this.hide = this._io.readU2le();\n    }\n\n    return Node;\n  })();\n  Object.defineProperty(C3df.prototype, 'textureWidth', {\n    get: function() {\n      if (this._m_textureWidth !== undefined)\n        return this._m_textureWidth;\n      this._m_textureWidth = 256;\n      return this._m_textureWidth;\n    }\n  });\n  Object.defineProperty(C3df.prototype, 'textureHeight', {\n    get: function() {\n      if (this._m_textureHeight !== undefined)\n        return this._m_textureHeight;\n      this._m_textureHeight = Math.floor(Math.floor(this.textureSize / 2) / this.textureWidth);\n      return this._m_textureHeight;\n    }\n  });\n\n  return C3df;\n})();\nreturn C3df;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined; // IRA\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.Vertex = factory(root.KaitaiStream);\n  }\n}(this, function (KaitaiStream) {\n/**\n * @see {@link https://carnivores.fandom.com/wiki/3DF|Source}\n */\n\nvar Vertex = (function() {\n  function Vertex(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Vertex.prototype._read = function() {\n    this.x = this._io.readF4le();\n    this.y = this._io.readF4le();\n    this.z = this._io.readF4le();\n    this.owner = this._io.readS2le();\n    this.hide = this._io.readU2le();\n  }\n\n  /**\n   * bone to which vertex is attached\n   */\n\n  /**\n   * whether the vertex is hidden in Designer 2; has no effect in-game\n   */\n\n  return Vertex;\n})();\nreturn Vertex;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined; // IRA\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.Face = factory(root.KaitaiStream);\n  }\n}(this, function (KaitaiStream) {\n/**\n * @see {@link https://carnivores.fandom.com/wiki/3DF|Source}\n */\n\nvar Face = (function() {\n  function Face(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Face.prototype._read = function() {\n    this.v1 = this._io.readU4le();\n    this.v2 = this._io.readU4le();\n    this.v3 = this._io.readU4le();\n    this.tax = this._io.readS4le();\n    this.tbx = this._io.readS4le();\n    this.tcx = this._io.readS4le();\n    this.tay = this._io.readS4le();\n    this.tby = this._io.readS4le();\n    this.tcy = this._io.readS4le();\n    this.fDoubleSide = this._io.readBitsIntLe(1) != 0;\n    this.fDarkBack = this._io.readBitsIntLe(1) != 0;\n    this.fOpacity = this._io.readBitsIntLe(1) != 0;\n    this.fTransparent = this._io.readBitsIntLe(1) != 0;\n    this.fMortal = this._io.readBitsIntLe(1) != 0;\n    this.fPhong = this._io.readBitsIntLe(1) != 0;\n    this.fEnvmap = this._io.readBitsIntLe(1) != 0;\n    this.fNeedvc = this._io.readBitsIntLe(1) != 0;\n    this.fUnused = this._io.readBitsIntLe(7);\n    this.fDarkFront = this._io.readBitsIntLe(1) != 0;\n    this._io.alignToByte();\n    this.dMask = this._io.readU2le();\n    this.distant = this._io.readS4le();\n    this.next = this._io.readU4le();\n    this.group = this._io.readU4le();\n    this.reserved = this._io.readBytes(12);\n  }\n\n  /**\n   * marks face as textured on both sides\n   */\n\n  /**\n   * marks face as having a dark back side\n   */\n\n  /**\n   * marks face as transparent\n   */\n\n  /**\n   * marks face as non-solid (bullets pass through harmlessly)\n   */\n\n  /**\n   * marks face as a target zone\n   */\n\n  /**\n   * marks face as Phong mapped\n   */\n\n  /**\n   * marks face as Environment mapped\n   */\n\n  /**\n   * marks face as having a dark front side\n   */\n\n  /**\n   * appears to be unused by the games, possibly editor/tool-specific\n   */\n\n  /**\n   * purpose unknown\n   */\n\n  /**\n   * some sort of index to other faces?\n   */\n\n  /**\n   * appears to be unused by the games, possibly editor/tool-specific\n   */\n\n  /**\n   * unused; reserved for future use\n   */\n\n  return Face;\n})();\nreturn Face;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.Map = factory(root.KaitaiStream);\n  }\n}(typeof self !== 'undefined' ? self : this, function (KaitaiStream) {\n/**\n * @see {@link https://carnivores.fandom.com/wiki/Carnivores_2_MAP|Source}\n */\n\nvar Map = (function() {\n  function Map(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Map.prototype._read = function() {\n    this.heightMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      this.heightMap[i] = this._io.readU1();\n    }\n    this.textureMap1 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.version) {\n      case 1:\n        this.textureMap1[i] = this._io.readU1();\n        break;\n      case 2:\n        this.textureMap1[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.textureMap2 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.version) {\n      case 1:\n        this.textureMap2[i] = this._io.readU1();\n        break;\n      case 2:\n        this.textureMap2[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.objectMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.flagsMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.version) {\n      case 1:\n        this.flagsMap[i] = new FlagsV1(this._io, this, this._root);\n        break;\n      case 2:\n        this.flagsMap[i] = new FlagsV2(this._io, this, this._root);\n        break;\n      }\n    }\n    if (this.version == 2) {\n      this.dawnLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.dayLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    if (this.version == 2) {\n      this.nightLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.waterMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.objectHeightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.fogsMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n    this.ambientMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n  }\n\n  var FlagsV1 = Map.FlagsV1 = (function() {\n    function FlagsV1(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FlagsV1.prototype._read = function() {\n      this.fTexDirection = this._io.readBitsIntLe(2);\n      this.fModelDirection = this._io.readBitsIntLe(3);\n      this.fNoWay = this._io.readBitsIntLe(1) != 0;\n      this.fReverse = this._io.readBitsIntLe(1) != 0;\n      this.fWater = this._io.readBitsIntLe(1) != 0;\n    }\n\n    /**\n     * 0: no rotation (right-side-up)\n     * 1: rotated 90 degrees clockwise\n     * 2: rotated 180 degrees (upside-down)\n     * 3: rotated 90 degrees counter-clockwise\n     */\n\n    /**\n     * Represents an angle, fully calculated as\n     * (value * 2 * PI / 8) and used when rendering models on the tile.\n     */\n\n    /**\n     * Indicates how the cell is diagonally split among both textures\n     *   true: 2 - 1\n     *   false: 1 - 2\n     */\n\n    /**\n     * Marks the cell as having water in it, must be set for the Water Index\n     * map to have any effect.\n     */\n\n    return FlagsV1;\n  })();\n\n  var FlagsV2 = Map.FlagsV2 = (function() {\n    function FlagsV2(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FlagsV2.prototype._read = function() {\n      this.fTexDirection = this._io.readBitsIntLe(2);\n      this.fModelDirection = this._io.readBitsIntLe(2);\n      this.fReverse = this._io.readBitsIntLe(1) != 0;\n      this.fNoWay = this._io.readBitsIntLe(1) != 0;\n      this.unused1 = this._io.readBitsIntLe(1) != 0;\n      this.fWater = this._io.readBitsIntLe(1) != 0;\n      this.fTex2Direction = this._io.readBitsIntLe(2);\n      this.unused2 = this._io.readBitsIntLe(5);\n      this.fWater2 = this._io.readBitsIntLe(1) != 0;\n    }\n\n    /**\n     * 0: no rotation (right-side-up)\n     * 1: rotated 90 degrees clockwise\n     * 2: rotated 180 degrees (upside-down)\n     * 3: rotated 90 degrees counter-clockwise\n     */\n\n    /**\n     * Represents an angle, fully calculated as\n     * (value * 2 * PI / 4) and used when rendering models on the tile.\n     */\n\n    /**\n     * Indicates how the cell is diagonally split among both textures\n     *   true: 2 - 1\n     *   false: 1 - 2\n     */\n\n    return FlagsV2;\n  })();\n  Object.defineProperty(Map.prototype, 'mapSize', {\n    get: function() {\n      if (this._m_mapSize !== undefined)\n        return this._m_mapSize;\n      this._m_mapSize = (this.version * 512);\n      return this._m_mapSize;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'yScale', {\n    get: function() {\n      if (this._m_yScale !== undefined)\n        return this._m_yScale;\n      this._m_yScale = (this.version * 32);\n      return this._m_yScale;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'version', {\n    get: function() {\n      if (this._m_version !== undefined)\n        return this._m_version;\n      this._m_version = (this._io.size == 2228224 ? 1 : (this._io.size == 14155776 ? 2 : 0));\n      return this._m_version;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'tileSize', {\n    get: function() {\n      if (this._m_tileSize !== undefined)\n        return this._m_tileSize;\n      this._m_tileSize = 256;\n      return this._m_tileSize;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'isValid', {\n    get: function() {\n      if (this._m_isValid !== undefined)\n        return this._m_isValid;\n      this._m_isValid =  ((this.version == 1) || (this.version == 2)) ;\n      return this._m_isValid;\n    }\n  });\n\n  /**\n   * Terrain heightmap\n   * \n   * The terrain geometry is a `map_size`x`map_size` grid of 256x256\n   * tiles, where the integer height from the heightmap is multiplied by 32\n   * for the original Carnivores, and 64 for Carnivores 2 and Ice Age.\n   */\n\n  /**\n   * Textur map 1\n   * \n   * In the original Carnivores, this specifies the texture to on the\n   * first* triangle of a tile. For Carnivores 2 and Ice Age, the texture\n   * specified here is used for the entire tile.\n   * \n   * Triangle order (for original Carnivores):\n   * +-----+\n   * | \\ 1 |\n   * |  \\  |\n   * | 2 \\ |\n   * +-----+\n   */\n\n  /**\n   * Texture map 2\n   * \n   * In the original Carnivores, this specifies the texture of the second\n   * triangle of a tile. For Carnivores 2 and Ice Age, the texture specified\n   * here is used for a 4x4 tile in the distance (aka LOD texture).\n   */\n\n  /**\n   * Object map\n   * \n   * This map specifies if an object is placed on a tile, and if so, which\n   * one. The following values are used:\n   * \n   *   < 254: object index (see RSC file format)\n   *     254: spawn location (or trophy placement location for trophy room)\n   *     255: no object\n   */\n\n  /**\n   * Map of flags per tile. different between original and 2 / Ice Age!\n   */\n\n  /**\n   * Water heightmap\n   * Only read when the water flag is set for a tile.\n   * Specifies sea floor height.\n   */\n\n  /**\n   * Object heightmap\n   * \n   * Map of heights for tiles with objects. However, it is only used when\n   * the object flags in the RSC file specify place_user (other options there\n   * are place_ground or place_water).\n   */\n\n  /**\n   * Fog map, which areas are covered in fog in game.\n   */\n\n  /**\n   * Ambient sounds map\n   */\n\n  return Map;\n})();\nreturn Map;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream', './C3df'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'), require('./C3df'));\n  } else {\n    root.Rsc = factory(root.KaitaiStream, root.C3df);\n  }\n}(typeof self !== 'undefined' ? self : this, function (KaitaiStream, C3df) {\n/**\n * @see {@link https://www.tapatalk.com/groups/the_carnivores_saga/carnivores-2-and-ice-age-rsc-files-t2316.html|Source}\n */\n\nvar Rsc = (function() {\n  Rsc.AudioReverb = Object.freeze({\n    GENERIC: 0,\n    PLATE: 1,\n    FOREST: 2,\n    MOUNTAIN: 3,\n    CANYON: 4,\n    CAVE: 5,\n    SPECIAL2: 6,\n    UNUSED: 7,\n\n    0: \"GENERIC\",\n    1: \"PLATE\",\n    2: \"FOREST\",\n    3: \"MOUNTAIN\",\n    4: \"CANYON\",\n    5: \"CAVE\",\n    6: \"SPECIAL2\",\n    7: \"UNUSED\",\n  });\n\n  function Rsc(_io, _parent, _root, version) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n    this.version = version;\n\n    this._read();\n  }\n  Rsc.prototype._read = function() {\n    this.textureCount = this._io.readU4le();\n    this.modelCount = this._io.readU4le();\n    if (this.version == 2) {\n      this.dawnSkyRgb = new Rgb(this._io, this, this._root);\n    }\n    this.daySkyRgb = new Rgb(this._io, this, this._root);\n    if (this.version == 2) {\n      this.nightSkyRgb = new Rgb(this._io, this, this._root);\n    }\n    if (this.version == 2) {\n      this.dawnSkyTRgb = new Rgb(this._io, this, this._root);\n    }\n    this.daySkyTRgb = new Rgb(this._io, this, this._root);\n    if (this.version == 2) {\n      this.nightSkyTRgb = new Rgb(this._io, this, this._root);\n    }\n    this.textures = new Array(this.textureCount);\n    for (var i = 0; i < this.textureCount; i++) {\n      this.textures[i] = new Texture(this._io, this, this._root);\n    }\n    this.models = new Array(this.modelCount);\n    for (var i = 0; i < this.modelCount; i++) {\n      this.models[i] = new Model(this._io, this, this._root);\n    }\n    if (this.version == 2) {\n      this.dawnSkyTexture = this._io.readBytes(((this.skyTextureWidth * this.skyTextureHeight) * 2));\n    }\n    this.daySkyTexture = this._io.readBytes(((this.skyTextureWidth * this.skyTextureHeight) * 2));\n    if (this.version == 2) {\n      this.nightSkyTexture = this._io.readBytes(((this.skyTextureWidth * this.skyTextureHeight) * 2));\n    }\n    this.cloudsMap = this._io.readBytes((128 * 128));\n    this.fogCount = this._io.readU4le();\n    this.fogList = new Array(this.fogCount);\n    for (var i = 0; i < this.fogCount; i++) {\n      this.fogList[i] = new FogEntry(this._io, this, this._root);\n    }\n    this.randomSoundCount = this._io.readU4le();\n    this.randomSounds = new Array(this.randomSoundCount);\n    for (var i = 0; i < this.randomSoundCount; i++) {\n      this.randomSounds[i] = new RandomSound(this._io, this, this._root);\n    }\n    this.ambientSoundCount = this._io.readU4le();\n    this.ambientSounds = new Array(this.ambientSoundCount);\n    for (var i = 0; i < this.ambientSoundCount; i++) {\n      this.ambientSounds[i] = new AmbientSound(this._io, this, this._root);\n    }\n    if (this.version == 2) {\n      this.waterCount = this._io.readU4le();\n    }\n    if (this.version == 2) {\n      this.waters = new Array(this.waterCount);\n      for (var i = 0; i < this.waterCount; i++) {\n        this.waters[i] = new Water(this._io, this, this._root);\n      }\n    }\n  }\n\n  var Rgb = Rsc.Rgb = (function() {\n    function Rgb(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Rgb.prototype._read = function() {\n      this.r = this._io.readU4le();\n      this.g = this._io.readU4le();\n      this.b = this._io.readU4le();\n    }\n\n    return Rgb;\n  })();\n\n  var Model = Rsc.Model = (function() {\n    function Model(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Model.prototype._read = function() {\n      this.radius = this._io.readS4le();\n      this.yLo = this._io.readS4le();\n      this.yHi = this._io.readS4le();\n      this.lineLength = this._io.readS4le();\n      this.lIntensity = this._io.readS4le();\n      this.circleRad = this._io.readS4le();\n      this.cIntensity = this._io.readS4le();\n      this.fPlaceWater = this._io.readBitsIntLe(1) != 0;\n      this.fPlaceGround = this._io.readBitsIntLe(1) != 0;\n      this.fPlaceUser = this._io.readBitsIntLe(1) != 0;\n      this.fCircle = this._io.readBitsIntLe(1) != 0;\n      this.fBound = this._io.readBitsIntLe(1) != 0;\n      this.fNoBmp = this._io.readBitsIntLe(1) != 0;\n      this.fNoLight = this._io.readBitsIntLe(1) != 0;\n      this.fDefaultLight = this._io.readBitsIntLe(1) != 0;\n      this.fGroundLight = this._io.readBitsIntLe(1) != 0;\n      this.fNoSoft = this._io.readBitsIntLe(1) != 0;\n      this.fNoSoft2 = this._io.readBitsIntLe(1) != 0;\n      this.fUnused = this._io.readBitsIntLe(20);\n      this.fIsAnimated = this._io.readBitsIntLe(1) != 0;\n      this._io.alignToByte();\n      this.grRad = this._io.readS4le();\n      this.refLight = this._io.readS4le();\n      this.lastAniTime = this._io.readU4le();\n      this.boundR = this._io.readF4le();\n      this.reserved = this._io.readBytes(16);\n      this.model = new C3df(this._io, this, null);\n      if (this._root.version == 2) {\n        this.billboard = new Texture(this._io, this, this._root);\n      }\n      if (this.fIsAnimated) {\n        this.animation = new ModelAnimation(this._io, this, this._root);\n      }\n    }\n\n    return Model;\n  })();\n\n  var Trd = Rsc.Trd = (function() {\n    function Trd(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Trd.prototype._read = function() {\n      this.rNumber = this._io.readU4le();\n      this.rVolume = this._io.readU4le();\n      this.rFrequency = this._io.readU4le();\n      this.rEnvironment = this._io.readU2le();\n      this.rfNotAtNight = this._io.readBitsIntLe(1) != 0;\n      this.rfUnused = this._io.readBitsIntLe(15);\n    }\n\n    /**\n     * if set, sound does not play at night\n     */\n\n    return Trd;\n  })();\n\n  var ModelAnimation = Rsc.ModelAnimation = (function() {\n    function ModelAnimation(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    ModelAnimation.prototype._read = function() {\n      this.vc0 = this._io.readU4le();\n      this.vc1 = this._io.readU4le();\n      this.vc2 = this._io.readU4le();\n      this.kps = this._io.readU4le();\n      this.frameCount = this._io.readU4le();\n      this.frames = new Array(((this.frameCount * 3) * this.vc1));\n      for (var i = 0; i < ((this.frameCount * 3) * this.vc1); i++) {\n        this.frames[i] = this._io.readS2le();\n      }\n    }\n\n    return ModelAnimation;\n  })();\n\n  var Water = Rsc.Water = (function() {\n    function Water(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Water.prototype._read = function() {\n      this.textureIndex = this._io.readU4le();\n      this.level = this._io.readU4le();\n      this.opacity = this._io.readF4le();\n      this.fogRgb = this._io.readU4le();\n    }\n\n    return Water;\n  })();\n\n  var FogEntry = Rsc.FogEntry = (function() {\n    function FogEntry(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FogEntry.prototype._read = function() {\n      this.fogRgb = this._io.readU4le();\n      this.yBegin = this._io.readF4le();\n      this.mortal = this._io.readU4le();\n      this.transp = this._io.readF4le();\n      this.fLimit = this._io.readF4le();\n    }\n\n    return FogEntry;\n  })();\n\n  var AmbientSound = Rsc.AmbientSound = (function() {\n    function AmbientSound(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    AmbientSound.prototype._read = function() {\n      this.pcmSize = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmSize);\n      this.rData = new Array(16);\n      for (var i = 0; i < 16; i++) {\n        this.rData[i] = new Trd(this._io, this, this._root);\n      }\n      this.rsfxCount = this._io.readU4le();\n      this.aVolume = this._io.readU4le();\n    }\n\n    return AmbientSound;\n  })();\n\n  var RandomSound = Rsc.RandomSound = (function() {\n    function RandomSound(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    RandomSound.prototype._read = function() {\n      this.pcmSize = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmSize);\n    }\n\n    return RandomSound;\n  })();\n\n  var Texture = Rsc.Texture = (function() {\n    function Texture(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Texture.prototype._read = function() {\n      this.data = this._io.readBytes(((this.width * this.height) * 2));\n    }\n    Object.defineProperty(Texture.prototype, 'width', {\n      get: function() {\n        if (this._m_width !== undefined)\n          return this._m_width;\n        this._m_width = 128;\n        return this._m_width;\n      }\n    });\n    Object.defineProperty(Texture.prototype, 'height', {\n      get: function() {\n        if (this._m_height !== undefined)\n          return this._m_height;\n        this._m_height = 128;\n        return this._m_height;\n      }\n    });\n\n    /**\n     * raw RGBA5551 bitmap data\n     */\n\n    return Texture;\n  })();\n  Object.defineProperty(Rsc.prototype, 'skyTextureWidth', {\n    get: function() {\n      if (this._m_skyTextureWidth !== undefined)\n        return this._m_skyTextureWidth;\n      this._m_skyTextureWidth = 256;\n      return this._m_skyTextureWidth;\n    }\n  });\n  Object.defineProperty(Rsc.prototype, 'skyTextureHeight', {\n    get: function() {\n      if (this._m_skyTextureHeight !== undefined)\n        return this._m_skyTextureHeight;\n      this._m_skyTextureHeight = 256;\n      return this._m_skyTextureHeight;\n    }\n  });\n\n  return Rsc;\n})();\nreturn Rsc;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\n\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream', './Vertex', './Face', './Ivector'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'), require('./Vertex'), require('./Face'), require('./Ivector'));\n  } else {\n    root.Car = factory(root.KaitaiStream, root.Vertex, root.Face, root.Ivector);\n  }\n}(this, function (KaitaiStream, Vertex, Face, Ivector) {\n/**\n * @see {@link https://carnivores.fandom.com/wiki/CAR|Source}\n */\n\nvar Car = (function() {\n  function Car(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Car.prototype._read = function() {\n    this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(24), 0, false), \"utf8\");\n    this.msc = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(8), 0, false), \"utf8\");\n    this.animationCount = this._io.readU4le();\n    this.soundEffectCount = this._io.readU4le();\n    this.vertCount = this._io.readU4le();\n    this.faceCount = this._io.readU4le();\n    this.textureSize = this._io.readU4le();\n    this.faces = new Array(this.faceCount);\n    for (var i = 0; i < this.faceCount; i++) {\n      this.faces[i] = new Face(this._io, this, null);\n    }\n    this.vertices = new Array(this.vertCount);\n    for (var i = 0; i < this.vertCount; i++) {\n      this.vertices[i] = new Vertex(this._io, this, null);\n    }\n    this.textureData = this._io.readBytes(this.textureSize);\n    this.animations = new Array(this.animationCount);\n    for (var i = 0; i < this.animationCount; i++) {\n      this.animations[i] = new Animation(this._io, this, this._root);\n    }\n    this.soundEffects = new Array(this.soundEffectCount);\n    for (var i = 0; i < this.soundEffectCount; i++) {\n      this.soundEffects[i] = new SoundEffect(this._io, this, this._root);\n    }\n    this.animSoundMap = [];\n    var i = 0;\n    while (!this._io.isEof()) {\n      this.animSoundMap.push(this._io.readS4le());\n      i++;\n    }\n  }\n\n  var SoundEffect = Car.SoundEffect = (function() {\n    function SoundEffect(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    SoundEffect.prototype._read = function() {\n      this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(32), 0, false), \"utf8\");\n      this.pcmLength = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmLength);\n    }\n\n    return SoundEffect;\n  })();\n\n  var Animation = Car.Animation = (function() {\n    function Animation(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Animation.prototype._read = function() {\n      this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(32), 0, false), \"utf8\");\n      this.framesPerSecond = this._io.readU4le();\n      this.frameCount = this._io.readU4le();\n      this.frames = new Array(this.frameCount);\n      for (var i = 0; i < this.frameCount; i++) {\n        this.frames[i] = new Frame(this._io, this, this._root);\n      }\n    }\n\n    return Animation;\n  })();\n\n  var Frame = Car.Frame = (function() {\n    function Frame(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Frame.prototype._read = function() {\n      this.vertices = new Array(this._root.vertCount);\n      for (var i = 0; i < this._root.vertCount; i++) {\n        this.vertices[i] = new Ivector(this._io, this, null);\n      }\n    }\n\n    return Frame;\n  })();\n\n  /**\n   * width of texture in pixels\n   */\n  Object.defineProperty(Car.prototype, 'textureWidth', {\n    get: function() {\n      if (this._m_textureWidth !== undefined)\n        return this._m_textureWidth;\n      this._m_textureWidth = 256;\n      return this._m_textureWidth;\n    }\n  });\n\n  /**\n   * height of texture in pixels\n   */\n  Object.defineProperty(Car.prototype, 'textureHeight', {\n    get: function() {\n      if (this._m_textureHeight !== undefined)\n        return this._m_textureHeight;\n      this._m_textureHeight = Math.floor(Math.floor(this.textureSize / 2) / this.textureWidth);\n      return this._m_textureHeight;\n    }\n  });\n\n  /**\n   * Name of model\n   */\n\n  /**\n   * some revision string? always msc: <number>\n   */\n\n  /**\n   * Texture data in RGBA5551 format\n   */\n\n  /**\n   * mapping of animation (index) to sound (value)\n   */\n\n  return Car;\n})();\nreturn Car;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\n/* eslint-disable */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.Carnivores1Map = factory(root.KaitaiStream);\n  }\n}(this, function (KaitaiStream) {\nvar Carnivores1Map = (function() {\n  function Carnivores1Map(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Carnivores1Map.prototype._read = function() {\n    this.heightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.textureMap1 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.textureMap1[i] = this._io.readU1();\n        break;\n      case false:\n        this.textureMap1[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.textureMap2 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.textureMap2[i] = this._io.readU1();\n        break;\n      case false:\n        this.textureMap2[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.objectMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.flagsMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.flagsMap[i] = this._io.readU1();\n        break;\n      case false:\n        this.flagsMap[i] = this._io.readU2le();\n        break;\n      }\n    }\n    if (this.isV1) {\n      this.lightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.dawnLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.dayLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.nightLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.waterMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.objectHeightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.fogsMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n    this.ambientMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n  }\n  Object.defineProperty(Carnivores1Map.prototype, 'isV1', {\n    get: function() {\n      if (this._m_isV1 !== undefined)\n        return this._m_isV1;\n      this._m_isV1 = this._io.size == 2228224;\n      return this._m_isV1;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'isV2', {\n    get: function() {\n      if (this._m_isV2 !== undefined)\n        return this._m_isV2;\n      this._m_isV2 = this._io.size == 14155776;\n      return this._m_isV2;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'isValid', {\n    get: function() {\n      if (this._m_isValid !== undefined)\n        return this._m_isValid;\n      this._m_isValid =  ((this.isV1) || (this.isV2)) ;\n      return this._m_isValid;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'mapSize', {\n    get: function() {\n      if (this._m_mapSize !== undefined)\n        return this._m_mapSize;\n      this._m_mapSize = (this.isV1 ? 512 : 1024);\n      return this._m_mapSize;\n    }\n  });\n\n  /**\n   * Terrain heightmap, for water tiles it specifies the water surface height\n   */\n\n  /**\n   * Terrain texture map, every byte specifies a texture index for the terrain\n   */\n\n  /**\n   * Object placement map, every byte specifies an object (< 254), a spawn location (254), or no model (255)\n   */\n\n  /**\n   * Flags map, specifies render flags per tile. This includes rotation of terrain texture, of object, and more.\n   */\n\n  /**\n   * Light map, specifies lighting of placed objects\n   */\n\n  /**\n   * Water heightmap, specifies \"sea floor\" terrain heights\n   */\n\n  /**\n   * Object heightmap, height placement of objects (flags map can specify to align to sea floor level or terrain ground level too)\n   */\n\n  /**\n   * Fog map, which areas are covered in fog in game.\n   */\n\n  /**\n   * Ambient sounds map\n   */\n\n  return Carnivores1Map;\n})();\nreturn Carnivores1Map;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n      define(['kaitai-struct/KaitaiStream'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n      module.exports = factory(require('kaitai-struct/KaitaiStream'));\n    } else {\n      root.Ivector = factory(root.KaitaiStream);\n    }\n  }(this, function (KaitaiStream) {\n  var Ivector = (function() {\n    function Ivector(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n  \n      this._read();\n    }\n    Ivector.prototype._read = function() {\n      this.ix = this._io.readS2le();\n      this.iy = this._io.readS2le();\n      this.iz = this._io.readS2le();\n    }\n    Object.defineProperty(Ivector.prototype, 'x', {\n      get: function() {\n        if (this._m_x !== undefined)\n          return this._m_x;\n        this._m_x = (this.ix / 16.0);\n        return this._m_x;\n      }\n    });\n    Object.defineProperty(Ivector.prototype, 'y', {\n      get: function() {\n        if (this._m_y !== undefined)\n          return this._m_y;\n        this._m_y = (this.iy / 16.0);\n        return this._m_y;\n      }\n    });\n    Object.defineProperty(Ivector.prototype, 'z', {\n      get: function() {\n        if (this._m_z !== undefined)\n          return this._m_z;\n        this._m_z = (this.iz / 16.0);\n        return this._m_z;\n      }\n    });\n  \n    return Ivector;\n  })();\n  return Ivector;\n  }));\n  ","import { DataTexture, RGBAFormat, UnsignedShort5551Type } from \"three\";\n\nexport function getUS5551(x: number, y: number, texData: Uint8Array, width: number, useAlpha: boolean) {\n  const j = y * width + x;\n  let pixel = (texData[j*2+1] << 8) | texData[j*2];\n  let r = ((pixel >>> 10) & 0x1f);\n  let g = ((pixel >>>  5) & 0x1f);\n  let b = ((pixel >>>  0) & 0x1f);\n  let a = useAlpha ? (pixel ? 1 : 0) : 1;\n  return (r << 11) + (g << 6) + (b << 1) | a;\n}\n\nexport function createTexture(texData: Uint8Array, width: number, height: number, useAlpha: boolean = true) {\n    let data = new Uint16Array(width * height);\n    let offset = 0;\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        data[offset++] = getUS5551(x, y, texData, width, useAlpha);\n      }\n    }\n  \n    const tex = new DataTexture(\n        data, width, height,\n        RGBAFormat, UnsignedShort5551Type,\n    );\n    return tex;\n  }\n","// Legacy file, feel free to move code out.\n// It should turn into CPC(Load).ts, only\n// handling loading the MAP/RSC file and\n// compensating for any C1/C2 differences\n// where necessary.\nimport KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport {\n    DataTexture,\n    RGBAFormat,\n    UnsignedShort5551Type,\n    Vector3,\n} from 'three';\n\nimport MAP from '../kaitai/Map';\nimport RSC from '../kaitai/Rsc';\nimport { getUS5551 } from './utils';\n\nfunction getLandings(map: any) {\n\n    const mapSize = map.mapSize;\n    const landingList: Vector3[] = [];\n\n    function getHeight(x: number, y: number) {\n        return map.heightMap[y * map.mapSize + x] * map.yScale;\n    }\n\n    for (let y = 0; y < mapSize; y++) {\n        for (let x = 0; x < mapSize; x++) {\n            const obj = map.objectMap[y * mapSize + x];\n            if (obj === 254) {\n                // Landing list\n                landingList.push(\n                    new Vector3(\n                        x * map.tileSize,\n                        getHeight(x, y),\n                        y * map.tileSize    \n                    )\n                );\n            }\n        }\n    }\n\n    return landingList;\n}\n\nexport async function loadArea(mapUrl: string, rscUrl: string) {\n    const mapBuffer = await fetch(mapUrl).then(body => body.arrayBuffer());\n    const rscBuffer = await fetch(rscUrl).then(body => body.arrayBuffer());\n\n    const map = new MAP(new KaitaiStream(mapBuffer));\n    const rsc = new RSC(new KaitaiStream(rscBuffer), undefined, undefined, map.version);\n    console.log(rsc, map)\n\n/* WIP\n    if (map.version == 1) {\n        // Carnivores (1) map, fixup water related map data\n        // XXX TODO create C2-style water table & map!\n        const size = map.mapSize * map.mapSize;\n        for (let i = 0; i < size; i++) {\n            if (map.flagsMap![i].fWater) {\n                // Set heightmap to waterfloor level\n                //map.heightMap![i] = map.waterMap![i];\n                // Map POOL texture (0) to SAND texture (1)\n                if (map.textureMap1![i] == 0) {\n                    map.textureMap1![i] = 1;\n                }\n                if (map.textureMap2![i] == 0) {\n                    map.textureMap2![i] = 1;\n                }\n            }\n        }\n    }\n    */\n\n    const landings = getLandings(map);\n\n    const miniMapSize = map.mapSize / 2;\n    const minimapData = new Uint16Array(miniMapSize * miniMapSize);\n    let off = 0;\n    let tx, ty;\n    for (let y = 0; y < miniMapSize; y++) {\n        for (let x = 0; x < miniMapSize; x++) {\n            let tidx = map.textureMap1![(y * 2 * map.mapSize) + x * 2];\n            if (tidx > rsc.textures!.length) tidx = 1; // XXX invalid textures in texmap!\n            // Use more detail for water tiles\n            tx = tidx === 0 ? (x & 31) * 4 : (x & 15) * 8;\n            ty = tidx === 0 ? (y & 31) * 4 : (y & 15) * 8;\n            const tex = rsc.textures![tidx];\n            minimapData[off++] = getUS5551(tx, ty, tex.data, tex.width, false);\n        }\n    }\n\n    const miniMap = new DataTexture(minimapData, miniMapSize, miniMapSize, RGBAFormat, UnsignedShort5551Type);\n    miniMap.flipY = true; // keep (0,0) in the top left, game expects it\n\n    function getLandH(x: number, z: number) {\n        const { tileSize, mapSize } = map;\n\n        // XXX problem for C1/C2 compatibility!\n        // C1: waterMap has water \"floor\" heights, while heightmap has water \"level\" heights\n        // C2: heightMap has water \"floor\" heights, waterMap contains indices into water table\n        //     specifying water levels.\n        const hmap = map.version === 1 ? 'waterMap' : 'heightMap';\n        const compensation = map.version === 1 ? 48 : 0;\n\n        if (x < 0) x = 0;\n        if (z < 0) z = 0;\n\n        const cx = Math.floor(x / tileSize);\n        const cy = Math.floor(z / tileSize);\n        const dx = Math.floor(x % tileSize);\n        const dy = Math.floor(z % tileSize);\n     \n        let h1 = map[hmap]![cy * mapSize + cx];\n        let h2 = map[hmap]![cy * mapSize + cx +1];\n        let h3 = map[hmap]![(cy + 1) * mapSize + cx +1];\n        let h4 = map[hmap]![(cy + 1) * mapSize + cx];\n\n        if (map.flagsMap![cy * mapSize + cx].fReverse) {\n            if (256 - dx > dy)\n                h3 = h2 + h4 - h1;\n            else\n                h1 = h2 + h4 - h3;\n        } else {\n            if (dx > dy) {\n                h4 = h1 + h3 - h2;\n            } else {\n                h2 = h1 + h3 - h4;\n            }\n        }\n     \n        let h = \n            (h1 * (256 - dx) + h2 * dx) * (256 - dy) +\n            (h4 * (256 - dx) + h3 * dx) * dy;\n     \n        return  (h / 256 / 256 - compensation) * map.yScale;\n    }\n\n    function getObjectH(x: number, y: number, R: number) {\n        x = (x * map.tileSize) + map.tileSize / 2;\n        y = (y * map.tileSize) + map.tileSize / 2;\n\n        let hr, h;\n        hr = getLandH(x,   y  );\n        h  = getLandH(x+R, y  ); if (h < hr) hr = h;\n        h  = getLandH(x-R, y  ); if (h < hr) hr = h;\n        h  = getLandH(x,   y+R); if (h < hr) hr = h;\n        h  = getLandH(x,   y-R); if (h < hr) hr = h;\n        hr += 15;\n\n        return  Math.floor(hr / map.yScale + 48);\n    }\n\n    function getLandQHNoObj(x: number, z: number) {  \n        return Math.max(\n            getLandH(x, z),\n            getLandH(x-90, z-90),\n            getLandH(x+90, z-90),\n            getLandH(x-90, z+90),\n            getLandH(x+90, z+90),\n         \n            getLandH(x+128, z),\n            getLandH(x-128, z),\n            getLandH(x, z+128),\n            getLandH(x, z-128),\n        );\n    }\n\n    return {\n        map,\n        rsc,\n        landings,\n        miniMap,\n        getHeightAt: getLandQHNoObj,\n        getLandQHNoObj,\n        getLandH,\n        getObjectH,\n    };\n}\n","import { DataTexture, DataTexture2DArray, Matrix4, MeshBasicMaterial } from \"three\";\n\ninterface CPCTerrainMaterialProps {\n    vertexMap: DataTexture; // integer DataTexture containing heightmap, lightmap\n    fragmentMap: DataTexture; // integer DataTexture containing texturemap{1,2}, flagmap\n    textureArray: DataTexture2DArray, // DataTexture array with terrain textures\n    mapSize: number; // size of map in tiles, e.g. 512 for C1, 1024 for C2/IA\n    version: number; // version 1 for C1, 2 for C2/IA\n    yScale: number; // y scaling of heights, 32 for C1, 64 for C2\n    heightmapMatrix: Matrix4; // transformation from world coordinates of map to uv\n}\n\n// CarnivoresPCTerrainMaterial\nexport default class CPCTerrainMaterial extends MeshBasicMaterial {\n    constructor({ vertexMap, fragmentMap, mapSize, version, yScale, textureArray, heightmapMatrix }: CPCTerrainMaterialProps) {\n        super({\n            map: textureArray,\n            fog: true, // for future use\n        });\n\n        this.defines = {\n            'MAP_SIZE': `${mapSize}.0`,\n            'CARNIVORES': version,\n            'MAP_HSCALE': `${yScale}.0`,\n        };\n        this.onBeforeCompile = s => {\n            // Create our (integer) data textures for\n            // fragment and vertex shader\n            s.uniforms['vertexMap'] = { value: vertexMap, };\n            s.uniforms['fragmentMap'] = { value: fragmentMap, };\n            s.uniforms['heightmapMatrix'] = { value: heightmapMatrix, };\n    \n            // Adjust vertex shader\n            let vs = s.vertexShader;\n            vs = vs.replace('#include <common>', `\n                precision highp usampler2D;\n                uniform usampler2D vertexMap;\n                uniform mat4 heightmapMatrix;\n                varying vec4 vLighting;\n                #include <common>\n            `)\n            vs = vs.replace('#include <color_vertex>', `\n            vUv = (heightmapMatrix * modelMatrix * vec4(position, 1.0)).xz;\n            uvec4 tex = texture(vertexMap, vUv);\n            #if CARNIVORES == 1\n            float light = 1.0 - (float(tex.g) / 64.0);\n            #else\n            float light = float(tex.g) / 255.0;\n            #endif\n            vLighting = vec4(light, light, light, 1.0);\n            #include <color_vertex>\n            `)\n            vs = vs.replace('#include <begin_vertex>', `\n            #include <begin_vertex>\n            transformed.y += float(tex.r) * MAP_HSCALE;\n            `)\n            s.vertexShader = vs;\n\n            // Adjust the fragment shader\n            let fs = s.fragmentShader;\n            fs = fs.replace('#include <map_pars_fragment>', `\n            precision highp sampler2DArray;\n            precision highp usampler2D;\n            uniform sampler2DArray map;\n            uniform usampler2D fragmentMap;\n            varying vec4 vLighting;\n\n            vec2 rotateUV(vec2 uv, uint rot) {\n#if 0\n                switch(rot) {\n                    case 0u:\n                        //diffuseColor = vec4(1.0, 1.0, 1.0, 1.0);\n                        break;\n                    case 1u:\n                        float t = uv.x;\n                        uv.x = uv.y;\n                        uv.y = 1.0 - t;\n                        //diffuseColor = vec4(0.5, 0.0, 0.0, 1.0);\n                        break;\n                    case 2u:\n                        uv.x = 1.0 - uv.x;\n                        uv.y = 1.0 - uv.y;\n                        //diffuseColor = vec4(0.5, 0.5, 0.0, 1.0);\n                        break;\n                    case 3u:\n                        float x = uv.x;\n                        uv.x = 1.0 - uv.y;\n                        uv.y = x;\n                        //diffuseColor = vec4(0.0, 0.0, 1.0, 1.0);\n                    break;\n                }\n#else                \n                float mid = 0.5;\n                float rotation = float(rot);\n                float cos_ = cos(PI / 2. * rotation);\n                float sin_ = sin(PI / 2. * rotation);\n                return vec2(\n                    cos_ * (uv.x - mid) + sin_ * (uv.y - mid) + mid,\n                    cos_ * (uv.y - mid) - sin_ * (uv.x - mid) + mid\n                );\n#endif\n            }\n            `);\n            fs = fs.replace('#include <map_fragment>', `\n            vec2 tilePos = vUv * MAP_SIZE;\n            vec2 localTileUv = tilePos - floor(tilePos);\n            uvec4 tex = texture(fragmentMap, vUv);\n            diffuseColor = vLighting;\n            localTileUv = rotateUV(localTileUv, tex.b & 3u);\n            uint depth = tex.r;\n            #if CARNIVORES == 1\n            float triside = ((1.0-localTileUv.x) - localTileUv.y);\n            if (triside >= 0.0) {\n                depth = (tex.b & 64u) != 0u ? tex.r : tex.g;\n            } else {\n                depth = (tex.b & 64u) != 0u ? tex.g : tex.r;\n            }\n            #endif\n            #ifdef DEBUG_REVERSE_FLAG\n            if ((tex.b & 64u) != 0u) {\n                diffuseColor = vec4(0.6, 0.6, 0.6, 1.0);\n            } else {\n                diffuseColor = vec4(1.0, 1.0, 1.0, 1.0);\n            }\n            #endif\n            vec4 texelColor = texture( map, vec3(localTileUv, depth) );\n            texelColor = mapTexelToLinear( texelColor );\n            diffuseColor *= texelColor;\n            //diffuseColor = vec4(localTileUv, 0.0, 1.0);\n            `)\n            s.fragmentShader = fs;\n        }\n    \n    }\n}","import { Vector3 } from \"@react-three/fiber\";\nimport React from \"react\";\nimport {\n    DataTexture,\n    DataTexture2DArray,\n    Matrix4,\n    PlaneBufferGeometry,\n    RepeatWrapping,\n    RGBFormat,\n    RGBIntegerFormat,\n    RGIntegerFormat,\n    UnsignedByteType,\n    UnsignedShort565Type\n} from \"three\";\nimport CPCTerrainMaterial from \"../legacy/CPCTerrainMaterial\";\n\nfunction buildVertexMap(map: any) {\n    const numChannels = 2;\n    const data = new Uint8Array(map.mapSize * map.mapSize * numChannels);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        data[i*numChannels+0] = map.heightMap[i]; // R\n        data[i*numChannels+1] = map.dayLightMap[i]; // G\n    }\n    let tex = new DataTexture(data, map.mapSize, map.mapSize, RGIntegerFormat, UnsignedByteType);\n    tex.internalFormat = 'RG8UI';\n    return tex;\n}\n\nfunction buildFragmentMap(map: any) {\n    const numChannels = 3;\n    const data = new Uint8Array(map.mapSize * map.mapSize * numChannels);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        const flags = map.flagsMap[i];\n        data[i*numChannels+0] = map.textureMap1[i]; // R\n        data[i*numChannels+1] = map.textureMap2[i]; // G\n        data[i*numChannels+2] = flags.fTexDirection | (flags.fReverse << 6); // B\n    }\n    let tex = new DataTexture(data, map.mapSize, map.mapSize, RGBIntegerFormat, UnsignedByteType);\n    tex.internalFormat = 'RGB8UI';\n    return tex;\n}\n\nfunction createTextureArray(rsc: any) {\n    // create data array\n    const data = new Uint16Array(rsc.textureCount * rsc.textures[0].width * rsc.textures[0].height);\n\n    // copy texture data\n    let offset = 0;\n    for (let i = 0; i < rsc.textureCount; i++) {\n        for (let j = 0; j < rsc.textures[0].width * rsc.textures[0].height; j++) {\n            // read RGBA5551...\n            let pixel = (rsc.textures[i].data[j*2+1] << 8) | rsc.textures[i].data[j*2];\n            let r = (pixel >> 10) & 0x1f;\n            let g = ((pixel >>  5) & 0x1f) << 1;\n            let b = (pixel >>  0) & 0x1f;\n            // write RGB565 (since we do not need transparency here)\n            data[offset++] = (r << 11) + (g << 5) + b;\n        }\n    }\n\n    let tex = new DataTexture2DArray(data, rsc.textures[0].width, rsc.textures[0].height, rsc.textureCount);\n    tex.type = UnsignedShort565Type;\n    tex.format = RGBFormat;\n    tex.wrapT = tex.wrapS = RepeatWrapping;\n    return tex;\n}\n\ninterface Props {\n    rsc: any;\n    map: any;\n    viewDistance?: number; // view distance in tiles\n    position?: Vector3; // location in world space\n}\n\nfunction Terrain({\n    rsc, map,\n    viewDistance = map.mapSize / 2,\n    position = [ 0,0,0 ],\n}: Props) {\n    const material = React.useMemo(() => {\n        const { mapSize, version, yScale } = map;\n        const vertexMap = buildVertexMap(map);\n        const fragmentMap = buildFragmentMap(map);\n        \n        const textureArray = createTextureArray(rsc);\n\n        // World coordinates to uv transform (TODO investigate uvScaleMap/uvTransform?)\n        const heightmapMatrix = new Matrix4().makeScale(\n            1 / (map.mapSize * map.tileSize),\n            1,\n            1 / (map.mapSize * map.tileSize),\n        );\n        return new CPCTerrainMaterial({\n            vertexMap,\n            fragmentMap,\n            mapSize,\n            version,\n            yScale,\n            textureArray,\n            heightmapMatrix,\n        });\n    }, [map, rsc])\n\n    const geometry = React.useMemo(() => {\n        let geo = new PlaneBufferGeometry(\n            map.mapSize * map.tileSize, map.mapSize * map.tileSize,\n            map.mapSize - 1, map.mapSize - 1\n        );\n        // Lay it flat\n        geo.rotateX(-Math.PI / 2);\n        // and make it start at (0,0)\n        geo.translate(\n            map.mapSize * map.tileSize / 2,\n            0,\n            map.mapSize * map.tileSize / 2\n        );\n        return geo;\n    }, [/*viewDistance, */map.mapSize, map.tileSize]);\n\n    return (\n        <mesh position={position} geometry={geometry} material={material} />\n    )\n}\n\nexport default Terrain;\n","import React from 'react'\n\nimport { useFrame } from '@react-three/fiber';\nimport { Clock, Vector3 } from 'three';\n\nconst controls = {\n    forward: false,\n    backward: false,\n    left: false,\n    right: false,\n    run: false,\n}\n\nfunction handleKeys(event: KeyboardEvent) {\n    const down = event.type === 'keydown';\n    switch(event.key.toLowerCase()) {\n        case 'w': controls.forward = down; break;\n        case 's': controls.backward = down; break;\n        case 'a': controls.left = down; break;\n        case 'd': controls.right = down; break;\n        case 'shift': controls.run = down; break;\n        default: console.log(event.key, down); return;\n    }\n\n    event.preventDefault();\n}\n\ninterface Props {\n    getHeightAt: (x: number, z: number) => number;\n    landings: Vector3[];\n}\n\nexport default function Player({ getHeightAt, landings }: Props) {\n    const velocityRef = React.useRef(new Vector3());\n    const initialRef = React.useRef(true);\n    React.useEffect(() => {\n        document.addEventListener('keydown', handleKeys);\n        document.addEventListener('keyup', handleKeys);\n        return () => {\n            document.removeEventListener('keydown', handleKeys);\n            document.removeEventListener('keyup', handleKeys);\n        }\n    })\n\n    const direction = new Vector3();\n    const _vector = new Vector3();\n\n    const initPos = React.useMemo(\n        () => {\n            initialRef.current = true;\n            return landings[Math.floor(landings.length * Math.random())];\n        },\n        [landings]\n    );\n\n    const velocityDrag = 10.0;\n    const mass = 100.0;\n    const gravity = 9.8;\n    const speed = 7000.0;\n    const eyeHeight = 220;\n    const clock  = new Clock();\n\n    useFrame(({ camera }) => {\n        let delta = clock.getDelta();\n\n        const velocity = velocityRef.current;\n\n        if (initialRef.current) {\n            camera.position.copy(initPos);\n            initialRef.current = false;\n        }\n\n        velocity.x -= velocity.x * velocityDrag * delta;\n        velocity.z -= velocity.z * velocityDrag * delta;\n\n        velocity.y -= gravity * mass * delta;\n\n        direction.z = Number( controls.forward ) - Number( controls.backward );\n        direction.x = Number( controls.right ) - Number( controls.left );\n        direction.normalize(); // this ensures consistent movements in all directions\n\n        const spd = speed * (controls.run ? 4 : 1);\n        if ( controls.forward || controls.backward ) velocity.z -= direction.z * spd * delta;\n        if ( controls.left || controls.right ) velocity.x -= direction.x * spd * delta;\n\n        // move right\n        _vector.setFromMatrixColumn( camera.matrix, 0 );\n        camera.position.addScaledVector( _vector, - velocity.x * delta );\n\n        // move forward\n        _vector.setFromMatrixColumn( camera.matrix, 0 );\n        _vector.crossVectors( camera.up, _vector );\n        camera.position.addScaledVector( _vector, -velocity.z * delta );\n\n        // move down\n        camera.position.y += ( velocity.y * delta );\n\n        const height = getHeightAt(camera.position.x, camera.position.z);\n        if ( camera.position.y < height + eyeHeight ) {\n\n            velocity.y = 0;\n            camera.position.y = height + eyeHeight;\n\n            //onGround = true;\n        }\n    })\n\n    return null\n}\n","import { useFrame } from '@react-three/fiber';\nimport React from 'react';\nimport { DoubleSide, Mesh, RepeatWrapping } from 'three';\nimport { createTexture } from '../legacy/utils';\n\ninterface Props {\n    rsc: any;\n    map: any;\n    clipFar: number;\n}\n\nfunction Sky({ map, rsc, clipFar }: Props) {\n    const ref = React.useRef<Mesh>();\n    const skyTexture = React.useMemo(() => {\n        let tex = createTexture(rsc.daySkyTexture, rsc.skyTextureWidth, rsc.skyTextureHeight);\n        tex.wrapS = tex.wrapT = RepeatWrapping;\n        tex.anisotropy = 16;\n        tex.repeat.set(10, 10);\n        return tex;\n    }, [rsc]);\n\n    const halfMapWorld = map.mapSize * map.tileSize / 2;\n\n    useFrame(({ camera }) => {\n        skyTexture.offset.x += 0.0002;\n        ref.current?.position.set(camera.position.x, 0, camera.position.z);\n    })\n\n    return (\n        <mesh ref={ref} position={[halfMapWorld,0,halfMapWorld]}>\n            <sphereBufferGeometry args={[clipFar-(clipFar / 100)]} />\n            <meshBasicMaterial map={skyTexture} side={DoubleSide} fog={false} />\n        </mesh>\n    )\n}\n\nexport default Sky;\n","import {\n    BufferGeometry,\n    DoubleSide,\n    Float32BufferAttribute,\n    Loader,\n    Mesh,\n    MeshBasicMaterial,\n} from 'three'\n\nimport C3DF from '../kaitai/C3df';\nimport KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport { createTexture } from './utils';\n\nexport default class C3DFLoader extends Loader {\n    load(\n        url: string,\n        onLoad: (character: Mesh) => void,\n        onProgress: (event: ProgressEvent) => void, // XXX no progress support yet\n        onError: (event: Error | ErrorEvent ) => void,\n     ) {\n         fetch(url).then(body => body.arrayBuffer()).then(buffer => {\n             onLoad( this.parse(buffer) );\n         }).catch(e => {\n             onError(e);\n         })\n    }\n\n    parse(buffer: ArrayBuffer) {\n        const c3dfObject = new C3DF(new KaitaiStream(buffer));\n        return this._parse(c3dfObject);\n    }\n\n    _parse(c3dfObject: any) {\n        const { faces, vertices } = c3dfObject;\n\n        const { textureWidth: width, textureHeight: height } = c3dfObject;\n\n        let position: number[] = [];\n        let uv: number[] = [];\n        faces.forEach((f: any) => {\n            let a = f.v1, b = f.v2, c = f.v3;\n            // *2 taken from LoadModel from original code\n            position.push(vertices![a].x * 2, vertices![a].y * 2, vertices![a].z * 2);\n            uv.push(f.tax / width, f.tay / height);\n            position.push(vertices![b].x * 2, vertices![b].y * 2, vertices![b].z * 2);\n            uv.push(f.tbx / width, f.tby / height);\n            position.push(vertices![c].x * 2, vertices![c].y * 2, vertices![c].z * 2);\n            uv.push(f.tcx / width, f.tcy / height);\n        });\n\n        const geo = new BufferGeometry();\n        geo.setAttribute('position', new Float32BufferAttribute(position, 3));\n        geo.setAttribute('uv', new Float32BufferAttribute(uv, 2));\n        geo.computeVertexNormals();\n\n        const map = createTexture(c3dfObject.textureData, c3dfObject.textureWidth, c3dfObject.textureHeight, true);\n        const material = new MeshBasicMaterial({ map, side: DoubleSide, alphaTest: 0.5, transparent: true });\n\n        return new Mesh(geo, material);\n    }\n}\n","import React from 'react';\nimport { Group, InstancedMesh, Matrix4 } from 'three';\nimport C3DFLoader from '../legacy/C3DFLoader';\n\ninterface Props {\n    map: any;\n    rsc: any;\n    getHeightAt: (x: number, z: number, r: number) => number;\n}\n\nfunction Scenery({ map, rsc, getHeightAt }: Props) {\n    const group = React.useMemo(() => {\n        const { objectHeightMap, flagsMap, mapSize, objectMap, tileSize } = map;\n        const halfTileSize = tileSize / 2;\n        const angleScale = (map.version === 1) ? 8 : 4;\n        const parent = new Group();\n        // Create matrices for all scenery\n        const matrices: number[][] = [];\n        const matrix = new Matrix4();\n        const matrix2 = new Matrix4();\n        for (let y = 0; y < mapSize; y++) {\n            for (let x = 0; x < mapSize; x++) {\n                const obj = objectMap[y * mapSize + x];\n                if (obj < 254) {\n                    const fullX = x * tileSize + halfTileSize;\n                    const fullY = y * tileSize + halfTileSize;\n                    let height = 0;\n                    const model = rsc.models[obj];\n                    if (model.fPlaceWater) {\n                        //console.log('WATER', x, y, obj);\n                    }\n                    else if (model.fPlaceGround) {\n                        //console.log('GROUND', x, y, obj);\n                        height = getHeightAt(x, y, model.grRad);\n                    }\n                    else if (model.fPlaceUser) {\n                        //console.log('USER', x, y, obj);\n                        height = objectHeightMap[y * mapSize + x] + 48;\n                    } else {\n                        // unexpected placement!\n                        console.log('HUH?', x, y, obj);\n                    }\n                    height = (-48 + height) * map.yScale;\n                    matrix2.makeRotationY(\n                        flagsMap[y * mapSize + x].fModelDirection * 2 * Math.PI / angleScale\n                    );\n                    matrix.makeTranslation(fullX, height, fullY);\n                    matrix.multiply(matrix2);\n\n                    if (!matrices[obj]) {\n                        matrices[obj] = matrix.toArray();\n                    } else {\n                        matrices[obj].push.apply(matrices[obj], matrix.toArray())\n                    }\n                }\n            }\n        }\n\n        const loader = new C3DFLoader();\n\n        rsc.models.forEach((mdl: any, obj: number) => {\n            if (matrices[obj]) {\n                const count = matrices[obj].length / 16;\n                const { geometry, material } = loader._parse(mdl.model);\n                const mesh = new InstancedMesh(\n                    geometry, material,\n                    count,\n                );\n                for (let i = 0; i < count; i++) {\n                    matrix.fromArray(matrices[obj], i * 16)\n                    mesh.setMatrixAt(i, matrix)\n                }\n                parent.add(mesh)\n            }\n        })\n\n        return parent;\n    }, [rsc, map, getHeightAt]);\n\n    return (\n        <primitive object={group} />\n    )\n}\n\nexport default Scenery;","import {\n    AnimationClip,\n    BufferGeometry,\n    DoubleSide,\n    Float32BufferAttribute,\n    Loader,\n    Mesh,\n    MeshBasicMaterial,\n    MorphTarget,\n} from 'three'\n\nimport CAR from '../kaitai/Car';\nimport KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport { createTexture } from './utils';\n\nexport default class CARLoader extends Loader {\n    load(\n        url: string,\n        onLoad: (character: Mesh) => void,\n        onProgress: (event: ProgressEvent) => void, // XXX no progress support yet\n        onError: (event: Error | ErrorEvent ) => void,\n     ) {\n         fetch(url).then(body => body.arrayBuffer()).then(buffer => {\n             onLoad( this.parse(buffer) );\n         }).catch(e => {\n             onError(e);\n         })\n    }\n\n    parse(buffer: ArrayBuffer) {\n        const car = new CAR(new KaitaiStream(buffer));\n        const frames = car.animations!.flatMap(a => a.frames);\n        const morphVertices = new Array(frames.length);\n        let position: number[] = [];\n        let uv: number[] = [];\n\n        const { textureWidth: width, textureHeight: height } = car;\n\n        const { faces, vertices } = car;\n\n        for (let i = 0; i < frames.length; i++) {\n            morphVertices[i] = new Array<number>();\n        }\n\n        function addVert(origVIdx: number, u: number, v: number) {\n            let { x, y, z } = vertices![origVIdx];\n            // *2 taken from LoadCharacterInfo from original code\n            x *= 2; y *= 2; z *= 2;\n            position.push(x, y, z);\n            uv.push(u, v);\n\n            frames.forEach((frame,idx) => {\n                morphVertices[idx].push(\n                    frame.vertices[origVIdx].x * 2, // these are already converted\n                    frame.vertices[origVIdx].y * 2, //    from short to float\n                    frame.vertices[origVIdx].z * 2,\n                )\n            })\n        }\n\n        faces!.forEach((f: any) => {\n            let a = f.v1, b = f.v2, c = f.v3;\n            addVert(a, f.tax / width, f.tay / height);\n            addVert(b, f.tbx / width, f.tby / height);\n            addVert(c, f.tcx / width, f.tcy / height);\n        });\n      \n        // Setup basic model geo data\n        let geo = new BufferGeometry();\n        geo.setAttribute('position', new Float32BufferAttribute(position, 3));\n        geo.setAttribute('uv', new Float32BufferAttribute(uv, 2));\n\n        // Add animation data\n        geo.morphAttributes.position = [];\n        let globalFrameIndex = 0;\n        car.animations?.forEach(anim => {\n            let name = anim.name;\n            anim.frames.forEach((_: any, frIdx: number) => {\n                const attr = new Float32BufferAttribute(morphVertices[globalFrameIndex], 3);\n                attr.name = `${name}.${frIdx}`;\n                geo.morphAttributes.position.push(attr);\n                ++globalFrameIndex;\n            })\n        })\n\n        let mat = new MeshBasicMaterial({\n            map: createTexture(car.textureData, car.textureWidth, car.textureHeight, false),\n            side: DoubleSide,\n        })\n\n        let mesh = new Mesh(geo, mat);\n\n        // Create animation clips\n        car.animations?.forEach(anim => {\n            const seq: MorphTarget[] = [];\n            for (let i = 0; i < anim.frameCount; i++) {\n                seq.push({\n                    name: `${anim.name}.${i}`,\n                    vertices: [], // seems unused\n                })\n            }\n            const clip = AnimationClip.CreateFromMorphTargetSequence(\n                anim.name,\n                seq,\n                anim.framesPerSecond,\n                false /*noLoop*/\n            );\n            mesh.animations.push(clip);\n        })\n\n        return mesh;\n    }\n}","import React from 'react';\nimport { DoubleSide, Scene, Spherical, Texture, Vector3 } from 'three';\nimport { createPortal, useFrame, useLoader, useThree } from '@react-three/fiber';\nimport { OrthographicCamera } from '@react-three/drei';\nimport C3DFLoader from '../legacy/C3DFLoader';\nimport CARLoader from '../legacy/CARLoader';\n\ninterface Props {\n  miniMap: Texture;\n}\n\nfunction HUD({ miniMap }: Props) {\n    const { gl, scene, camera, size } = useThree()\n    const virtualScene = React.useMemo(() => new Scene(), [])\n    const virtualCam = React.useRef<any>() // XXXX\n    var dir = new Vector3();\n    var sph = new Spherical();\n    \n    const compass = useLoader(C3DFLoader, \"HUNTDAT/COMPAS.3DF\");\n    const wind = useLoader(CARLoader, \"HUNTDAT/WIND.CAR\");\n\n    const { width, height } = miniMap.image;\n\n    useFrame(() => {\n        if (virtualCam.current) {\n            camera.getWorldDirection(dir);\n            sph.setFromVector3(dir);\n            compass.rotation.y = sph.theta + Math.PI;\n            wind.rotation.y = sph.theta + Math.PI;\n            gl.autoClear = true\n            gl.render(scene, camera)\n            gl.autoClear = false\n            gl.clearDepth()\n            gl.render(virtualScene, virtualCam.current)      \n        }\n    }, 1)\n  \n    return (createPortal(\n      <>\n        <OrthographicCamera ref={virtualCam} makeDefault={false} position={[0, 0, 220]} />\n        <primitive\n          position={[- size.width / 2 + 220, - size.height / 2 + 120, 0]}\n          rotation-x={-Math.PI/8}\n          scale={10}\n          object={wind}\n        />\n        <primitive\n          position={[size.width / 2 - 220, - size.height / 2 + 120, 0]}\n          rotation-x={-Math.PI/8}\n          scale={10}\n          object={compass}\n        />\n        <mesh position={[size.width / 2 - width, 0,  - size.height / 2 + height]}>\n            <planeBufferGeometry args={[width,height]} />\n            <meshBasicMaterial side={DoubleSide} map={miniMap} />\n        </mesh>\n      </>,\n      virtualScene\n    ) as any) as JSX.Element\n  }\n  \n  export default HUD;\n","import { useFrame, useThree } from '@react-three/fiber'\nimport React from 'react'\nimport { Audio, PositionalAudio, AudioListener } from 'three'\n\ninterface Props {\n    rsc: any;\n    map: any;\n}\n\nfunction rRand(max: number) {\n    return Math.floor(max * Math.random());\n}\n\nfunction siRand(radius: number) {\n    return (Math.random() - 0.5) * radius;\n}\n\nfunction EnvSound({ map, rsc }: Props) {\n    const { camera } = useThree()  \n    const [listener] = React.useState(() => new AudioListener())\n    const [ambientSound] = React.useState(() => ({\n        audio: new Audio(listener),\n        rAudio: new PositionalAudio(listener),\n        ambNo: -1,\n        randomTime: 0,\n    }))\n\n    // Convert audio data to WebAudio buffer\n    function createAudioBuffer(data: Uint8Array) {\n        const buffer = listener.context.createBuffer(1, data.length / 2, 22050)\n        const channelFloats = buffer.getChannelData(0)\n        const dv = new DataView(data.buffer, data.byteOffset, data.length)\n        for (let i = 0; i < data.length / 2; i++) {\n            channelFloats[i] = dv.getInt16(i * 2, true) / 32767\n        }\n        return buffer;\n    }\n\n    // TODO implement some kind of transitional fade?\n    // or queue ambient sound change for when current is finished?\n    function setAmbientSound(idx: number, delta: number) {\n        const ambSnd = rsc.ambientSounds[idx];\n\n        if (ambientSound.ambNo !== idx) {\n            console.log(`Selecting ambient sound ${idx}`)\n            if (!ambSnd) {\n                console.error(`Invalid ambient sound ${idx} selected`)\n                return\n            }\n\n            // Create WebAudio buffer\n            const buffer = createAudioBuffer(ambSnd.pcm)\n            ambientSound.ambNo = idx;\n\n            // Set random sound interval time\n            ambientSound.randomTime = (ambSnd.rData[0].rFrequency / 2 + rRand(ambSnd.rData[0].rFrequency));\n            console.log(ambientSound.randomTime)\n\n            if (ambientSound.audio.isPlaying) {\n                // Stop playing if already playing\n                ambientSound.audio.stop();\n            }\n            // Setup buffer for new sound...\n            ambientSound.audio.setBuffer(buffer)\n            ambientSound.audio.setVolume(ambSnd.aVolume / 256)\n            // ... and play\n            ambientSound.audio.play()\n        }\n\n        if (ambientSound.ambNo >= 0 && ambSnd.rsfxCount > 0) {\n            ambientSound.randomTime -= delta;\n            if (ambientSound.randomTime <= 0) {\n                ambientSound.randomTime = ambSnd.rData[0].rFrequency / 2 + rRand(ambSnd.rData[0].rFrequency);\n                console.log(ambientSound.randomTime)\n                console.log('Selecting random sound')\n                const r = ambSnd.rData[rRand(ambSnd.rsfxCount)];\n                const rBuffer = createAudioBuffer(rsc.randomSounds[r.rNumber].pcm)\n                ambientSound.rAudio.position.set(\n                    siRand(4096),\n                    siRand(256),\n                    siRand(4096),\n                )\n                ambientSound.rAudio.setBuffer(rBuffer)\n                ambientSound.rAudio.setVolume(r.rVolume)\n                ambientSound.rAudio.play()\n            }\n        }\n    }\n\n    React.useEffect(() => {\n        ambientSound.audio.setLoop(true)\n        ambientSound.rAudio.setLoop(false)\n        ambientSound.rAudio.setRefDistance(75)\n        camera.add(listener)\n        camera.add(ambientSound.rAudio)\n\n        return () => {\n            ambientSound.ambNo = -1;\n            ambientSound.audio.isPlaying && ambientSound.audio.stop()\n            ambientSound.rAudio.isPlaying && ambientSound.rAudio.stop()\n            camera.remove(listener)\n        }\n    })\n\n    useFrame(({ camera }, delta) => {\n        const tileX = Math.floor(camera.position.x / (map.tileSize * 2))\n        const tileZ = Math.floor(camera.position.z / (map.tileSize * 2))\n        setAmbientSound(map.ambientMap[tileZ * (map.mapSize / 2) + tileX ], delta)\n    });\n\n    return null\n}\n\nexport default EnvSound;\n","import React from 'react';\nimport { Html, PointerLockControls, Stats } from '@react-three/drei';\nimport { Canvas } from '@react-three/fiber';\n\nimport { loadArea } from '../legacy/hunt';\nimport Terrain from './Terrain';\nimport Player from '../Player';\nimport Sky from './Sky';\nimport Scenery from './Scenery';\nimport HUD from './HUD';\nimport EnvSound from './EnvSound';\n\ninterface Props {\n    mapUrl: string;\n    rscUrl: string;\n    enableHUD?: boolean;\n    enableScenery?: boolean;\n    enableSky?: boolean;\n    enableAudio?: boolean;\n    clipFar?: number;\n}\n\nfunction World({\n    mapUrl, rscUrl,\n    enableHUD = true,\n    enableScenery = true,\n    enableSky = true,\n    enableAudio = false,\n    clipFar = 1000000\n}: Props) {\n    const [world, setWorld] = React.useState<any>();\n\n    React.useEffect(() => {\n        loadArea(mapUrl, rscUrl).then(world => {\n            setWorld(world);\n        })\n    }, [mapUrl, rscUrl]);\n\n    return world ? (\n        <>\n            <Canvas\n                shadows\n                linear\n                camera={{\n                    fov: 30,\n                    near: 1,\n                    far: clipFar,\n                }}\n            >\n                <Stats />\n                <PointerLockControls />\n\n                <React.Suspense fallback={<Html center>Loading, please wait</Html>}>\n                    {enableAudio && <EnvSound rsc={world.rsc} map={world.map} />}\n                    {enableSky && <Sky clipFar={clipFar} rsc={world.rsc} map={world.map} />}\n                    <Terrain rsc={world.rsc} map={world.map} />\n                    {enableScenery && <Scenery rsc={world.rsc} map={world.map} getHeightAt={world.getObjectH} />}\n                    <Player landings={world.landings} getHeightAt={world.getHeightAt} />\n                    {enableHUD && <HUD miniMap={world.miniMap} />}\n\n                </React.Suspense>\n\n            </Canvas>\n\n        </>\n    ) : <></>\n}\n\nexport default World;\n\n/*\n                <fog near={clipFar-(clipFar / 10)} far={clipFar} attach=\"fog\" />\n*/\n","import React from 'react'\nimport DatGui, {\n    DatBoolean,\n//    DatNumber,\n    DatSelect\n} from 'react-dat-gui';\nimport 'react-dat-gui/dist/index.css';\n\nimport './Home.css'\nimport World from '../components/World'\n\nconst levelNames = [\n    'Basmachee Rocks',\n    'Fort Ciskin',\n];\n\nconst levelSources = [{\n        map: 'HUNTDAT/AREAS/AREA1.MAP',\n        rsc: 'HUNTDAT/AREAS/AREA1.RSC',\n    }, {\n        map: 'HUNTDAT/AREAS2/AREA2.MAP',\n        rsc: 'HUNTDAT/AREAS2/AREA2.RSC',\n    }\n];\n\nexport default function Home() {\n    const [ world, setWorld ] = React.useState(levelSources[0]);\n    const [ data, setData ] = React.useState({\n        enableScenery: true,\n        enableSky: true,\n        enableHUD: false,\n        enableAudio: false,\n        levelName: levelNames[0],\n        renderDistance: 16384,\n    });\n\n    function dragOver(ev: React.DragEvent) {\n        ev.preventDefault();\n    } \n\n    function drop(ev: React.DragEvent) {\n        ev.preventDefault();\n        if (ev.dataTransfer.files?.length) {\n            let map = null;\n            let rsc = null;\n            for (let i = 0; i < ev.dataTransfer.files.length; i++) {\n                const f = ev.dataTransfer.files[i];\n                if (f.name.toUpperCase().endsWith('.MAP')) {\n                    map = URL.createObjectURL(f);\n                } else if (f.name.toUpperCase().endsWith('.RSC')) {\n                    rsc = URL.createObjectURL(f);\n                }\n            }\n            if (map && rsc) {\n                setWorld({ map, rsc });\n            }\n        }\n    }\n\n    return (\n        <div\n            onDragOver={dragOver}\n            onDrop={drop}\n            className={'dndContainer'}\n        >\n            <World\n                mapUrl={world.map}\n                rscUrl={world.rsc}\n                enableHUD={data.enableHUD}\n                enableScenery={data.enableScenery}\n                enableSky={data.enableSky}\n                enableAudio={data.enableAudio}\n                clipFar={data.renderDistance}\n            />\n\n            <DatGui data={data} onUpdate={updated => {\n                // Detect area change\n                if (data.levelName !== updated.levelName) {\n                    const idx = levelNames.indexOf(updated.levelName);\n                    if (idx !== -1) {\n                        setWorld(levelSources[idx]);\n                    }\n                }\n                setData(updated)\n            }}>\n                <DatBoolean path='enableScenery' label=\"Objects\" />\n                <DatBoolean path='enableHUD' label=\"HUD\" />\n                <DatBoolean path='enableSky' label=\"Sky\" />\n                <DatBoolean path='enableAudio' label=\"Audio\" />\n                <DatSelect path='levelName' label=\"Area\" options={levelNames} />\n            </DatGui>\n\n        </div>\n    )\n}\n\n\n/*\n                <DatNumber path='renderDistance' label=\"RenderDist\" step={256} min={10*256} max={1000000} />\n*/","// https://en.wikipedia.org/wiki/BMP_file_format\n\nimport {\n    DataTextureLoader,\n    LinearMipmapLinearFilter,\n} from 'three';\n\nconst kBMSignature = 0x4d42; // LE encoded 'BM'\n\nclass BMPLoader extends DataTextureLoader {\n    parse( buffer ) {\n        const view = new DataView(buffer);\n        if (view.getUint16(0, true) !== kBMSignature) {\n            throw new Error(\"Invalid BMP signature\");\n        }\n\n        const fileSize = view.getUint32(2, true);\n        const imageDataOffset = view.getUint32(10, true);\n\n        const headerSize = view.getUint32(14, true);\n        if (headerSize !== 40) { // BITMAPINFOHEADER\n            throw new Error(`Unsupported DIB header size ${headerSize} in BMP`)\n        }\n\n        const imageWidth = view.getInt32(18, true);\n        const imageHeight = view.getInt32(22, true);\n        const colorPlanes = view.getUint16(26, true); // must be 1\n        if (colorPlanes !== 1) {\n            throw new Error(`Unsupported number of color planes ${colorPlanes} in BMP`)\n        }\n        const bitsPerPixel = view.getUint16(28, true);\n        const compressionMethod = view.getUint32(30, true);\n        if (compressionMethod !== 0) {\n            throw new Error(`Unsupported compression method ${compressionMethod} in BMP`)\n        }\n        const paletteColorCount = view.getUint32(46, true);\n\n        console.log(imageWidth, imageHeight, bitsPerPixel, paletteColorCount, fileSize, imageDataOffset);\n\n\t\treturn {\n\t\t\tdata: new Uint8ClampedArray(),\n\t\t\twidth: imageWidth,\n\t\t\theight: imageHeight,\n\t\t\tflipY: true,\n\t\t\tgenerateMipmaps: true,\n\t\t\tminFilter: LinearMipmapLinearFilter,\n\t\t};\n    }\n}\n\nexport { BMPLoader };","import React from 'react';\nimport { useLoader } from '@react-three/fiber';\nimport { TGALoader } from 'three/examples/jsm/loaders/TGALoader';\nimport { Loader, Texture } from 'three';\nimport { BMPLoader } from '../legacy/BMPLoader';\n\n// https://medium.com/@pdx.lucasm/canvas-with-react-js-32e133c05258\n\ninterface MenuArea {\n    id: number;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n};\n\ninterface MenuMap {\n    map: Uint8ClampedArray; // 400x300 map of IDs [0 = none, 1..x = highlite area]\n    areas: MenuArea[]; // rectangles for IDs from map, element 0 whole screen\n}\n\nconst MAP_WIDTH = 400;\nconst MAP_HEIGHT = 300;\n\nclass RawLoader extends Loader {\n    load(\n        url: string,\n        onLoad: (menuMap: MenuMap) => void,\n        onProgress: (event: ProgressEvent) => void, // XXX no progress support yet\n        onError: (event: Error | ErrorEvent ) => void,\n     ) {\n         fetch(url).then(body => body.arrayBuffer()).then(buffer => {\n             onLoad( this.parse(buffer) );\n         }).catch(e => {\n             onError(e);\n         })\n    }\n\n    parse(buffer: ArrayBuffer): MenuMap {\n        const map = new Uint8ClampedArray(buffer);\n        const areas: MenuArea[] = [];\n        const minX : number[] = [];\n        const maxX : number[] = [];\n        const minY : number[] = [];\n        const maxY : number[] = [];\n        \n        for (let y = 0; y < MAP_HEIGHT; y++) {\n            for (let x = 0; x < MAP_WIDTH; x++) {\n                let val = map[y * MAP_WIDTH + x];\n                if (minX[val] !== undefined) minX[val] = Math.min(x, minX[val]); else minX[val] = x;\n                if (maxX[val] !== undefined) maxX[val] = Math.max(x, maxX[val]); else maxX[val] = x;\n                if (minY[val] !== undefined) minY[val] = Math.min(y, minY[val]); else minY[val] = y;\n                if (maxY[val] !== undefined) maxY[val] = Math.max(y, maxY[val]); else maxY[val] = y;\n            }\n        }\n\n        minX.forEach((_, idx) => {\n            areas.push({\n                id: idx,\n                x: minX[idx],\n                y: minY[idx],\n                width: maxX[idx] - minX[idx] +1,\n                height: maxY[idx] - minY[idx] +1,\n            });\n        })\n\n        return {\n            map,\n            areas,\n        };\n    }\n};\n\nfunction texToImageData(tex: Texture) {\n    const data = new Uint8ClampedArray(\n        tex.image.data.buffer,\n        tex.image.data.byteOffset,\n        tex.image.data.length);\n    return new ImageData(data, tex.image.width, tex.image.height);\n}\n\n// EXIT.TGA => in-game exit dialog\n// PAUSE.TGA => in-game pause dialog\n// MAPFRAME.TGA => in-game map frame (to render minimap in)\n// MENUS.TGA => statistics menu image (full screen)\n// SPLASH.TGA => fullscreen image\n// TROPHY_E.TGA => \"press ESC to exit trophy\"\n// TROPHY_G.TGA => trophy info frame?\n// TROPHY.TGA => trophy info dialog frame\n\n// CREDITS.TGA => Credits screen\n// MENUR{,_ON}.TGA => please register screen (MR_MAP.RAW)\n// MENUD{,_ON}.TGA => delete profile popup (MD_MAP.RAW)\n// MENUL{,_ON}.TGA => accept disclaimer popup (ML_MAP.RAW)\n// MENUM{,_ON}.TGA => main menu (MAIN_MAP.RAW)\n// OPT_{ON,OFF}.TGA => Option menu (OPT_MAP.RAW)\n// LOC_{ON,OFF}.TGA => Hunt: Location selection (LOC_MAP.RAW)\n// WEP_{ON,OFF}.TGA => Hunt: Weapon selection (WEP_MAP.RAW)\n\nfunction RegisterMenu() {\n    const mainOff = texToImageData(useLoader(TGALoader, 'HUNTDAT/MENU/OPT_OFF.TGA'));\n    const mainOn = texToImageData(useLoader(TGALoader, 'HUNTDAT/MENU/OPT_ON.TGA'));\n    const mainMap = useLoader(RawLoader, 'HUNTDAT/MENU/OPT_MAP.RAW');\n    const test = useLoader(BMPLoader, 'HUNTDAT/MENU/LANDPIC/AREA1.BMP');\n    let context = React.useRef<CanvasRenderingContext2D | null>(null);\n    let highlitedId = -1;\n\n    function getId(x: number, y: number) {\n        let id = mainMap.map[((y * MAP_WIDTH) + x)];\n        if (id) {\n            return mainMap.areas[id];\n        }\n\n        return null;\n    }\n\n    const canvasRef = React.useRef<HTMLCanvasElement>(null)\n    React.useEffect(() => {\n        if (canvasRef.current) {\n            context.current = canvasRef.current.getContext('2d')\n            if (context.current) {\n                context.current.putImageData(mainOff, 0, 0);\n            }\n        }\n    });\n\n    const mouseMove: React.MouseEventHandler = ev => {\n        const hovered = getId(Math.floor(ev.clientX / 2), Math.floor(ev.clientY / 2));\n        //console.log(`hovered: ${hovered?.id}`, ev.clientX, ev.clientY);\n        if (context.current && highlitedId !== hovered?.id) {          \n            if (highlitedId > 0) {\n                console.log(`off ${highlitedId}`)\n                const prev = mainMap.areas[highlitedId];\n                context.current.putImageData(mainOff, 0, 0, \n                    prev.x * 2, prev.y * 2, prev.width * 2, prev.height * 2);\n            }\n            if (hovered) {\n                console.log(`on ${hovered.id}`)\n                context.current.putImageData(mainOn, 0, 0, \n                    hovered.x * 2, hovered.y * 2, hovered.width * 2, hovered.height * 2);\n\n                highlitedId = hovered.id;\n            } else {\n                highlitedId = -1;\n            }\n        }\n    }\n    const mouseDown: React.MouseEventHandler = ev => {\n        console.log('mouseDown', ev)\n    }\n    const keyDown: React.KeyboardEventHandler = ev => {\n        console.log('keyDown', ev)\n    };\n\n    return (\n        <div\n            style={{position: 'relative'}}\n        >\n        <canvas\n            style={{height: '100%', width: 'auto' }}\n            ref={canvasRef}\n            width=\"800\" height=\"600\"\n            onMouseMove={mouseMove}\n            onMouseDown={mouseDown}\n            onKeyDown={keyDown}\n        />\n        </div>\n    );\n}\n\nexport default function Main() {\n    return (\n        <React.Suspense fallback={null}>\n            <RegisterMenu/>\n        </React.Suspense>\n    )\n}\n","//https://medium.com/@pdx.lucasm/canvas-with-react-js-32e133c05258\nimport React from 'react';\n\ninterface CanvasProps {\n    width?: number;\n    height?: number;\n    drawContent?: (context: CanvasRenderingContext2D) => void;\n}\n\nconst Canvas: React.FC<CanvasProps> = ({drawContent, width, height, ...props}) => {\n    const canvasRef = React.useRef<HTMLCanvasElement>(null)\n\n    React.useEffect(() => {\n        const canvas = canvasRef.current\n        const context = canvas?.getContext('2d')\n        if (canvas && context) {\n            if (width !== undefined) {\n                context.canvas.width = width;\n            }\n            if (height !== undefined) {\n                context.canvas.height = height;\n            }\n            if (drawContent) {\n                drawContent(context);\n            } else {\n                context.fillStyle = '#000000'\n                context.fillRect(0, 0, context.canvas.width, context.canvas.height)\n            }\n        }\n    }, [drawContent, height, width])\n\n\n    return (\n        <canvas\n            ref={canvasRef}\n            {...props}\n        />\n    );\n}\n\nexport default Canvas;\n","import React from 'react'\n\nimport KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport MAP from '../kaitai/carnivores_map';\nimport Canvas from '../components/Canvas';\n\nconst generateHeightmap = (map: any, field: string) => {\n    let imageData = new ImageData(map.mapSize, map.mapSize);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        imageData.data[i*4+0] = map[field][i];\n        imageData.data[i*4+1] = map[field][i];\n        imageData.data[i*4+2] = map[field][i];\n        imageData.data[i*4+3] = 0xff;\n    }\n    return imageData;\n}\n\nconst generateFlagsMap = (map: any, r: number, g: number, b: number) => {\n    let imageData = new ImageData(map.mapSize, map.mapSize);\n    const bitToColorChannel = (flags: number, bit: number) => ((flags & (1 << bit)) !== 0 ? 0 : 255);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        let val = map.flagsMap[i];\n        imageData.data[i*4+0] = r !== -1 ? bitToColorChannel(val, r) : 0;\n        imageData.data[i*4+1] = g !== -1 ? bitToColorChannel(val, g) : 0;\n        imageData.data[i*4+2] = b !== -1 ? bitToColorChannel(val, b) : 0;\n        imageData.data[i*4+3] = 0xff;\n    }\n    return imageData;\n}\n\ninterface BitSelectProps {\n    bitCount: number;\n    value: number;\n    onChange: (bit: number) => void;\n}\n\nconst BitSelect: React.FC<BitSelectProps> = ({\n    value = 0,\n    bitCount = 8,\n    onChange,\n}) => {\n    return (\n        <select value={value} onChange={event => onChange(parseFloat(event.target.value))}>\n            <option value=\"-1\">n/a</option>\n            {new Array(bitCount).fill(0).map((_,i) => (\n                <option key={i} value={i}>bit {i}</option>\n            ))}\n        </select>\n    )\n}\n\nexport default function MapEditor() {\n    const [ map, setMap ] = React.useState<any>(null);\n    const [ mapName, setMapName ] = React.useState<string|null>(null);\n    const [ bitR, setBitR ] = React.useState(-1);\n    const [ bitG, setBitG ] = React.useState(-1);\n    const [ bitB, setBitB ] = React.useState(-1);\n    const [ mode, setMode ] = React.useState(1);\n\n    function dragOver(ev: React.DragEvent) {\n        ev.preventDefault();\n    } \n\n    function drop(ev: React.DragEvent) {\n        ev.preventDefault();\n        if (ev.dataTransfer.files?.length) {\n            const mapName = ev.dataTransfer.files[0].name;\n            const url = URL.createObjectURL(ev.dataTransfer.files[0]);\n            // fetch URL (retrieves local file, no physical network involved)\n            fetch(url).then(body => body.arrayBuffer()).then(buf => {\n                // Create KaitaiStream and load map\n                const map = new MAP(new KaitaiStream(buf));\n                setMapName(mapName);\n                setMap(map);\n            });\n        }\n    }\n\n    const getImageData = () => {\n        let imageData: ImageData | undefined;\n\n        switch(mode) {\n            case 0: // Flags\n                imageData = generateFlagsMap(map, bitR, bitG, bitB);\n                break;\n\n            case 1: // Heightmap\n                imageData = generateHeightmap(map, 'heightMap');\n                break;\n\n            case 2: // Watertmap\n                imageData = generateHeightmap(map, 'waterMap');\n                break;\n        }\n\n        return imageData;\n    }\n\n    const drawMapContent = (ctx: CanvasRenderingContext2D) => {\n        const imageData = getImageData();\n        if (imageData) {\n            ctx.putImageData(imageData, 0, 0);\n        }\n    }\n\n    const downloadImageData = () => {\n        const imageData = getImageData();\n        if (imageData) {\n            var canvas = document.createElement('canvas');\n            var ctx = canvas.getContext(\"2d\");\n            if (ctx) {\n                ctx.canvas.width = imageData.width;\n                ctx.canvas.height = imageData.height;\n                ctx.putImageData(imageData, 0, 0);\n                var dataImage = canvas.toDataURL(\"image/png\");\n\n                let name: string = mapName?.replace(/\\.MAP$/i, '') || '';\n                switch(mode) {\n                    case 0:\n                        name += `-r${bitR}g${bitG}b${bitB}.png`;\n                        break;\n                    case 1: \n                        name += '-height.png';\n                        break;\n                    case 2: \n                        name += '-water.png';\n                        break;\n                }\n\n                const link = document.createElement('a');\n                link.setAttribute('download', name);\n                link.setAttribute('href', dataImage.replace(\"image/png\", \"image/octet-stream\"));\n                link.click();\n            }\n        }\n    }\n\n    return (\n        <div onDragOver={dragOver} onDrop={drop} style={{width: '100%', height: '100%', margin: '5px', userSelect: 'text'}}>\n            {map && mapName ? (\n                <>\n                    <h1>{mapName}</h1>\n                    <select value={mode} onChange={ev => setMode(parseInt(ev.target.value))}>\n                        <option value=\"0\">Flags</option>\n                        <option value=\"1\">Heightmap</option>\n                        <option value=\"2\">Watermap</option>\n                    </select>\n                    {\n                        mode === 0 && (\n                            <>\n                                <BitSelect value={bitR} bitCount={16} onChange={bit => setBitR(bit)} />\n                                <BitSelect value={bitG} bitCount={16} onChange={bit => setBitG(bit)} />\n                                <BitSelect value={bitB} bitCount={16} onChange={bit => setBitB(bit)} />      \n                            </>\n                        )\n                    }\n                    <button\n                        onClick={downloadImageData}\n                        >\n                            Download\n                    </button>\n                    <br/>\n                    <br/>\n                    <Canvas\n                        width={map.mapSize}\n                        height={map.mapSize}\n                        drawContent={drawMapContent}\n                    />\n                </>\n            ) : (\n                <h1>Drop a Carnivores 1/2/IceAge MAP file here</h1>\n            )}\n        </div>\n    )\n}","import React from 'react';\nimport { OrbitControls, useAnimations } from '@react-three/drei';\nimport { Canvas, useLoader } from '@react-three/fiber';\nimport DatGui, { DatSelect } from 'react-dat-gui';\nimport { Loader, Mesh } from 'three';\nimport './ModelEditor.css';\nimport 'react-dat-gui/dist/index.css';\n\nimport CARLoader from '../legacy/CARLoader';\nimport C3DFLoader from '../legacy/C3DFLoader';\n\nclass WrapperLoader extends Loader {\n    load(\n        url: string,\n        onLoad: (character: Mesh) => void,\n        onProgress: (event: ProgressEvent) => void,\n        onError: (event: Error | ErrorEvent ) => void,\n    ) {\n        const [ type, uri ] = url.split('~');\n        if (type === '3DF') {\n            return new C3DFLoader().load(uri, onLoad, onProgress, onError)\n        } else if (type === 'CAR') {\n            return new CARLoader().load(uri, onLoad, onProgress, onError)\n        }\n\n        return null;\n    }\n}\n\ninterface Props {\n    modelUri: string;\n}\n\ninterface ModelProps {\n    animation: string;\n    model: Mesh;\n}\n\nfunction Model({ model, animation }: ModelProps) {\n    const { actions, ref } = useAnimations(model.animations);\n\n    React.useEffect(() => {\n        actions[animation]?.play();\n        return () => { actions[animation]?.stop(); }\n    })\n\n    return (\n        <primitive ref={ref} object={model} />\n    )\n}\n\nfunction ModelViewer({ modelUri }: Props) {\n    const model = useLoader(WrapperLoader, modelUri);\n    const [ data, setData ] = React.useState({ animation: '' });\n\n    const animations = React.useMemo(() => {\n        const anims = [ '' ];\n        model.animations.forEach(a => anims.push(a.name));\n        return anims;\n    }, [ model ])\n\n    return (\n        <>\n        <Canvas\n            className=\"canvasStyle\"\n            linear\n            camera={{\n                position: [0,500,-500],\n                far: 10000,\n            }}\n        >\n            <OrbitControls target={[0, 0, 0]} />\n            <axesHelper args={[1000]} />\n            <gridHelper args={[1000, 1000/16]} />\n            <Model model={model} animation={data.animation} />\n        </Canvas>\n        <DatGui data={data} onUpdate={updated => setData(updated)}>\n            <DatSelect path=\"animation\" options={animations} />\n        </DatGui>\n        </>\n    )\n}\n\nexport default function ModelEditor() {\n    const [ modelUri, setModelUri ] = React.useState('CAR~HUNTDAT/HUNTER1.CAR');\n    \n    function dragOver(ev: React.DragEvent) {\n        ev.preventDefault();\n    } \n\n    function drop(ev: React.DragEvent) {\n        ev.preventDefault();\n        if (ev.dataTransfer.files?.length) {\n            const { name } = ev.dataTransfer.files[0];\n            let type;\n            if (name.toLowerCase().endsWith('.3df')) {\n                type = '3DF';\n            } else if (name.toLowerCase().endsWith('.car')) {\n                type = 'CAR';\n            }\n            const url = URL.createObjectURL(ev.dataTransfer.files[0]);\n            setModelUri(`${type}~${url}`);\n        }\n    }\n\n    return (\n        <div onDragOver={dragOver} onDrop={drop} className=\"modelContainer\">\n            <React.Suspense fallback={null}>\n                <ModelViewer modelUri={modelUri} />\n            </React.Suspense>\n        </div>\n    )\n}","import React from 'react'\n\nimport {\n  HashRouter as Router,\n  Switch,\n  Route,\n} from 'react-router-dom';\n\nimport Home from './pages/Home';\nimport Main from './pages/Main';\nimport MapEditor from './pages/MapEditor';\nimport ModelEditor from './pages/ModelEditor';\n\nexport default function App() {\n  return (\n    <Router>\n      <Switch>\n        <Route exact path=\"/\">\n          <Home />\n        </Route>\n        <Route path=\"/main\">\n          <Main />\n        </Route>\n        <Route path=\"/edit-map\">\n          <MapEditor />\n        </Route>\n        <Route path=\"/edit-model\">\n          <ModelEditor />\n        </Route>\n      </Switch>\n    </Router>\n  )\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}