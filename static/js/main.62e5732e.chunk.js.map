{"version":3,"sources":["kaitai/C3df.js","kaitai/Vertex.js","kaitai/Face.js","legacy/hunt.ts","pages/Home.tsx","components/Canvas.tsx","pages/MapEditor.tsx","pages/ModelEditor.tsx","App.tsx","reportWebVitals.ts","index.tsx","kaitai/Map.js","kaitai/Rsc.js","kaitai/carnivores_map.js"],"names":["root","factory","define","undefined","this","KaitaiStream","Vertex","Face","C3df","_io","_parent","_root","_read","prototype","vertCount","readU4le","faceCount","nodeCount","textureSize","faces","Array","i","vertices","nodes","Node","textureData","Math","floor","readU2le","name","bytesToStr","bytesTerminate","readBytes","x","readF4le","y","z","owner","readS2le","hide","Object","defineProperty","get","_m_textureWidth","_m_textureHeight","textureWidth","amd","module","exports","require","v1","v2","v3","tax","readS4le","tbx","tcx","tay","tby","tcy","fDoubleSide","readBitsIntBe","fDarkBack","fOpacity","fMortal","fPhong","fEnvmap","fNeedvc","fUnused","fDarkFront","alignToByte","dMask","distant","next","group","reserved","areaPath","mapScale","terrainTexSize","createMapGeometry","map","geo","PlaneBufferGeometry","mapSize","rotateX","PI","scale","version","attributes","position","setY","heightMap","computeVertexNormals","createTextureArray","rsc","data","Uint16Array","textureCount","offset","j","pixel","textures","r","g","b","tex","DataTexture2DArray","type","UnsignedShort565Type","format","RGBFormat","wrapT","wrapS","RepeatWrapping","createInstancedModels","parent","matrices","halfMapSize","getHeight","matrix","Matrix4","obj","objectMap","makeTranslation","push","apply","toArray","indicator","Mesh","SphereBufferGeometry","MeshBasicMaterial","color","set","add","models","forEach","mdl","count","length","idx","BufferGeometry","uv","index","findUvForVertex","vIdx","u","v","f","a","c","setAttribute","Float32BufferAttribute","setIndex","createGeometry","model","texData","texSize","width","height","DataTexture","RGBAFormat","UnsignedShort5551Type","needsUpdate","createTexture","mesh","InstancedMesh","MeshLambertMaterial","transparent","alphaTest","fromArray","setMatrixAt","buildDataMap","Uint8Array","flags","flagsMap","textureMap1","fTexRotation","fReverse","dayLightMap","textureMap2","RGBAIntegerFormat","UnsignedByteType","internalFormat","flipY","area","scene","Group","fetch","then","body","arrayBuffer","mapBuffer","rscBuffer","MAP","console","log","RSC","mat","defines","onBeforeCompile","s","textureMap","uniforms","value","vs","vertexShader","replace","fs","fragmentShader","error","Terrain","setLoading","useThree","React","useEffect","time","loadArea","world","timeEnd","Home","useState","isLoading","className","shadows","linear","camera","fov","near","far","Stats","args","shadow-mapSize-width","shadow-mapSize-height","shadow-camera-left","shadow-camera-right","shadow-camera-top","shadow-camera-bottom","shadow-camera-far","castShadow","OrbitControls","Canvas","drawContent","props","canvasRef","useRef","canvas","current","context","getContext","fillStyle","fillRect","ref","generateHeightmap","field","imageData","ImageData","BitSelect","bitCount","onChange","event","parseFloat","target","fill","_","MapEditor","setMap","mapName","setMapName","bitR","setBitR","bitG","setBitG","bitB","setBitB","mode","setMode","getImageData","bitToColorChannel","bit","val","generateFlagsMap","onDragOver","ev","preventDefault","onDrop","dataTransfer","files","url","URL","createObjectURL","buf","style","margin","userSelect","parseInt","onClick","document","createElement","ctx","putImageData","dataImage","toDataURL","link","click","ModelEditor","App","exact","path","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById","Map","readU1","FlagsV1","FlagsV2","dawnLightMap","nightLightMap","waterMap","objectHeightMap","fogsMap","ambientMap","readBitsIntLe","unknown","fWater","unknown1","fNoWay","unknown2","unknown3","fWater2","_m_version","size","_m_isValid","_m_mapSize","Rsc","AudioReverb","freeze","GENERIC","PLATE","FOREST","MOUNTAIN","CANYON","CAVE","SPECIAL2","UNUSED","0","1","2","3","4","5","6","7","modelCount","dawnSkyRgb","Rgb","daySkyRgb","nightSkyRgb","dawnSkyTRgb","daySkyTRgb","nightSkyTRgb","Texture","Model","dawnSkyTexture","skyTextureSize","daySkyTexture","nightSkyTexture","cloudsMap","fogCount","fogList","FogEntry","randomSoundCount","randomSounds","RandomSound","ambientSoundCount","ambientSounds","AmbientSound","waterCount","waters","Water","radius","yLo","yHi","lineLength","lIntensity","circleRad","cIntensity","fPlaceWater","fPlaceGround","fPlaceUser","fCircle","fBound","fNoBmp","fNoLight","fDefaultLight","fGroundLight","fNoSoft","fNoSoft2","fIsAnimated","grRad","refLight","lastAniTime","boundR","billboard","animation","ModelAnimation","Trd","rNumber","rVolume","rFrequency","rEnvironment","rfNotAtNight","rfUnused","vc0","vc1","vc2","kps","frameCount","frames","textureIndex","level","opacity","fogRgb","yBegin","mortal","transp","fLimit","pcmSize","pcm","rData","rsfxCount","aVolume","_m_skyTextureSize","Carnivores1Map","isV1","lightMap","isV2","_m_isV1","_m_isV2"],"mappings":"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","file":"static/js/main.62e5732e.chunk.js","sourcesContent":["// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined; // IRA\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n      define(['kaitai-struct/KaitaiStream', './Vertex', './Face'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n      module.exports = factory(require('kaitai-struct/KaitaiStream'), require('./Vertex'), require('./Face'));\n    } else {\n      root.C3df = factory(root.KaitaiStream, root.Vertex, root.Face);\n    }\n  }(this, function (KaitaiStream, Vertex, Face) {\n  /**\n   * @see {@link https://carnivores.fandom.com/wiki/3DF|Source}\n   */\n  \n  var C3df = (function() {\n    function C3df(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n  \n      this._read();\n    }\n    C3df.prototype._read = function() {\n      this.vertCount = this._io.readU4le();\n      this.faceCount = this._io.readU4le();\n      this.nodeCount = this._io.readU4le();\n      this.textureSize = this._io.readU4le();\n      this.faces = new Array(this.faceCount);\n      for (var i = 0; i < this.faceCount; i++) {\n        this.faces[i] = new Face(this._io, this, null);\n      }\n      this.vertices = new Array(this.vertCount);\n      for (var i = 0; i < this.vertCount; i++) {\n        this.vertices[i] = new Vertex(this._io, this, null);\n      }\n      this.nodes = new Array(this.nodeCount);\n      for (var i = 0; i < this.nodeCount; i++) {\n        this.nodes[i] = new Node(this._io, this, this._root);\n      }\n      this.textureData = new Array(Math.floor(this.textureSize / 2));\n      for (var i = 0; i < Math.floor(this.textureSize / 2); i++) {\n        this.textureData[i] = this._io.readU2le();\n      }\n    }\n  \n    var Node = C3df.Node = (function() {\n      function Node(_io, _parent, _root) {\n        this._io = _io;\n        this._parent = _parent;\n        this._root = _root || this;\n  \n        this._read();\n      }\n      Node.prototype._read = function() {\n        this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(32), 0, false), \"utf8\");\n        this.x = this._io.readF4le();\n        this.y = this._io.readF4le();\n        this.z = this._io.readF4le();\n        this.owner = this._io.readS2le();\n        this.hide = this._io.readU2le();\n      }\n  \n      return Node;\n    })();\n    Object.defineProperty(C3df.prototype, 'textureWidth', {\n      get: function() {\n        if (this._m_textureWidth !== undefined)\n          return this._m_textureWidth;\n        this._m_textureWidth = 256;\n        return this._m_textureWidth;\n      }\n    });\n    Object.defineProperty(C3df.prototype, 'textureHeight', {\n      get: function() {\n        if (this._m_textureHeight !== undefined)\n          return this._m_textureHeight;\n        this._m_textureHeight = Math.floor(Math.floor(this.textureSize / 2) / this.textureWidth);\n        return this._m_textureHeight;\n      }\n    });\n  \n    return C3df;\n  })();\n  return C3df;\n  }));\n  ","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined; // IRA\n\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n      define(['kaitai-struct/KaitaiStream'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n      module.exports = factory(require('kaitai-struct/KaitaiStream'));\n    } else {\n      root.Vertex = factory(root.KaitaiStream);\n    }\n  }(this, function (KaitaiStream) {\n  /**\n   * @see {@link https://carnivores.fandom.com/wiki/3DF|Source}\n   */\n  \n  var Vertex = (function() {\n    function Vertex(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n  \n      this._read();\n    }\n    Vertex.prototype._read = function() {\n      this.x = this._io.readF4le();\n      this.y = this._io.readF4le();\n      this.z = this._io.readF4le();\n      this.owner = this._io.readS2le();\n      this.hide = this._io.readU2le();\n    }\n  \n    return Vertex;\n  })();\n  return Vertex;\n  }));\n  ","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined; // IRA\n\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n      define(['kaitai-struct/KaitaiStream'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n      module.exports = factory(require('kaitai-struct/KaitaiStream'));\n    } else {\n      root.Face = factory(root.KaitaiStream);\n    }\n  }(this, function (KaitaiStream) {\n  /**\n   * @see {@link https://carnivores.fandom.com/wiki/3DF|Source}\n   */\n  \n  var Face = (function() {\n    function Face(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n  \n      this._read();\n    }\n    Face.prototype._read = function() {\n      this.v1 = this._io.readU4le();\n      this.v2 = this._io.readU4le();\n      this.v3 = this._io.readU4le();\n      this.tax = this._io.readS4le();\n      this.tbx = this._io.readS4le();\n      this.tcx = this._io.readS4le();\n      this.tay = this._io.readS4le();\n      this.tby = this._io.readS4le();\n      this.tcy = this._io.readS4le();\n      this.fDoubleSide = this._io.readBitsIntBe(1) != 0;\n      this.fDarkBack = this._io.readBitsIntBe(1) != 0;\n      this.fOpacity = this._io.readBitsIntBe(1) != 0;\n      this.fMortal = this._io.readBitsIntBe(1) != 0;\n      this.fPhong = this._io.readBitsIntBe(1) != 0;\n      this.fEnvmap = this._io.readBitsIntBe(1) != 0;\n      this.fNeedvc = this._io.readBitsIntBe(1) != 0;\n      this.fUnused = this._io.readBitsIntBe(7);\n      this.fDarkFront = this._io.readBitsIntBe(1) != 0;\n      this._io.alignToByte();\n      this.dMask = this._io.readU2le();\n      this.distant = this._io.readS4le();\n      this.next = this._io.readU4le();\n      this.group = this._io.readU4le();\n      this.reserved = this._io.readBytes(12);\n    }\n  \n    return Face;\n  })();\n  return Face;\n  }));\n  ","import KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport {\n    BufferGeometry,\n    DataTexture,\n    DataTexture2DArray,\n    Float32BufferAttribute,\n    Group,\n    InstancedMesh,\n    Matrix4,\n    Mesh,\n    MeshLambertMaterial,\n    MeshBasicMaterial,\n    PlaneBufferGeometry,\n    RepeatWrapping,\n    RGBAFormat,\n    RGBFormat,\n    SphereBufferGeometry,\n    UnsignedByteType,\n    RGBAIntegerFormat,\n    UnsignedShort565Type,\n    UnsignedShort5551Type,\n} from 'three';\n\nimport MAP from '../kaitai/Map';\nimport RSC from '../kaitai/Rsc';\n\nconst areaPath = 'HUNTDAT/AREAS';\n\nconst mapScale = 256; // size of one map square\nconst mapHScale = 32; // Y scale for heightfield\nconst terrainTexSize = 128; // terrain textures are 128x128 pix\n\nfunction createMapGeometry(map: any) {\n    // Create a plane with divisions as base for map heightfield\n    const geo = new PlaneBufferGeometry(\n        map.mapSize * mapScale, map.mapSize * mapScale,\n        map.mapSize - 1, map.mapSize - 1\n    );\n\n    // Lay it flat\n    geo.rotateX(-Math.PI / 2);\n\n    // Set heights based on heightfield\n    let scale = mapHScale;\n    if (map.version == 2) scale *= 2;\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        geo.attributes.position.setY(i, map.heightMap[i] * scale);\n    }\n\n    // Compute normals for lighting\n    geo.computeVertexNormals();\n\n    return geo;\n}\n\nfunction createTextureArray(rsc: any) {\n    // create data array\n    const data = new Uint16Array(rsc.textureCount * terrainTexSize * terrainTexSize);\n\n    // copy texture data\n    let offset = 0;\n    for (let i = 0; i < rsc.textureCount; i++) {\n        for (let j = 0; j < terrainTexSize * terrainTexSize; j++) {\n            // read RGBA5551...\n            let pixel = rsc.textures[i].data[j];\n            let r = (pixel >> 10) & 0x1f;\n            let g = ((pixel >>  5) & 0x1f) << 1;\n            let b = (pixel >>  0) & 0x1f;\n            // write RGB565 (since we do not need transparency here)\n            data[offset++] = (r << 11) + (g << 5) + b;\n        }\n    }\n\n    let tex = new DataTexture2DArray(data, terrainTexSize, terrainTexSize, rsc.textureCount);\n    tex.type = UnsignedShort565Type;\n    tex.format = RGBFormat;\n    tex.wrapT = tex.wrapS = RepeatWrapping;\n    return tex;\n}\n\n\nfunction createGeometry(vertices: any[], faces: any[]) {\n    let geo = new BufferGeometry();\n    let position: number[] = [];\n    let uv: number[] = [];\n    let index: number[] = [];\n    vertices.forEach(v => {\n        position.push(v.x, v.y, v.z);\n    });\n    function findUvForVertex(vIdx: number, u: number, v: number) {\n        // TODO: look for duplicate UVs and reuse\n        uv[vIdx * 2 + 0] = u;\n        uv[vIdx * 2 + 1] = v;\n        return vIdx;\n    }\n    let idx;\n    faces.forEach(f => {\n        let a = f.v1, b = f.v2, c = f.v3;\n\n        idx = findUvForVertex(a, f.tax / 256, f.tay / 256);\n        index.push(idx);\n        idx = findUvForVertex(b, f.tbx / 256, f.tby / 256);\n        index.push(idx);\n        idx = findUvForVertex(c, f.tcx / 256, f.tcy / 256);\n        index.push(idx);\n    });\n\n    geo.setAttribute('position', new Float32BufferAttribute(position, 3));\n    geo.setAttribute('uv', new Float32BufferAttribute(uv, 2));\n    geo.setIndex(index);\n    geo.computeVertexNormals();\n\n    return geo;\n}\n\nfunction createTexture(texData: Uint16Array, texSize: number) {\n    let width = 256;\n    let height = texSize / (width * 2);\n  \n    let data = new Uint16Array(width * height);\n    let offset = 0;\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        let pixel = texData[y * width + x];\n        let r = ((pixel >> 10) & 0x1f);\n        let g = ((pixel >>  5) & 0x1f);\n        let b = ((pixel >>  0) & 0x1f);\n        let a = (pixel & 0x80) ? 1 : 0; // ????\n        data[offset++] = (r << 11) + (g << 6) + (b << 1) | a;\n      }\n    }\n  \n    const tex = new DataTexture(\n        data, width, height,\n        RGBAFormat, UnsignedShort5551Type,\n    );\n    tex.needsUpdate = true;\n    return tex;\n  }\n\nfunction createInstancedModels(rsc: any, map: any, parent: Group) {\n\n    const matrices: number[][] = [];\n\n    const mapSize = map.mapSize;\n    const halfMapSize = mapSize / 2;\n\n    function getHeight(x: number, y: number) {\n        return map.heightMap[y * map.mapSize + x] * mapHScale;\n    }\n\n    const matrix = new Matrix4();\n    for (let y = 0; y < mapSize; y++) {\n        for (let x = 0; x < mapSize; x++) {\n            const obj = map.objectMap[y * mapSize + x];\n            if (obj < 254) {\n                matrix.makeTranslation(\n                    (x - halfMapSize) * mapScale,\n                    getHeight(x, y),\n                    (y - halfMapSize) * mapScale)\n                if (!matrices[obj]) {\n                    matrices[obj] = matrix.toArray();\n                } else {\n                    matrices[obj].push.apply(matrices[obj], matrix.toArray())\n                }\n            } else if (obj === 254) {\n                // Landing list\n                const indicator = new Mesh(\n                    new SphereBufferGeometry(128),\n                    new MeshBasicMaterial({ color: 0xff0000 }),\n                )\n                indicator.position.set(\n                    (x - halfMapSize) * mapScale,\n                    getHeight(x, y),\n                    (y - halfMapSize) * mapScale);\n\n                parent.add(indicator);\n            } else if (obj === 255) {\n                // empty\n            }\n        }\n    }\n\n    rsc.models.forEach((mdl: any, obj: number) => {\n        if (matrices[obj]) {\n            const count = matrices[obj].length / 16;\n            const geo = createGeometry(mdl.model.vertices, mdl.model.faces);\n            const tex = createTexture(mdl.model.textureData, mdl.model.textureSize);\n            const mesh = new InstancedMesh(\n                geo, new MeshLambertMaterial({ map: tex, transparent: true, alphaTest: 0.5 }),\n                count,\n            );\n            for (let i = 0; i < count; i++) {\n                matrix.fromArray(matrices[obj], i * 16)\n                mesh.setMatrixAt(i, matrix)\n            }\n            parent.add(mesh)\n        }\n    })\n}\n\nfunction buildDataMap(map: any) {\n    const data = new Uint8Array(map.mapSize * map.mapSize * 4);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        const flags = map.flagsMap[i];\n        data[i*4+0] = map.textureMap1[i];\n        data[i*4+1] = flags.fTexRotation | (flags.fReverse << 6); //flags.val;\n        data[i*4+2] = map.dayLightMap[i];\n        data[i*4+3] = map.textureMap2[i];\n    }\n    let tex = new DataTexture(data, 512, 512, RGBAIntegerFormat, UnsignedByteType);\n    tex.internalFormat = 'RGBA8UI';\n    tex.flipY = true;\n\n    return tex;\n}\n\nexport async function loadArea(area: string) {\n    let scene = new Group();\n\n    try {\n        const mapBuffer = await fetch(`${areaPath}/${area}.MAP`).then(body => body.arrayBuffer());\n        const rscBuffer = await fetch(`${areaPath}/${area}.RSC`).then(body => body.arrayBuffer());\n\n        const map = new MAP(new KaitaiStream(mapBuffer));\n        console.log(`MAPv${map.version}`)\n        const rsc = new RSC(new KaitaiStream(rscBuffer), undefined, undefined, map.version);\n        console.log(rsc, map)\n\n        const geo = createMapGeometry(map)\n\n        createInstancedModels(rsc, map, scene);\n\n        let mat = new MeshBasicMaterial({ map: createTextureArray(rsc) });\n        mat.defines = {\n            'MAP_SIZE': `${map.mapSize}.0`,\n            'CARNIVORES': map.version,\n        };\n        mat.onBeforeCompile = s => {\n            console.log(s, map, rsc)\n            let textureMap = buildDataMap(map);\n            s.uniforms['textureMap'] = {\n                value: textureMap,\n            };\n            // Adjust vertex shader\n            let vs = s.vertexShader;\n            vs = vs.replace('#include <common>', `\n                precision highp usampler2D;\n                uniform usampler2D textureMap;\n                varying vec4 vLighting;\n            `)\n            vs = vs.replace('#include <color_vertex>', `\n                uvec4 tex = texture(textureMap, vUv);\n                #if CARNIVORES == 1\n                float light = 1.0 - (float(tex.b) / 64.0);\n                #else\n                float light = 1.0;// - (float(tex.b) / 255.0);\n                #endif\n                vLighting = vec4(light, light, light, 1.0);\n                #include <color_vertex>\n            `)\n            s.vertexShader = vs;\n            // Adjust the fragment shader\n            let fs = s.fragmentShader;\n            fs = fs.replace('#include <map_pars_fragment>', `\n            precision highp sampler2DArray;\n            precision highp usampler2D;\n            uniform sampler2DArray map;\n            uniform usampler2D textureMap;\n            varying vec4 vLighting;\n            `);\n            fs = fs.replace('#include <map_fragment>', `\n            const float tileUvStep = 1.0 / MAP_SIZE;\n            vec2 localTileUv = mod(vUv, tileUvStep) * MAP_SIZE;\n            uvec4 tex = texture(textureMap, vUv);\n            localTileUv.y = 1.0 - localTileUv.y; // XX remove and fix switch\n            float triside = ((1.0-localTileUv.x) - localTileUv.y);\n            diffuseColor = vLighting;\n            switch(tex.g & 3u) {\n                case 0u:\n                    //diffuseColor = vec4(1.0, 1.0, 1.0, 1.0);\n                    break;\n                case 1u:\n                    float t = localTileUv.x;\n                    localTileUv.x = localTileUv.y;\n                    localTileUv.y = 1.0 - t;\n                    //diffuseColor = vec4(0.5, 0.0, 0.0, 1.0);\n                    break;\n                case 2u:\n                    localTileUv.x = 1.0 - localTileUv.x;\n                    localTileUv.y = 1.0 - localTileUv.y;\n                    //diffuseColor = vec4(0.5, 0.5, 0.0, 1.0);\n                    break;\n                case 3u:\n                    float x = localTileUv.x;\n                    localTileUv.x = 1.0 - localTileUv.y;\n                    localTileUv.y = x;\n                    //diffuseColor = vec4(0.0, 0.0, 1.0, 1.0);\n                    break;\n            }\n            uint depth = 0u;\n            #if CARNIVORES == 2\n            triside = 0.0;\n            #endif\n            if (triside > 0.0) {\n                depth = (tex.g & 64u) != 0u ? tex.r : tex.a;\n            } else {\n                depth = (tex.g & 64u) != 0u ? tex.a : tex.r;\n            }\n            vec4 texelColor = texture( map, vec3(localTileUv, depth) );\n            texelColor = mapTexelToLinear( texelColor );\n            diffuseColor *= texelColor;\n            `)\n            s.fragmentShader = fs;\n        }\n\n        // Okay, terrain done!\n        scene.add(new Mesh(geo, mat));\n    } catch (e) {\n        console.error(e)\n        return undefined;\n    }\n\n    return scene;\n}\n","import React from 'react'\n\nimport { Stats, OrbitControls, PointerLockControls } from '@react-three/drei'\nimport { Canvas, useThree } from '@react-three/fiber'\n\nimport { loadArea } from '../legacy/hunt'\n\nimport './Home.css'\nimport Player from '../Player'\n\ninterface Props {\n    setLoading: (isLoading: boolean) => void;\n}\n\nfunction Terrain({ setLoading }: Props) {\n    const { scene } = useThree();\n\n    function getHeightAt(x: number, z: number): number {\n        return 1500;\n    }\n\n    console.log('Terrain')\n    React.useEffect(() => {\n        console.time(\"loadArea\");\n        loadArea(\"AREA1\").then(world => {\n            console.timeEnd(\"loadArea\");\n            if (world) {\n                scene.add(world)\n            }\n            setLoading(false);\n        })\n    }, [setLoading, scene])\n    return <></> //<Player getHeightAt={getHeightAt} />;\n}\n\nexport default function Home() {\n    const [ isLoading, setLoading ] = React.useState(true);\n\n    return (\n        <>\n            {isLoading && (<div className=\"center\"><p>Loading, please wait</p></div>)}\n            <Canvas\n                shadows\n                linear\n                camera={{\n                    position: [ 0, 12000, 12000 ],\n                    fov: 30,\n                    near: 1,\n                    far: 1000000,\n                }}\n            >\n                <Stats />\n                <directionalLight\n                    args={[0xdfebff, 1]}\n                    position={[50, 200, 100]}\n                    shadow-mapSize-width={1024}\n                    shadow-mapSize-height={1024}\n                    shadow-camera-left={-300}\n                    shadow-camera-right={300}\n                    shadow-camera-top={300}\n                    shadow-camera-bottom={-300}\n                    shadow-camera-far={1000}\n                    castShadow\n                />\n                <ambientLight\n                    args={[0x666666]}\n                />\n\n                <OrbitControls />\n\n                <Terrain setLoading={setLoading} />\n            </Canvas>\n        </>\n    )\n}\n","//https://medium.com/@pdx.lucasm/canvas-with-react-js-32e133c05258\nimport React from 'react';\n\ninterface CanvasProps {\n    width?: number;\n    height?: number;\n    drawContent?: (context: CanvasRenderingContext2D) => void;\n}\n\nconst Canvas: React.FC<CanvasProps> = ({drawContent, width, height, ...props}) => {\n    const canvasRef = React.useRef<HTMLCanvasElement>(null)\n\n    React.useEffect(() => {\n        const canvas = canvasRef.current\n        const context = canvas?.getContext('2d')\n        if (canvas && context) {\n            if (width !== undefined) {\n                context.canvas.width = width;\n            }\n            if (height !== undefined) {\n                context.canvas.height = height;\n            }\n            if (drawContent) {\n                drawContent(context);\n            } else {\n                context.fillStyle = '#000000'\n                context.fillRect(0, 0, context.canvas.width, context.canvas.height)\n            }\n        }\n    }, [drawContent, height, width])\n\n\n    return (\n        <canvas\n            ref={canvasRef}\n            {...props}\n        />\n    );\n}\n\nexport default Canvas;\n","import React from 'react'\n\nimport KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport MAP from '../kaitai/carnivores_map';\nimport Canvas from '../components/Canvas';\n\nconst generateHeightmap = (map: any, field: string) => {\n    let imageData = new ImageData(map.mapSize, map.mapSize);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        imageData.data[i*4+0] = map[field][i];\n        imageData.data[i*4+1] = map[field][i];\n        imageData.data[i*4+2] = map[field][i];\n        imageData.data[i*4+3] = 0xff;\n    }\n    return imageData;\n}\n\nconst generateFlagsMap = (map: any, r: number, g: number, b: number) => {\n    let imageData = new ImageData(map.mapSize, map.mapSize);\n    const bitToColorChannel = (flags: number, bit: number) => ((flags & (1 << bit)) !== 0 ? 0 : 255);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        let val = map.flagsMap[i];\n        imageData.data[i*4+0] = r !== -1 ? bitToColorChannel(val, r) : 0;\n        imageData.data[i*4+1] = g !== -1 ? bitToColorChannel(val, g) : 0;\n        imageData.data[i*4+2] = b !== -1 ? bitToColorChannel(val, b) : 0;\n        imageData.data[i*4+3] = 0xff;\n    }\n    return imageData;\n}\n\ninterface BitSelectProps {\n    bitCount: number;\n    value: number;\n    onChange: (bit: number) => void;\n}\n\nconst BitSelect: React.FC<BitSelectProps> = ({\n    value = 0,\n    bitCount = 8,\n    onChange,\n}) => {\n    return (\n        <select value={value} onChange={event => onChange(parseFloat(event.target.value))}>\n            <option value=\"-1\">n/a</option>\n            {new Array(bitCount).fill(0).map((_,i) => (\n                <option key={i} value={i}>bit {i}</option>\n            ))}\n        </select>\n    )\n}\n\nexport default function MapEditor() {\n    const [ map, setMap ] = React.useState<any>(null);\n    const [ mapName, setMapName ] = React.useState<string|null>(null);\n    const [ bitR, setBitR ] = React.useState(-1);\n    const [ bitG, setBitG ] = React.useState(-1);\n    const [ bitB, setBitB ] = React.useState(-1);\n    const [ mode, setMode ] = React.useState(1);\n\n    function dragOver(ev: React.DragEvent) {\n        ev.preventDefault();\n    } \n\n    function drop(ev: React.DragEvent) {\n        ev.preventDefault();\n        if (ev.dataTransfer.files?.length) {\n            const mapName = ev.dataTransfer.files[0].name;\n            const url = URL.createObjectURL(ev.dataTransfer.files[0]);\n            // fetch URL (retrieves local file, no physical network involved)\n            fetch(url).then(body => body.arrayBuffer()).then(buf => {\n                // Create KaitaiStream and load map\n                const map = new MAP(new KaitaiStream(buf));\n                setMapName(mapName);\n                setMap(map);\n            });\n        }\n    }\n\n    const getImageData = () => {\n        let imageData: ImageData | undefined;\n\n        switch(mode) {\n            case 0: // Flags\n                imageData = generateFlagsMap(map, bitR, bitG, bitB);\n                break;\n\n            case 1: // Heightmap\n                imageData = generateHeightmap(map, 'heightMap');\n                break;\n\n            case 2: // Watertmap\n                imageData = generateHeightmap(map, 'waterMap');\n                break;\n        }\n\n        return imageData;\n    }\n\n    const drawMapContent = (ctx: CanvasRenderingContext2D) => {\n        const imageData = getImageData();\n        if (imageData) {\n            ctx.putImageData(imageData, 0, 0);\n        }\n    }\n\n    const downloadImageData = () => {\n        const imageData = getImageData();\n        if (imageData) {\n            var canvas = document.createElement('canvas');\n            var ctx = canvas.getContext(\"2d\");\n            if (ctx) {\n                ctx.canvas.width = imageData.width;\n                ctx.canvas.height = imageData.height;\n                ctx.putImageData(imageData, 0, 0);\n                var dataImage = canvas.toDataURL(\"image/png\");\n\n                let name: string = mapName?.replace(/\\.MAP$/i, '') || '';\n                switch(mode) {\n                    case 0:\n                        name += `-r${bitR}g${bitG}b${bitB}.png`;\n                        break;\n                    case 1: \n                        name += '-height.png';\n                        break;\n                    case 2: \n                        name += '-water.png';\n                        break;\n                }\n\n                const link = document.createElement('a');\n                link.setAttribute('download', name);\n                link.setAttribute('href', dataImage.replace(\"image/png\", \"image/octet-stream\"));\n                link.click();\n            }\n        }\n    }\n\n    return (\n        <div onDragOver={dragOver} onDrop={drop} style={{width: '100%', height: '100%', margin: '5px', userSelect: 'text'}}>\n            {map && mapName ? (\n                <>\n                    <h1>{mapName}</h1>\n                    <select value={mode} onChange={ev => setMode(parseInt(ev.target.value))}>\n                        <option value=\"0\">Flags</option>\n                        <option value=\"1\">Heightmap</option>\n                        <option value=\"2\">Watermap</option>\n                    </select>\n                    {\n                        mode === 0 && (\n                            <>\n                                <BitSelect value={bitR} bitCount={16} onChange={bit => setBitR(bit)} />\n                                <BitSelect value={bitG} bitCount={16} onChange={bit => setBitG(bit)} />\n                                <BitSelect value={bitB} bitCount={16} onChange={bit => setBitB(bit)} />      \n                            </>\n                        )\n                    }\n                    <button\n                        onClick={downloadImageData}\n                        >\n                            Download\n                    </button>\n                    <br/>\n                    <br/>\n                    <Canvas\n                        width={map.mapSize}\n                        height={map.mapSize}\n                        drawContent={drawMapContent}\n                    />\n                </>\n            ) : (\n                <h1>Drop a Carnivores 1/2/IceAge MAP file here</h1>\n            )}\n        </div>\n    )\n}","import React from 'react'\n\nexport default function ModelEditor() {\n    return (\n        <div />\n    )\n}","import React from 'react'\n\nimport {\n  HashRouter as Router,\n  Switch,\n  Route,\n} from 'react-router-dom';\n\nimport Home from './pages/Home';\nimport MapEditor from './pages/MapEditor';\nimport ModelEditor from './pages/ModelEditor';\n\nexport default function App() {\n  return (\n    <Router>\n      <Switch>\n        <Route exact path=\"/\">\n          <Home />\n        </Route>\n        <Route path=\"/edit-map\">\n          <MapEditor />\n        </Route>\n        <Route path=\"/edit-model\">\n          <ModelEditor />\n        </Route>\n      </Switch>\n    </Router>\n  )\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined;\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.Map = factory(root.KaitaiStream);\n  }\n}(this, function (KaitaiStream) {\n/**\n * @see {@link https://carnivores.fandom.com/wiki/Carnivores_2_MAP|Source}\n */\n\nvar Map = (function() {\n  function Map(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Map.prototype._read = function() {\n    this.heightMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      this.heightMap[i] = this._io.readU1();\n    }\n    this.textureMap1 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.version) {\n      case 1:\n        this.textureMap1[i] = this._io.readU1();\n        break;\n      case 2:\n        this.textureMap1[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.textureMap2 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.version) {\n      case 1:\n        this.textureMap2[i] = this._io.readU1();\n        break;\n      case 2:\n        this.textureMap2[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.objectMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.flagsMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.version) {\n      case 1:\n        this.flagsMap[i] = new FlagsV1(this._io, this, this._root);\n        break;\n      case 2:\n        this.flagsMap[i] = new FlagsV2(this._io, this, this._root);\n        break;\n      }\n    }\n    if (this.version == 2) {\n      this.dawnLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.dayLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    if (this.version == 2) {\n      this.nightLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.waterMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.objectHeightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.fogsMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n    this.ambientMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n  }\n\n  var FlagsV1 = Map.FlagsV1 = (function() {\n    function FlagsV1(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FlagsV1.prototype._read = function() {\n      this.fTexRotation = this._io.readBitsIntLe(2);\n      this.unknown = this._io.readBitsIntLe(4);\n      this.fReverse = this._io.readBitsIntLe(1) != 0;\n      this.fWater = this._io.readBitsIntLe(1) != 0;\n    }\n\n    /**\n     * 0: no rotation (right-side-up)\n     * 1: rotated 90 degrees clockwise\n     * 2: rotated 180 degrees (upside-down)\n     * 3: rotated 90 degrees counter-clockwise\n     */\n\n    /**\n     * Indicates how the cell is diagonally split among both textures\n     *   true: 2 - 1\n     *   false: 1 - 2\n     */\n\n    /**\n     * Marks the cell as having water in it, must be set for the Water Index\n     * map to have any effect.\n     */\n\n    return FlagsV1;\n  })();\n\n  var FlagsV2 = Map.FlagsV2 = (function() {\n    function FlagsV2(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FlagsV2.prototype._read = function() {\n      this.unknown1 = this._io.readBitsIntLe(4);\n      this.fReverse = this._io.readBitsIntLe(1) != 0;\n      this.fNoWay = this._io.readBitsIntLe(1) != 0;\n      this.unknown2 = this._io.readBitsIntLe(1) != 0;\n      this.fWater = this._io.readBitsIntLe(1) != 0;\n      this.unknown3 = this._io.readBitsIntLe(7);\n      this.fWater2 = this._io.readBitsIntLe(1) != 0;\n    }\n\n    /**\n     * will reverse the order of the triangles so that the center edge\n     * goes the other way\n     */\n\n    /**\n     * Marks this cell as invalid for spawning and path finding for AI\n     */\n\n    /**\n     * Marks the cell as having water in it, must be set for the Water Index\n     * map to have any effect.\n     */\n\n    /**\n     * Marks the cell as having water in it (this flag is unused)\n     */\n\n    return FlagsV2;\n  })();\n  Object.defineProperty(Map.prototype, 'version', {\n    get: function() {\n      if (this._m_version !== undefined)\n        return this._m_version;\n      this._m_version = (this._io.size == 2228224 ? 1 : (this._io.size == 14155776 ? 2 : 0));\n      return this._m_version;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'isValid', {\n    get: function() {\n      if (this._m_isValid !== undefined)\n        return this._m_isValid;\n      this._m_isValid =  ((this.version == 1) || (this.version == 2)) ;\n      return this._m_isValid;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'mapSize', {\n    get: function() {\n      if (this._m_mapSize !== undefined)\n        return this._m_mapSize;\n      this._m_mapSize = (this.version * 512);\n      return this._m_mapSize;\n    }\n  });\n\n  /**\n   * Terrain heightmap\n   * \n   * The terrain geometry is a `map_size`x`map_size` grid of 256x256\n   * tiles, where the integer height from the heightmap is multiplied by 32\n   * for the original Carnivores, and 64 for Carnivores 2 and Ice Age.\n   */\n\n  /**\n   * Textur map 1\n   * \n   * In the original Carnivores, this specifies the texture to on the\n   * first* triangle of a tile. For Carnivores 2 and Ice Age, the texture\n   * specified here is used for the entire tile.\n   * \n   * Triangle order (for original Carnivores):\n   * +-----+\n   * | \\ 1 |\n   * |  \\  |\n   * | 2 \\ |\n   * +-----+\n   */\n\n  /**\n   * Texture map 2\n   * \n   * In the original Carnivores, this specifies the texture of the second\n   * triangle of a tile. For Carnivores 2 and Ice Age, the texture specified\n   * here is used for a 4x4 tile in the distance (aka LOD texture).\n   */\n\n  /**\n   * Object map\n   * \n   * This map specifies if an object is placed on a tile, and if so, which\n   * one. The following values are used:\n   * \n   *   < 254: object index (see RSC file format)\n   *     254: spawn location (or trophy placement location for trophy room)\n   *     255: no object\n   */\n\n  /**\n   * Map of flags per tile. different between original and 2 / Ice Age!\n   */\n\n  /**\n   * Water heightmap\n   * Only read when the water flag is set for a tile.\n   * Specifies sea floor height.\n   */\n\n  /**\n   * Object heightmap\n   * \n   * Map of heights for tiles with objects. However, it is only used when\n   * the object flags in the RSC file specify place_user (other options there\n   * are place_ground or place_water).\n   */\n\n  /**\n   * Fog map, which areas are covered in fog in game.\n   */\n\n  /**\n   * Ambient sounds map\n   */\n\n  return Map;\n})();\nreturn Map;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined;\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream', './C3df'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'), require('./C3df'));\n  } else {\n    root.Rsc = factory(root.KaitaiStream, root.C3df);\n  }\n}(this, function (KaitaiStream, C3df) {\n/**\n * @see {@link https://www.tapatalk.com/groups/the_carnivores_saga/carnivores-2-and-ice-age-rsc-files-t2316.html|Source}\n */\n\n var Rsc = (function() {\n  Rsc.AudioReverb = Object.freeze({\n    GENERIC: 0,\n    PLATE: 1,\n    FOREST: 2,\n    MOUNTAIN: 3,\n    CANYON: 4,\n    CAVE: 5,\n    SPECIAL2: 6,\n    UNUSED: 7,\n\n    0: \"GENERIC\",\n    1: \"PLATE\",\n    2: \"FOREST\",\n    3: \"MOUNTAIN\",\n    4: \"CANYON\",\n    5: \"CAVE\",\n    6: \"SPECIAL2\",\n    7: \"UNUSED\",\n  });\n\n  function Rsc(_io, _parent, _root, version) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n    this.version = version;\n    console.log('in RSC:', version)\n\n    this._read();\n  }\n  Rsc.prototype._read = function() {\n    this.textureCount = this._io.readU4le();\n    this.modelCount = this._io.readU4le();\n    if (this.version == 2) {\n      this.dawnSkyRgb = new Rgb(this._io, this, this._root);\n    }\n    this.daySkyRgb = new Rgb(this._io, this, this._root);\n    if (this.version == 2) {\n      this.nightSkyRgb = new Rgb(this._io, this, this._root);\n    }\n    if (this.version == 2) {\n      this.dawnSkyTRgb = new Rgb(this._io, this, this._root);\n    }\n    this.daySkyTRgb = new Rgb(this._io, this, this._root);\n    if (this.version == 2) {\n      this.nightSkyTRgb = new Rgb(this._io, this, this._root);\n    }\n    this.textures = new Array(this.textureCount);\n    for (var i = 0; i < this.textureCount; i++) {\n      this.textures[i] = new Texture(this._io, this, this._root);\n    }\n    this.models = new Array(this.modelCount);\n    for (var i = 0; i < this.modelCount; i++) {\n      this.models[i] = new Model(this._io, this, this._root);\n    }\n    if (this.version == 2) {\n      this.dawnSkyTexture = new Array(Math.floor(this.skyTextureSize / 2));\n      for (var i = 0; i < Math.floor(this.skyTextureSize / 2); i++) {\n        this.dawnSkyTexture[i] = this._io.readU2le();\n      }\n    }\n    this.daySkyTexture = new Array(Math.floor(this.skyTextureSize / 2));\n    for (var i = 0; i < Math.floor(this.skyTextureSize / 2); i++) {\n      this.daySkyTexture[i] = this._io.readU2le();\n    }\n    if (this.version == 2) {\n      this.nightSkyTexture = new Array(Math.floor(this.skyTextureSize / 2));\n      for (var i = 0; i < Math.floor(this.skyTextureSize / 2); i++) {\n        this.nightSkyTexture[i] = this._io.readU2le();\n      }\n    }\n    this.cloudsMap = this._io.readBytes((128 * 128));\n    this.fogCount = this._io.readU4le();\n    this.fogList = new Array(this.fogCount);\n    for (var i = 0; i < this.fogCount; i++) {\n      this.fogList[i] = new FogEntry(this._io, this, this._root);\n    }\n    this.randomSoundCount = this._io.readU4le();\n    this.randomSounds = new Array(this.randomSoundCount);\n    for (var i = 0; i < this.randomSoundCount; i++) {\n      this.randomSounds[i] = new RandomSound(this._io, this, this._root);\n    }\n    this.ambientSoundCount = this._io.readU4le();\n    this.ambientSounds = new Array(this.ambientSoundCount);\n    for (var i = 0; i < this.ambientSoundCount; i++) {\n      this.ambientSounds[i] = new AmbientSound(this._io, this, this._root);\n    }\n    if (this.version == 2) {\n      this.waterCount = this._io.readU4le();\n    }\n    if (this.version == 2) {\n      this.waters = new Array(this.waterCount);\n      for (var i = 0; i < this.waterCount; i++) {\n        this.waters[i] = new Water(this._io, this, this._root);\n      }\n    }\n  }\n\n  var Rgb = Rsc.Rgb = (function() {\n    function Rgb(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Rgb.prototype._read = function() {\n      this.r = this._io.readU4le();\n      this.g = this._io.readU4le();\n      this.b = this._io.readU4le();\n    }\n\n    return Rgb;\n  })();\n\n  var Model = Rsc.Model = (function() {\n    function Model(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Model.prototype._read = function() {\n      this.radius = this._io.readS4le();\n      this.yLo = this._io.readS4le();\n      this.yHi = this._io.readS4le();\n      this.lineLength = this._io.readS4le();\n      this.lIntensity = this._io.readS4le();\n      this.circleRad = this._io.readS4le();\n      this.cIntensity = this._io.readS4le();\n      this.fPlaceWater = this._io.readBitsIntLe(1) != 0;\n      this.fPlaceGround = this._io.readBitsIntLe(1) != 0;\n      this.fPlaceUser = this._io.readBitsIntLe(1) != 0;\n      this.fCircle = this._io.readBitsIntLe(1) != 0;\n      this.fBound = this._io.readBitsIntLe(1) != 0;\n      this.fNoBmp = this._io.readBitsIntLe(1) != 0;\n      this.fNoLight = this._io.readBitsIntLe(1) != 0;\n      this.fDefaultLight = this._io.readBitsIntLe(1) != 0;\n      this.fGroundLight = this._io.readBitsIntLe(1) != 0;\n      this.fNoSoft = this._io.readBitsIntLe(1) != 0;\n      this.fNoSoft2 = this._io.readBitsIntLe(1) != 0;\n      this.fUnused = this._io.readBitsIntLe(20);\n      this.fIsAnimated = this._io.readBitsIntLe(1) != 0;\n      this._io.alignToByte();\n      this.grRad = this._io.readS4le();\n      this.refLight = this._io.readS4le();\n      this.lastAniTime = this._io.readU4le();\n      this.boundR = this._io.readF4le();\n      this.reserved = this._io.readBytes(16);\n      this.model = new C3df(this._io, this, null);\n      if (this._root.version == 2) {\n        this.billboard = new Texture(this._io, this, this._root);\n      }\n      if (this.fIsAnimated) {\n        this.animation = new ModelAnimation(this._io, this, this._root);\n      }\n    }\n\n    return Model;\n  })();\n\n  var Trd = Rsc.Trd = (function() {\n    function Trd(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Trd.prototype._read = function() {\n      this.rNumber = this._io.readU4le();\n      this.rVolume = this._io.readU4le();\n      this.rFrequency = this._io.readU4le();\n      this.rEnvironment = this._io.readU2le();\n      this.rfNotAtNight = this._io.readBitsIntLe(1) != 0;\n      this.rfUnused = this._io.readBitsIntLe(15);\n    }\n\n    /**\n     * if set, sound does not play at night\n     */\n\n    return Trd;\n  })();\n\n  var ModelAnimation = Rsc.ModelAnimation = (function() {\n    function ModelAnimation(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    ModelAnimation.prototype._read = function() {\n      this.vc0 = this._io.readU4le();\n      this.vc1 = this._io.readU4le();\n      this.vc2 = this._io.readU4le();\n      this.kps = this._io.readU4le();\n      this.frameCount = this._io.readU4le();\n      this.frames = new Array(((this.frameCount * 3) * this.vc1));\n      for (var i = 0; i < ((this.frameCount * 3) * this.vc1); i++) {\n        this.frames[i] = this._io.readS2le();\n      }\n    }\n\n    return ModelAnimation;\n  })();\n\n  var Water = Rsc.Water = (function() {\n    function Water(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Water.prototype._read = function() {\n      this.textureIndex = this._io.readU4le();\n      this.level = this._io.readU4le();\n      this.opacity = this._io.readF4le();\n      this.fogRgb = this._io.readU4le();\n    }\n\n    return Water;\n  })();\n\n  var FogEntry = Rsc.FogEntry = (function() {\n    function FogEntry(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FogEntry.prototype._read = function() {\n      this.fogRgb = this._io.readU4le();\n      this.yBegin = this._io.readF4le();\n      this.mortal = this._io.readU4le();\n      this.transp = this._io.readF4le();\n      this.fLimit = this._io.readF4le();\n    }\n\n    return FogEntry;\n  })();\n\n  var AmbientSound = Rsc.AmbientSound = (function() {\n    function AmbientSound(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    AmbientSound.prototype._read = function() {\n      this.pcmSize = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmSize);\n      this.rData = new Array(16);\n      for (var i = 0; i < 16; i++) {\n        this.rData[i] = new Trd(this._io, this, this._root);\n      }\n      this.rsfxCount = this._io.readU4le();\n      this.aVolume = this._io.readU4le();\n    }\n\n    return AmbientSound;\n  })();\n\n  var RandomSound = Rsc.RandomSound = (function() {\n    function RandomSound(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    RandomSound.prototype._read = function() {\n      this.pcmSize = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmSize);\n    }\n\n    return RandomSound;\n  })();\n\n  var Texture = Rsc.Texture = (function() {\n    function Texture(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Texture.prototype._read = function() {\n      this.data = new Array((128 * 128));\n      for (var i = 0; i < (128 * 128); i++) {\n        this.data[i] = this._io.readU2le();\n      }\n    }\n\n    return Texture;\n  })();\n  Object.defineProperty(Rsc.prototype, 'skyTextureSize', {\n    get: function() {\n      if (this._m_skyTextureSize !== undefined)\n        return this._m_skyTextureSize;\n      this._m_skyTextureSize = ((256 * 256) * 2);\n      return this._m_skyTextureSize;\n    }\n  });\n\n  return Rsc;\n})();\nreturn Rsc;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\n/* eslint-disable */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.Carnivores1Map = factory(root.KaitaiStream);\n  }\n}(this, function (KaitaiStream) {\nvar Carnivores1Map = (function() {\n  function Carnivores1Map(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Carnivores1Map.prototype._read = function() {\n    this.heightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.textureMap1 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.textureMap1[i] = this._io.readU1();\n        break;\n      case false:\n        this.textureMap1[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.textureMap2 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.textureMap2[i] = this._io.readU1();\n        break;\n      case false:\n        this.textureMap2[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.objectMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.flagsMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.flagsMap[i] = this._io.readU1();\n        break;\n      case false:\n        this.flagsMap[i] = this._io.readU2le();\n        break;\n      }\n    }\n    if (this.isV1) {\n      this.lightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.dawnLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.dayLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.nightLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.waterMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.objectHeightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.fogsMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n    this.ambientMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n  }\n  Object.defineProperty(Carnivores1Map.prototype, 'isV1', {\n    get: function() {\n      if (this._m_isV1 !== undefined)\n        return this._m_isV1;\n      this._m_isV1 = this._io.size == 2228224;\n      return this._m_isV1;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'isV2', {\n    get: function() {\n      if (this._m_isV2 !== undefined)\n        return this._m_isV2;\n      this._m_isV2 = this._io.size == 14155776;\n      return this._m_isV2;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'isValid', {\n    get: function() {\n      if (this._m_isValid !== undefined)\n        return this._m_isValid;\n      this._m_isValid =  ((this.isV1) || (this.isV2)) ;\n      return this._m_isValid;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'mapSize', {\n    get: function() {\n      if (this._m_mapSize !== undefined)\n        return this._m_mapSize;\n      this._m_mapSize = (this.isV1 ? 512 : 1024);\n      return this._m_mapSize;\n    }\n  });\n\n  /**\n   * Terrain heightmap, for water tiles it specifies the water surface height\n   */\n\n  /**\n   * Terrain texture map, every byte specifies a texture index for the terrain\n   */\n\n  /**\n   * Object placement map, every byte specifies an object (< 254), a spawn location (254), or no model (255)\n   */\n\n  /**\n   * Flags map, specifies render flags per tile. This includes rotation of terrain texture, of object, and more.\n   */\n\n  /**\n   * Light map, specifies lighting of placed objects\n   */\n\n  /**\n   * Water heightmap, specifies \"sea floor\" terrain heights\n   */\n\n  /**\n   * Object heightmap, height placement of objects (flags map can specify to align to sea floor level or terrain ground level too)\n   */\n\n  /**\n   * Fog map, which areas are covered in fog in game.\n   */\n\n  /**\n   * Ambient sounds map\n   */\n\n  return Carnivores1Map;\n})();\nreturn Carnivores1Map;\n}));\n"],"sourceRoot":""}