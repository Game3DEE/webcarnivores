(this.webpackJsonpwebcarnivores=this.webpackJsonpwebcarnivores||[]).push([[0],{110:function(t,e,i){var r,a,n=void 0;r=this,a=function(t,e,i){return function(){function r(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}r.prototype._read=function(){this.vertCount=this._io.readU4le(),this.faceCount=this._io.readU4le(),this.nodeCount=this._io.readU4le(),this.textureSize=this._io.readU4le(),this.faces=new Array(this.faceCount);for(var t=0;t<this.faceCount;t++)this.faces[t]=new i(this._io,this,null);for(this.vertices=new Array(this.vertCount),t=0;t<this.vertCount;t++)this.vertices[t]=new e(this._io,this,null);for(this.nodes=new Array(this.nodeCount),t=0;t<this.nodeCount;t++)this.nodes[t]=new a(this._io,this,this._root);this.textureData=this._io.readBytes(this.textureSize)};var a=r.Node=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.name=t.bytesToStr(t.bytesTerminate(this._io.readBytes(32),0,!1),"utf8"),this.x=this._io.readF4le(),this.y=this._io.readF4le(),this.z=this._io.readF4le(),this.owner=this._io.readS2le(),this.hide=this._io.readU2le()},e}();return Object.defineProperty(r.prototype,"textureWidth",{get:function(){return void 0!==this._m_textureWidth||(this._m_textureWidth=256),this._m_textureWidth}}),Object.defineProperty(r.prototype,"textureHeight",{get:function(){return void 0!==this._m_textureHeight||(this._m_textureHeight=Math.floor(Math.floor(this.textureSize/2)/this.textureWidth)),this._m_textureHeight}}),r}()},"function"===typeof n&&n.amd?n(["kaitai-struct/KaitaiStream","./Vertex","./Face"],a):t.exports?t.exports=a(i(20),i(164),i(165)):r.C3df=a(r.KaitaiStream,r.Vertex,r.Face)},164:function(t,e,i){var r,a,n=void 0;r=this,a=function(t){return function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.x=this._io.readF4le(),this.y=this._io.readF4le(),this.z=this._io.readF4le(),this.owner=this._io.readS2le(),this.hide=this._io.readU2le()},t}()},"function"===typeof n&&n.amd?n(["kaitai-struct/KaitaiStream"],a):t.exports?t.exports=a(i(20)):r.Vertex=a(r.KaitaiStream)},165:function(t,e,i){var r,a,n=void 0;r=this,a=function(t){return function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.v1=this._io.readU4le(),this.v2=this._io.readU4le(),this.v3=this._io.readU4le(),this.tax=this._io.readS4le(),this.tbx=this._io.readS4le(),this.tcx=this._io.readS4le(),this.tay=this._io.readS4le(),this.tby=this._io.readS4le(),this.tcy=this._io.readS4le(),this.fDoubleSide=0!=this._io.readBitsIntLe(1),this.fDarkBack=0!=this._io.readBitsIntLe(1),this.fOpacity=0!=this._io.readBitsIntLe(1),this.fTransparent=0!=this._io.readBitsIntLe(1),this.fMortal=0!=this._io.readBitsIntLe(1),this.fPhong=0!=this._io.readBitsIntLe(1),this.fEnvmap=0!=this._io.readBitsIntLe(1),this.fNeedvc=0!=this._io.readBitsIntLe(1),this.fUnused=this._io.readBitsIntLe(7),this.fDarkFront=0!=this._io.readBitsIntLe(1),this._io.alignToByte(),this.dMask=this._io.readU2le(),this.distant=this._io.readS4le(),this.next=this._io.readU4le(),this.group=this._io.readU4le(),this.reserved=this._io.readBytes(12)},t}()},"function"===typeof n&&n.amd?n(["kaitai-struct/KaitaiStream"],a):t.exports?t.exports=a(i(20)):r.Face=a(r.KaitaiStream)},170:function(t,e,i){var r,a,n=void 0;r=this,a=function(t){return function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}t.prototype._read=function(){this.heightMap=new Array(this.mapSize*this.mapSize);for(var t=0;t<this.mapSize*this.mapSize;t++)this.heightMap[t]=this._io.readU1();for(this.textureMap1=new Array(this.mapSize*this.mapSize),t=0;t<this.mapSize*this.mapSize;t++)switch(this.version){case 1:this.textureMap1[t]=this._io.readU1();break;case 2:this.textureMap1[t]=this._io.readU2le()}for(this.textureMap2=new Array(this.mapSize*this.mapSize),t=0;t<this.mapSize*this.mapSize;t++)switch(this.version){case 1:this.textureMap2[t]=this._io.readU1();break;case 2:this.textureMap2[t]=this._io.readU2le()}for(this.objectMap=this._io.readBytes(this.mapSize*this.mapSize),this.flagsMap=new Array(this.mapSize*this.mapSize),t=0;t<this.mapSize*this.mapSize;t++)switch(this.version){case 1:this.flagsMap[t]=new e(this._io,this,this._root);break;case 2:this.flagsMap[t]=new i(this._io,this,this._root)}2==this.version&&(this.dawnLightMap=this._io.readBytes(this.mapSize*this.mapSize)),this.dayLightMap=this._io.readBytes(this.mapSize*this.mapSize),2==this.version&&(this.nightLightMap=this._io.readBytes(this.mapSize*this.mapSize)),this.waterMap=this._io.readBytes(this.mapSize*this.mapSize),this.objectHeightMap=this._io.readBytes(this.mapSize*this.mapSize),this.fogsMap=this._io.readBytes(Math.floor(this.mapSize*this.mapSize/4)),this.ambientMap=this._io.readBytes(Math.floor(this.mapSize*this.mapSize/4))};var e=t.FlagsV1=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.fTexDirection=this._io.readBitsIntLe(2),this.fModelDirection=this._io.readBitsIntLe(3),this.fNoWay=0!=this._io.readBitsIntLe(1),this.fReverse=0!=this._io.readBitsIntLe(1),this.fWater=0!=this._io.readBitsIntLe(1)},t}(),i=t.FlagsV2=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.fTexDirection=this._io.readBitsIntLe(2),this.fModelDirection=this._io.readBitsIntLe(2),this.fReverse=0!=this._io.readBitsIntLe(1),this.fNoWay=0!=this._io.readBitsIntLe(1),this.unused1=0!=this._io.readBitsIntLe(1),this.fWater=0!=this._io.readBitsIntLe(1),this.fTex2Direction=this._io.readBitsIntLe(2),this.unused2=this._io.readBitsIntLe(5),this.fWater2=0!=this._io.readBitsIntLe(1)},t}();return Object.defineProperty(t.prototype,"mapSize",{get:function(){return void 0!==this._m_mapSize||(this._m_mapSize=512*this.version),this._m_mapSize}}),Object.defineProperty(t.prototype,"yScale",{get:function(){return void 0!==this._m_yScale||(this._m_yScale=32*this.version),this._m_yScale}}),Object.defineProperty(t.prototype,"version",{get:function(){return void 0!==this._m_version||(this._m_version=2228224==this._io.size?1:14155776==this._io.size?2:0),this._m_version}}),Object.defineProperty(t.prototype,"tileSize",{get:function(){return void 0!==this._m_tileSize||(this._m_tileSize=256),this._m_tileSize}}),Object.defineProperty(t.prototype,"isValid",{get:function(){return void 0!==this._m_isValid||(this._m_isValid=1==this.version||2==this.version),this._m_isValid}}),t}()},"function"===typeof n&&n.amd?n(["kaitai-struct/KaitaiStream"],a):t.exports?t.exports=a(i(20)):r.Map=a(r.KaitaiStream)},171:function(t,e,i){var r,a,n=void 0;r=this,a=function(t,e){return function(){function t(t,e,i,r){this._io=t,this._parent=e,this._root=i||this,this.version=r,this._read()}t.AudioReverb=Object.freeze({GENERIC:0,PLATE:1,FOREST:2,MOUNTAIN:3,CANYON:4,CAVE:5,SPECIAL2:6,UNUSED:7,0:"GENERIC",1:"PLATE",2:"FOREST",3:"MOUNTAIN",4:"CANYON",5:"CAVE",6:"SPECIAL2",7:"UNUSED"}),t.prototype._read=function(){this.textureCount=this._io.readU4le(),this.modelCount=this._io.readU4le(),2==this.version&&(this.dawnSkyRgb=new i(this._io,this,this._root)),this.daySkyRgb=new i(this._io,this,this._root),2==this.version&&(this.nightSkyRgb=new i(this._io,this,this._root)),2==this.version&&(this.dawnSkyTRgb=new i(this._io,this,this._root)),this.daySkyTRgb=new i(this._io,this,this._root),2==this.version&&(this.nightSkyTRgb=new i(this._io,this,this._root)),this.textures=new Array(this.textureCount);for(var t=0;t<this.textureCount;t++)this.textures[t]=new c(this._io,this,this._root);for(this.models=new Array(this.modelCount),t=0;t<this.modelCount;t++)this.models[t]=new r(this._io,this,this._root);for(2==this.version&&(this.dawnSkyTexture=this._io.readBytes(this.skyTextureWidth*this.skyTextureHeight*2)),this.daySkyTexture=this._io.readBytes(this.skyTextureWidth*this.skyTextureHeight*2),2==this.version&&(this.nightSkyTexture=this._io.readBytes(this.skyTextureWidth*this.skyTextureHeight*2)),this.cloudsMap=this._io.readBytes(16384),this.fogCount=this._io.readU4le(),this.fogList=new Array(this.fogCount),t=0;t<this.fogCount;t++)this.fogList[t]=new o(this._io,this,this._root);for(this.randomSoundCount=this._io.readU4le(),this.randomSounds=new Array(this.randomSoundCount),t=0;t<this.randomSoundCount;t++)this.randomSounds[t]=new u(this._io,this,this._root);for(this.ambientSoundCount=this._io.readU4le(),this.ambientSounds=new Array(this.ambientSoundCount),t=0;t<this.ambientSoundCount;t++)this.ambientSounds[t]=new h(this._io,this,this._root);if(2==this.version&&(this.waterCount=this._io.readU4le()),2==this.version)for(this.waters=new Array(this.waterCount),t=0;t<this.waterCount;t++)this.waters[t]=new s(this._io,this,this._root)};var i=t.Rgb=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.r=this._io.readU4le(),this.g=this._io.readU4le(),this.b=this._io.readU4le()},t}(),r=t.Model=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.radius=this._io.readS4le(),this.yLo=this._io.readS4le(),this.yHi=this._io.readS4le(),this.lineLength=this._io.readS4le(),this.lIntensity=this._io.readS4le(),this.circleRad=this._io.readS4le(),this.cIntensity=this._io.readS4le(),this.fPlaceWater=0!=this._io.readBitsIntLe(1),this.fPlaceGround=0!=this._io.readBitsIntLe(1),this.fPlaceUser=0!=this._io.readBitsIntLe(1),this.fCircle=0!=this._io.readBitsIntLe(1),this.fBound=0!=this._io.readBitsIntLe(1),this.fNoBmp=0!=this._io.readBitsIntLe(1),this.fNoLight=0!=this._io.readBitsIntLe(1),this.fDefaultLight=0!=this._io.readBitsIntLe(1),this.fGroundLight=0!=this._io.readBitsIntLe(1),this.fNoSoft=0!=this._io.readBitsIntLe(1),this.fNoSoft2=0!=this._io.readBitsIntLe(1),this.fUnused=this._io.readBitsIntLe(20),this.fIsAnimated=0!=this._io.readBitsIntLe(1),this._io.alignToByte(),this.grRad=this._io.readS4le(),this.refLight=this._io.readS4le(),this.lastAniTime=this._io.readU4le(),this.boundR=this._io.readF4le(),this.reserved=this._io.readBytes(16),this.model=new e(this._io,this,null),2==this._root.version&&(this.billboard=new c(this._io,this,this._root)),this.fIsAnimated&&(this.animation=new n(this._io,this,this._root))},t}(),a=t.Trd=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.rNumber=this._io.readU4le(),this.rVolume=this._io.readU4le(),this.rFrequency=this._io.readU4le(),this.rEnvironment=this._io.readU2le(),this.rfNotAtNight=0!=this._io.readBitsIntLe(1),this.rfUnused=this._io.readBitsIntLe(15)},t}(),n=t.ModelAnimation=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.vc0=this._io.readU4le(),this.vc1=this._io.readU4le(),this.vc2=this._io.readU4le(),this.kps=this._io.readU4le(),this.frameCount=this._io.readU4le(),this.frames=new Array(3*this.frameCount*this.vc1);for(var t=0;t<3*this.frameCount*this.vc1;t++)this.frames[t]=this._io.readS2le()},t}(),s=t.Water=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.textureIndex=this._io.readU4le(),this.level=this._io.readU4le(),this.opacity=this._io.readF4le(),this.fogRgb=this._io.readU4le()},t}(),o=t.FogEntry=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.fogRgb=this._io.readU4le(),this.yBegin=this._io.readF4le(),this.mortal=this._io.readU4le(),this.transp=this._io.readF4le(),this.fLimit=this._io.readF4le()},t}(),h=t.AmbientSound=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.pcmSize=this._io.readU4le(),this.pcm=this._io.readBytes(this.pcmSize),this.rData=new Array(16);for(var t=0;t<16;t++)this.rData[t]=new a(this._io,this,this._root);this.rsfxCount=this._io.readU4le(),this.aVolume=this._io.readU4le()},t}(),u=t.RandomSound=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.pcmSize=this._io.readU4le(),this.pcm=this._io.readBytes(this.pcmSize)},t}(),c=t.Texture=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.data=this._io.readBytes(this.width*this.height*2)},Object.defineProperty(t.prototype,"width",{get:function(){return void 0!==this._m_width||(this._m_width=128),this._m_width}}),Object.defineProperty(t.prototype,"height",{get:function(){return void 0!==this._m_height||(this._m_height=128),this._m_height}}),t}();return Object.defineProperty(t.prototype,"skyTextureWidth",{get:function(){return void 0!==this._m_skyTextureWidth||(this._m_skyTextureWidth=256),this._m_skyTextureWidth}}),Object.defineProperty(t.prototype,"skyTextureHeight",{get:function(){return void 0!==this._m_skyTextureHeight||(this._m_skyTextureHeight=256),this._m_skyTextureHeight}}),t}()},"function"===typeof n&&n.amd?n(["kaitai-struct/KaitaiStream","./C3df"],a):t.exports?t.exports=a(i(20),i(110)):r.Rsc=a(r.KaitaiStream,r.C3df)},174:function(t,e,i){var r,a,n=void 0;r=this,a=function(t,e,i,r){return function(){function a(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}a.prototype._read=function(){this.name=t.bytesToStr(t.bytesTerminate(this._io.readBytes(24),0,!1),"utf8"),this.msc=t.bytesToStr(t.bytesTerminate(this._io.readBytes(8),0,!1),"utf8"),this.animationCount=this._io.readU4le(),this.soundEffectCount=this._io.readU4le(),this.vertCount=this._io.readU4le(),this.faceCount=this._io.readU4le(),this.textureSize=this._io.readU4le(),this.faces=new Array(this.faceCount);for(var r=0;r<this.faceCount;r++)this.faces[r]=new i(this._io,this,null);for(this.vertices=new Array(this.vertCount),r=0;r<this.vertCount;r++)this.vertices[r]=new e(this._io,this,null);for(this.textureData=this._io.readBytes(this.textureSize),this.animations=new Array(this.animationCount),r=0;r<this.animationCount;r++)this.animations[r]=new s(this._io,this,this._root);for(this.soundEffects=new Array(this.soundEffectCount),r=0;r<this.soundEffectCount;r++)this.soundEffects[r]=new n(this._io,this,this._root);for(this.animSoundMap=[],r=0;!this._io.isEof();)this.animSoundMap.push(this._io.readS4le()),r++};var n=a.SoundEffect=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.name=t.bytesToStr(t.bytesTerminate(this._io.readBytes(32),0,!1),"utf8"),this.pcmLength=this._io.readU4le(),this.pcm=this._io.readBytes(this.pcmLength)},e}(),s=a.Animation=function(){function e(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return e.prototype._read=function(){this.name=t.bytesToStr(t.bytesTerminate(this._io.readBytes(32),0,!1),"utf8"),this.framesPerSecond=this._io.readU4le(),this.frameCount=this._io.readU4le(),this.frames=new Array(this.frameCount);for(var e=0;e<this.frameCount;e++)this.frames[e]=new o(this._io,this,this._root)},e}(),o=a.Frame=function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.vertices=new Array(this._root.vertCount);for(var t=0;t<this._root.vertCount;t++)this.vertices[t]=new r(this._io,this,null)},t}();return Object.defineProperty(a.prototype,"textureWidth",{get:function(){return void 0!==this._m_textureWidth||(this._m_textureWidth=256),this._m_textureWidth}}),Object.defineProperty(a.prototype,"textureHeight",{get:function(){return void 0!==this._m_textureHeight||(this._m_textureHeight=Math.floor(Math.floor(this.textureSize/2)/this.textureWidth)),this._m_textureHeight}}),a}()},"function"===typeof n&&n.amd?n(["kaitai-struct/KaitaiStream","./Vertex","./Face","./Ivector"],a):t.exports?t.exports=a(i(20),i(164),i(165),i(372)):r.Car=a(r.KaitaiStream,r.Vertex,r.Face,r.Ivector)},176:function(t,e,i){var r,a,n;a=[i(20)],void 0===(n="function"===typeof(r=function(t){return function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.heightMap=this._io.readBytes(this.mapSize*this.mapSize),this.textureMap1=new Array(this.mapSize*this.mapSize);for(var t=0;t<this.mapSize*this.mapSize;t++)switch(this.isV1){case!0:this.textureMap1[t]=this._io.readU1();break;case!1:this.textureMap1[t]=this._io.readU2le()}for(this.textureMap2=new Array(this.mapSize*this.mapSize),t=0;t<this.mapSize*this.mapSize;t++)switch(this.isV1){case!0:this.textureMap2[t]=this._io.readU1();break;case!1:this.textureMap2[t]=this._io.readU2le()}for(this.objectMap=this._io.readBytes(this.mapSize*this.mapSize),this.flagsMap=new Array(this.mapSize*this.mapSize),t=0;t<this.mapSize*this.mapSize;t++)switch(this.isV1){case!0:this.flagsMap[t]=this._io.readU1();break;case!1:this.flagsMap[t]=this._io.readU2le()}this.isV1&&(this.lightMap=this._io.readBytes(this.mapSize*this.mapSize)),this.isV2&&(this.dawnLightMap=this._io.readBytes(this.mapSize*this.mapSize)),this.isV2&&(this.dayLightMap=this._io.readBytes(this.mapSize*this.mapSize)),this.isV2&&(this.nightLightMap=this._io.readBytes(this.mapSize*this.mapSize)),this.waterMap=this._io.readBytes(this.mapSize*this.mapSize),this.objectHeightMap=this._io.readBytes(this.mapSize*this.mapSize),this.fogsMap=this._io.readBytes(Math.floor(this.mapSize*this.mapSize/4)),this.ambientMap=this._io.readBytes(Math.floor(this.mapSize*this.mapSize/4))},Object.defineProperty(t.prototype,"isV1",{get:function(){return void 0!==this._m_isV1||(this._m_isV1=2228224==this._io.size),this._m_isV1}}),Object.defineProperty(t.prototype,"isV2",{get:function(){return void 0!==this._m_isV2||(this._m_isV2=14155776==this._io.size),this._m_isV2}}),Object.defineProperty(t.prototype,"isValid",{get:function(){return void 0!==this._m_isValid||(this._m_isValid=this.isV1||this.isV2),this._m_isValid}}),Object.defineProperty(t.prototype,"mapSize",{get:function(){return void 0!==this._m_mapSize||(this._m_mapSize=this.isV1?512:1024),this._m_mapSize}}),t}()})?r.apply(e,a):r)||(t.exports=n)},183:function(t,e,i){},323:function(t,e,i){},344:function(t,e){},345:function(t,e){},348:function(t,e){},350:function(t,e){},372:function(t,e,i){var r,a,n=void 0;r=this,a=function(t){return function(){function t(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._read()}return t.prototype._read=function(){this.ix=this._io.readS2le(),this.iy=this._io.readS2le(),this.iz=this._io.readS2le()},Object.defineProperty(t.prototype,"x",{get:function(){return void 0!==this._m_x||(this._m_x=this.ix/16),this._m_x}}),Object.defineProperty(t.prototype,"y",{get:function(){return void 0!==this._m_y||(this._m_y=this.iy/16),this._m_y}}),Object.defineProperty(t.prototype,"z",{get:function(){return void 0!==this._m_z||(this._m_z=this.iz/16),this._m_z}}),t}()},"function"===typeof n&&n.amd?n(["kaitai-struct/KaitaiStream"],a):t.exports?t.exports=a(i(20)):r.Ivector=a(r.KaitaiStream)},373:function(t,e,i){},376:function(t,e,i){"use strict";i.r(e);var r=i(0),a=i.n(r),n=i(54),s=i.n(n),o=(i(183),i(177)),h=i(16),u=i(12),c=i(35),d=(i(152),i(323),i(380)),f=i(381),l=i(378),p=i(11),m=i(21),_=i.n(m),v=i(40),y=i(20),b=i.n(y),g=i(5),x=i(170),S=i.n(x),j=i(171),w=i.n(j);function O(t,e,i,r,a){var n=e*r+t,s=i[2*n+1]<<8|i[2*n];return((s>>>10&31)<<11)+((s>>>5&31)<<6)+((s>>>0&31)<<1)|(a?s?1:0:1)}function z(t,e,i){for(var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=new Uint16Array(e*i),n=0,s=0;s<i;s++)for(var o=0;o<e;o++)a[n++]=O(o,s,t,e,r);var h=new g.DataTexture(a,e,i,g.RGBAFormat,g.UnsignedShort5551Type);return h}function M(t){var e=t.mapSize,i=[];function r(e,i){return t.heightMap[i*t.mapSize+e]*t.yScale}for(var a=0;a<e;a++)for(var n=0;n<e;n++){254===t.objectMap[a*e+n]&&i.push(new g.Vector3(n*t.tileSize,r(n,a),a*t.tileSize))}return i}function A(){return(A=Object(v.a)(_.a.mark((function t(e,i){var r,a,n,s,o,h,u,c,d,f,l,p,m,v,y,x,j,z;return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return z=function(t,e){return Math.max(x(t,e),x(t-90,e-90),x(t+90,e-90),x(t-90,e+90),x(t+90,e+90),x(t+128,e),x(t-128,e),x(t,e+128),x(t,e-128))},j=function(t,e,i){var r,a;return t=t*n.tileSize+n.tileSize/2,e=e*n.tileSize+n.tileSize/2,r=x(t,e),(a=x(t+i,e))<r&&(r=a),(a=x(t-i,e))<r&&(r=a),(a=x(t,e+i))<r&&(r=a),(a=x(t,e-i))<r&&(r=a),r+=15,Math.floor(r/n.yScale+48)},x=function(t,e){var i=n.tileSize,r=n.mapSize,a=1===n.version?"waterMap":"heightMap",s=1===n.version?48:0;t<0&&(t=0),e<0&&(e=0);var o=Math.floor(t/i),h=Math.floor(e/i),u=Math.floor(t%i),c=Math.floor(e%i),d=n[a][h*r+o],f=n[a][h*r+o+1],l=n[a][(h+1)*r+o+1],p=n[a][(h+1)*r+o];return n.flagsMap[h*r+o].fReverse?256-u>c?l=f+p-d:d=f+p-l:u>c?p=d+l-f:f=d+l-p,(((d*(256-u)+f*u)*(256-c)+(p*(256-u)+l*u)*c)/256/256-s)*n.yScale},t.next=5,fetch(e).then((function(t){return t.arrayBuffer()}));case 5:return r=t.sent,t.next=8,fetch(i).then((function(t){return t.arrayBuffer()}));case 8:for(a=t.sent,n=new S.a(new b.a(r)),s=new w.a(new b.a(a),void 0,void 0,n.version),console.log(s,n),o=M(n),h=n.mapSize/2,u=new Uint16Array(h*h),c=0,l=0;l<h;l++)for(p=0;p<h;p++)m=n.textureMap1[2*l*n.mapSize+2*p],d=0===m?4*(31&p):8*(15&p),f=0===m?4*(31&l):8*(15&l),v=s.textures[m],u[c++]=O(d,f,v.data,v.width,!1);return(y=new g.DataTexture(u,h,h,g.RGBAFormat,g.UnsignedShort5551Type)).flipY=!0,t.abrupt("return",{map:n,rsc:s,landings:o,miniMap:y,getHeightAt:z,getLandQHNoObj:z,getLandH:x,getObjectH:j});case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var U=i(1),C=i(3),B=i(4),T=function(t){Object(C.a)(i,t);var e=Object(B.a)(i);function i(t){var r,a=t.vertexMap,n=t.fragmentMap,s=t.mapSize,o=t.version,h=t.yScale,u=t.textureArray,c=t.heightmapMatrix;return Object(U.a)(this,i),(r=e.call(this,{map:u,fog:!0})).defines={MAP_SIZE:"".concat(s,".0"),CARNIVORES:o,MAP_HSCALE:"".concat(h,".0")},r.onBeforeCompile=function(t){t.uniforms.vertexMap={value:a},t.uniforms.fragmentMap={value:n},t.uniforms.heightmapMatrix={value:c};var e=t.vertexShader;e=(e=(e=e.replace("#include <common>","\n                precision highp usampler2D;\n                uniform usampler2D vertexMap;\n                uniform mat4 heightmapMatrix;\n                varying vec4 vLighting;\n                #include <common>\n            ")).replace("#include <color_vertex>","\n            vUv = (heightmapMatrix * modelMatrix * vec4(position, 1.0)).xz;\n            uvec4 tex = texture(vertexMap, vUv);\n            #if CARNIVORES == 1\n            float light = 1.0 - (float(tex.g) / 64.0);\n            #else\n            float light = float(tex.g) / 255.0;\n            #endif\n            vLighting = vec4(light, light, light, 1.0);\n            #include <color_vertex>\n            ")).replace("#include <begin_vertex>","\n            #include <begin_vertex>\n            transformed.y += float(tex.r) * MAP_HSCALE;\n            "),t.vertexShader=e;var i=t.fragmentShader;i=(i=i.replace("#include <map_pars_fragment>","\n            precision highp sampler2DArray;\n            precision highp usampler2D;\n            uniform sampler2DArray map;\n            uniform usampler2D fragmentMap;\n            varying vec4 vLighting;\n\n            vec2 rotateUV(vec2 uv, uint rot) {\n#if 0\n                switch(rot) {\n                    case 0u:\n                        //diffuseColor = vec4(1.0, 1.0, 1.0, 1.0);\n                        break;\n                    case 1u:\n                        float t = uv.x;\n                        uv.x = uv.y;\n                        uv.y = 1.0 - t;\n                        //diffuseColor = vec4(0.5, 0.0, 0.0, 1.0);\n                        break;\n                    case 2u:\n                        uv.x = 1.0 - uv.x;\n                        uv.y = 1.0 - uv.y;\n                        //diffuseColor = vec4(0.5, 0.5, 0.0, 1.0);\n                        break;\n                    case 3u:\n                        float x = uv.x;\n                        uv.x = 1.0 - uv.y;\n                        uv.y = x;\n                        //diffuseColor = vec4(0.0, 0.0, 1.0, 1.0);\n                    break;\n                }\n#else                \n                float mid = 0.5;\n                float rotation = float(rot);\n                float cos_ = cos(PI / 2. * rotation);\n                float sin_ = sin(PI / 2. * rotation);\n                return vec2(\n                    cos_ * (uv.x - mid) + sin_ * (uv.y - mid) + mid,\n                    cos_ * (uv.y - mid) - sin_ * (uv.x - mid) + mid\n                );\n#endif\n            }\n            ")).replace("#include <map_fragment>","\n            vec2 tilePos = vUv * MAP_SIZE;\n            vec2 localTileUv = tilePos - floor(tilePos);\n            uvec4 tex = texture(fragmentMap, vUv);\n            diffuseColor = vLighting;\n            localTileUv = rotateUV(localTileUv, tex.b & 3u);\n            uint depth = tex.r;\n            #if CARNIVORES == 1\n            float triside = ((1.0-localTileUv.x) - localTileUv.y);\n            if (triside >= 0.0) {\n                depth = (tex.b & 64u) != 0u ? tex.r : tex.g;\n            } else {\n                depth = (tex.b & 64u) != 0u ? tex.g : tex.r;\n            }\n            #endif\n            #ifdef DEBUG_REVERSE_FLAG\n            if ((tex.b & 64u) != 0u) {\n                diffuseColor = vec4(0.6, 0.6, 0.6, 1.0);\n            } else {\n                diffuseColor = vec4(1.0, 1.0, 1.0, 1.0);\n            }\n            #endif\n            vec4 texelColor = texture( map, vec3(localTileUv, depth) );\n            texelColor = mapTexelToLinear( texelColor );\n            diffuseColor *= texelColor;\n            //diffuseColor = vec4(localTileUv, 0.0, 1.0);\n            "),t.fragmentShader=i},r}return i}(g.MeshBasicMaterial),D=i(6);var L=function(t){var e=t.rsc,i=t.map,r=t.viewDistance,n=(void 0===r&&i.mapSize,t.position),s=void 0===n?[0,0,0]:n,o=a.a.useMemo((function(){var t=i.mapSize,r=i.version,a=i.yScale,n=function(t){for(var e=new Uint8Array(t.mapSize*t.mapSize*2),i=0;i<t.mapSize*t.mapSize;i++)e[2*i+0]=t.heightMap[i],e[2*i+1]=t.dayLightMap[i];var r=new g.DataTexture(e,t.mapSize,t.mapSize,g.RGIntegerFormat,g.UnsignedByteType);return r.internalFormat="RG8UI",r}(i),s=function(t){for(var e=new Uint8Array(t.mapSize*t.mapSize*3),i=0;i<t.mapSize*t.mapSize;i++){var r=t.flagsMap[i];e[3*i+0]=t.textureMap1[i],e[3*i+1]=t.textureMap2[i],e[3*i+2]=r.fTexDirection|r.fReverse<<6}var a=new g.DataTexture(e,t.mapSize,t.mapSize,g.RGBIntegerFormat,g.UnsignedByteType);return a.internalFormat="RGB8UI",a}(i),o=function(t){for(var e=new Uint16Array(t.textureCount*t.textures[0].width*t.textures[0].height),i=0,r=0;r<t.textureCount;r++)for(var a=0;a<t.textures[0].width*t.textures[0].height;a++){var n=t.textures[r].data[2*a+1]<<8|t.textures[r].data[2*a],s=n>>10&31,o=(n>>5&31)<<1,h=n>>0&31;e[i++]=(s<<11)+(o<<5)+h}var u=new g.DataTexture2DArray(e,t.textures[0].width,t.textures[0].height,t.textureCount);return u.type=g.UnsignedShort565Type,u.format=g.RGBFormat,u.wrapT=u.wrapS=g.RepeatWrapping,u}(e),h=(new g.Matrix4).makeScale(1/(i.mapSize*i.tileSize),1,1/(i.mapSize*i.tileSize));return new T({vertexMap:n,fragmentMap:s,mapSize:t,version:r,yScale:a,textureArray:o,heightmapMatrix:h})}),[i,e]),h=a.a.useMemo((function(){var t=new g.PlaneBufferGeometry(i.mapSize*i.tileSize,i.mapSize*i.tileSize,i.mapSize-1,i.mapSize-1);return t.rotateX(-Math.PI/2),t.translate(i.mapSize*i.tileSize/2,0,i.mapSize*i.tileSize/2),t}),[i.mapSize,i.tileSize]);return Object(D.jsx)("mesh",{position:s,geometry:h,material:o})},k={forward:!1,backward:!1,left:!1,right:!1,run:!1};function I(t){var e="keydown"===t.type;switch(t.key.toLowerCase()){case"w":k.forward=e;break;case"s":k.backward=e;break;case"a":k.left=e;break;case"d":k.right=e;break;case"shift":k.run=e;break;default:return void console.log(t.key,e)}t.preventDefault()}function R(t){var e=t.getHeightAt,i=t.landings,r=a.a.useRef(new g.Vector3),n=a.a.useRef(!0);a.a.useEffect((function(){return document.addEventListener("keydown",I),document.addEventListener("keyup",I),function(){document.removeEventListener("keydown",I),document.removeEventListener("keyup",I)}}));var s=new g.Vector3,o=new g.Vector3,h=a.a.useMemo((function(){return n.current=!0,i[Math.floor(i.length*Math.random())]}),[i]),u=new g.Clock;return Object(p.e)((function(t){var i=t.camera,a=u.getDelta(),c=r.current;n.current&&(i.position.copy(h),n.current=!1),c.x-=10*c.x*a,c.z-=10*c.z*a,c.y-=9.8*100*a,s.z=Number(k.forward)-Number(k.backward),s.x=Number(k.right)-Number(k.left),s.normalize();var d=7e3*(k.run?4:1);(k.forward||k.backward)&&(c.z-=s.z*d*a),(k.left||k.right)&&(c.x-=s.x*d*a),o.setFromMatrixColumn(i.matrix,0),i.position.addScaledVector(o,-c.x*a),o.setFromMatrixColumn(i.matrix,0),o.crossVectors(i.up,o),i.position.addScaledVector(o,-c.z*a),i.position.y+=c.y*a;var f=e(i.position.x,i.position.z);i.position.y<f+220&&(c.y=0,i.position.y=f+220)})),null}var E=function(t){var e=t.map,i=t.rsc,r=t.clipFar,n=a.a.useRef(),s=a.a.useMemo((function(){var t=z(i.daySkyTexture,i.skyTextureWidth,i.skyTextureHeight);return t.wrapS=t.wrapT=g.RepeatWrapping,t.anisotropy=16,t.repeat.set(10,10),t}),[i]),o=e.mapSize*e.tileSize/2;return Object(p.e)((function(t){var e,i=t.camera;s.offset.x+=2e-4,null===(e=n.current)||void 0===e||e.position.set(i.position.x,0,i.position.z)})),Object(D.jsxs)("mesh",{ref:n,position:[o,0,o],children:[Object(D.jsx)("sphereBufferGeometry",{args:[r-r/100]}),Object(D.jsx)("meshBasicMaterial",{map:s,side:g.DoubleSide,fog:!1})]})},P=i(2),F=i(110),N=i.n(F),H=function(t){Object(C.a)(i,t);var e=Object(B.a)(i);function i(){return Object(U.a)(this,i),e.apply(this,arguments)}return Object(P.a)(i,[{key:"load",value:function(t,e,i,r){var a=this;fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){e(a.parse(t))})).catch((function(t){r(t)}))}},{key:"parse",value:function(t){var e=new N.a(new b.a(t));return this._parse(e)}},{key:"_parse",value:function(t){var e=t.faces,i=t.vertices,r=t.textureWidth,a=t.textureHeight,n=[],s=[];e.forEach((function(t){var e=t.v1,o=t.v2,h=t.v3;n.push(2*i[e].x,2*i[e].y,2*i[e].z),s.push(t.tax/r,t.tay/a),n.push(2*i[o].x,2*i[o].y,2*i[o].z),s.push(t.tbx/r,t.tby/a),n.push(2*i[h].x,2*i[h].y,2*i[h].z),s.push(t.tcx/r,t.tcy/a)}));var o=new g.BufferGeometry;o.setAttribute("position",new g.Float32BufferAttribute(n,3)),o.setAttribute("uv",new g.Float32BufferAttribute(s,2)),o.computeVertexNormals();var h=z(t.textureData,t.textureWidth,t.textureHeight,!0),u=new g.MeshBasicMaterial({map:h,side:g.DoubleSide,alphaTest:.5,transparent:!0});return new g.Mesh(o,u)}}]),i}(g.Loader);var V=function(t){var e=t.map,i=t.rsc,r=t.getHeightAt,n=a.a.useMemo((function(){for(var t=e.objectHeightMap,a=e.flagsMap,n=e.mapSize,s=e.objectMap,o=e.tileSize,h=o/2,u=1===e.version?8:4,c=new g.Group,d=[],f=new g.Matrix4,l=new g.Matrix4,p=0;p<n;p++)for(var m=0;m<n;m++){var _=s[p*n+m];if(_<254){var v=m*o+h,y=p*o+h,b=0,x=i.models[_];x.fPlaceWater||(x.fPlaceGround?b=r(m,p,x.grRad):x.fPlaceUser?b=t[p*n+m]+48:console.log("HUH?",m,p,_)),b=(-48+b)*e.yScale,l.makeRotationY(2*a[p*n+m].fModelDirection*Math.PI/u),f.makeTranslation(v,b,y),f.multiply(l),d[_]?d[_].push.apply(d[_],f.toArray()):d[_]=f.toArray()}}var S=new H;return i.models.forEach((function(t,e){if(d[e]){for(var i=d[e].length/16,r=S._parse(t.model),a=r.geometry,n=r.material,s=new g.InstancedMesh(a,n,i),o=0;o<i;o++)f.fromArray(d[e],16*o),s.setMatrixAt(o,f);c.add(s)}})),c}),[i,e,r]);return Object(D.jsx)("primitive",{object:n})},W=i(377),G=i(174),K=i.n(G),q=function(t){Object(C.a)(i,t);var e=Object(B.a)(i);function i(){return Object(U.a)(this,i),e.apply(this,arguments)}return Object(P.a)(i,[{key:"load",value:function(t,e,i,r){var a=this;fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){e(a.parse(t))})).catch((function(t){r(t)}))}},{key:"parse",value:function(t){for(var e,i,r=new K.a(new b.a(t)),a=r.animations.flatMap((function(t){return t.frames})),n=new Array(a.length),s=[],o=[],h=r.textureWidth,u=r.textureHeight,c=r.faces,d=r.vertices,f=0;f<a.length;f++)n[f]=new Array;function l(t,e,i){var r=d[t],h=r.x,u=r.y,c=r.z;h*=2,u*=2,c*=2,s.push(h,u,c),o.push(e,i),a.forEach((function(e,i){n[i].push(2*e.vertices[t].x,2*e.vertices[t].y,2*e.vertices[t].z)}))}c.forEach((function(t){var e=t.v1,i=t.v2,r=t.v3;l(e,t.tax/h,t.tay/u),l(i,t.tbx/h,t.tby/u),l(r,t.tcx/h,t.tcy/u)}));var p=new g.BufferGeometry;p.setAttribute("position",new g.Float32BufferAttribute(s,3)),p.setAttribute("uv",new g.Float32BufferAttribute(o,2)),p.morphAttributes.position=[];var m=0;null===(e=r.animations)||void 0===e||e.forEach((function(t){var e=t.name;t.frames.forEach((function(t,i){var r=new g.Float32BufferAttribute(n[m],3);r.name="".concat(e,".").concat(i),p.morphAttributes.position.push(r),++m}))}));var _=new g.MeshBasicMaterial({map:z(r.textureData,r.textureWidth,r.textureHeight,!1),side:g.DoubleSide}),v=new g.Mesh(p,_);return null===(i=r.animations)||void 0===i||i.forEach((function(t){for(var e=[],i=0;i<t.frameCount;i++)e.push({name:"".concat(t.name,".").concat(i),vertices:[]});var r=g.AnimationClip.CreateFromMorphTargetSequence(t.name,e,t.framesPerSecond,!1);v.animations.push(r)})),v}}]),i}(g.Loader);var Y=function(t){var e=t.miniMap,i=Object(p.g)(),r=i.gl,n=i.scene,s=i.camera,o=i.size,h=a.a.useMemo((function(){return new g.Scene}),[]),u=a.a.useRef(),c=new g.Vector3,d=new g.Spherical,f=Object(p.f)(H,"HUNTDAT/COMPAS.3DF"),l=Object(p.f)(q,"HUNTDAT/WIND.CAR"),m=e.image,_=m.width,v=m.height;return Object(p.e)((function(){u.current&&(s.getWorldDirection(c),d.setFromVector3(c),f.rotation.y=d.theta+Math.PI,l.rotation.y=d.theta+Math.PI,r.autoClear=!0,r.render(n,s),r.autoClear=!1,r.clearDepth(),r.render(h,u.current))}),1),Object(p.d)(Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(W.a,{ref:u,makeDefault:!1,position:[0,0,220]}),Object(D.jsx)("primitive",{position:[-o.width/2+220,-o.height/2+120,0],"rotation-x":-Math.PI/8,scale:10,object:l}),Object(D.jsx)("primitive",{position:[o.width/2-220,-o.height/2+120,0],"rotation-x":-Math.PI/8,scale:10,object:f}),Object(D.jsxs)("mesh",{position:[o.width/2-_,0,-o.height/2+v],children:[Object(D.jsx)("planeBufferGeometry",{args:[_,v]}),Object(D.jsx)("meshBasicMaterial",{side:g.DoubleSide,map:e})]})]}),h)};function J(t){return Math.floor(t*Math.random())}function X(t){return(Math.random()-.5)*t}var Z=function(t){var e=t.map,i=t.rsc,r=Object(p.g)().camera,n=a.a.useState((function(){return new g.AudioListener})),s=Object(u.a)(n,1)[0],o=a.a.useState((function(){return{audio:new g.Audio(s),rAudio:new g.PositionalAudio(s),ambNo:-1,randomTime:0}})),h=Object(u.a)(o,1)[0];function c(t){for(var e=s.context.createBuffer(1,t.length/2,22050),i=e.getChannelData(0),r=new DataView(t.buffer,t.byteOffset,t.length),a=0;a<t.length/2;a++)i[a]=r.getInt16(2*a,!0)/32767;return e}return a.a.useEffect((function(){return h.audio.setLoop(!0),h.rAudio.setLoop(!1),h.rAudio.setRefDistance(75),r.add(s),r.add(h.rAudio),function(){h.ambNo=-1,h.audio.isPlaying&&h.audio.stop(),h.rAudio.isPlaying&&h.rAudio.stop(),r.remove(s)}})),Object(p.e)((function(t,r){var a=t.camera,n=Math.floor(a.position.x/(2*e.tileSize)),s=Math.floor(a.position.z/(2*e.tileSize));!function(t,e){var r=i.ambientSounds[t];if(h.ambNo!==t){if(console.log("Selecting ambient sound ".concat(t)),!r)return void console.error("Invalid ambient sound ".concat(t," selected"));var a=c(r.pcm);h.ambNo=t,h.randomTime=r.rData[0].rFrequency/2+J(r.rData[0].rFrequency),console.log(h.randomTime),h.audio.isPlaying&&h.audio.stop(),h.audio.setBuffer(a),h.audio.setVolume(r.aVolume/256),h.audio.play()}if(h.ambNo>=0&&r.rsfxCount>0&&(h.randomTime-=e,h.randomTime<=0)){h.randomTime=r.rData[0].rFrequency/2+J(r.rData[0].rFrequency),console.log(h.randomTime),console.log("Selecting random sound");var n=r.rData[J(r.rsfxCount)],s=c(i.randomSounds[n.rNumber].pcm);h.rAudio.position.set(X(4096),X(256),X(4096)),h.rAudio.setBuffer(s),h.rAudio.setVolume(n.rVolume),h.rAudio.play()}}(e.ambientMap[s*(e.mapSize/2)+n],r)})),null};var Q=function(t){var e=t.mapUrl,i=t.rscUrl,r=t.enableHUD,n=void 0===r||r,s=t.enableScenery,o=void 0===s||s,h=t.enableSky,c=void 0===h||h,m=t.enableAudio,_=void 0!==m&&m,v=t.clipFar,y=void 0===v?1e6:v,b=a.a.useState(),g=Object(u.a)(b,2),x=g[0],S=g[1];return a.a.useEffect((function(){(function(t,e){return A.apply(this,arguments)})(e,i).then((function(t){S(t)}))}),[e,i]),x?Object(D.jsx)(D.Fragment,{children:Object(D.jsxs)(p.a,{shadows:!0,linear:!0,camera:{fov:30,near:1,far:y},children:[Object(D.jsx)(d.a,{}),Object(D.jsx)(f.a,{}),Object(D.jsxs)(a.a.Suspense,{fallback:Object(D.jsx)(l.a,{center:!0,children:"Loading, please wait"}),children:[_&&Object(D.jsx)(Z,{rsc:x.rsc,map:x.map}),c&&Object(D.jsx)(E,{clipFar:y,rsc:x.rsc,map:x.map}),Object(D.jsx)(L,{rsc:x.rsc,map:x.map}),o&&Object(D.jsx)(V,{rsc:x.rsc,map:x.map,getHeightAt:x.getObjectH}),Object(D.jsx)(R,{landings:x.landings,getHeightAt:x.getHeightAt}),n&&Object(D.jsx)(Y,{miniMap:x.miniMap})]})]})}):Object(D.jsx)(D.Fragment,{})},$=["Basmachee Rocks","Fort Ciskin"],tt=[{map:"HUNTDAT/AREAS/AREA1.MAP",rsc:"HUNTDAT/AREAS/AREA1.RSC"},{map:"HUNTDAT/AREAS2/AREA2.MAP",rsc:"HUNTDAT/AREAS2/AREA2.RSC"}];function et(){var t=a.a.useState(tt[0]),e=Object(u.a)(t,2),i=e[0],r=e[1],n=a.a.useState({enableScenery:!0,enableSky:!0,enableHUD:!1,enableAudio:!1,levelName:$[0],renderDistance:16384}),s=Object(u.a)(n,2),o=s[0],h=s[1];return Object(D.jsxs)("div",{onDragOver:function(t){t.preventDefault()},onDrop:function(t){var e;if(t.preventDefault(),null===(e=t.dataTransfer.files)||void 0===e?void 0:e.length){for(var i=null,a=null,n=0;n<t.dataTransfer.files.length;n++){var s=t.dataTransfer.files[n];s.name.toUpperCase().endsWith(".MAP")?i=URL.createObjectURL(s):s.name.toUpperCase().endsWith(".RSC")&&(a=URL.createObjectURL(s))}i&&a&&r({map:i,rsc:a})}},className:"dndContainer",children:[Object(D.jsx)(Q,{mapUrl:i.map,rscUrl:i.rsc,enableHUD:o.enableHUD,enableScenery:o.enableScenery,enableSky:o.enableSky,enableAudio:o.enableAudio,clipFar:o.renderDistance}),Object(D.jsxs)(c.c,{data:o,onUpdate:function(t){if(o.levelName!==t.levelName){var e=$.indexOf(t.levelName);-1!==e&&r(tt[e])}h(t)},children:[Object(D.jsx)(c.a,{path:"enableScenery",label:"Objects"}),Object(D.jsx)(c.a,{path:"enableHUD",label:"HUD"}),Object(D.jsx)(c.a,{path:"enableSky",label:"Sky"}),Object(D.jsx)(c.a,{path:"enableAudio",label:"Audio"}),Object(D.jsx)(c.b,{path:"levelName",label:"Area",options:$})]})]})}var it=i(115),rt=function(t){Object(C.a)(i,t);var e=Object(B.a)(i);function i(){return Object(U.a)(this,i),e.apply(this,arguments)}return Object(P.a)(i,[{key:"parse",value:function(t){var e=new DataView(t);if(19778!==e.getUint16(0,!0))throw new Error("Invalid BMP signature");var i=e.getUint32(2,!0),r=e.getUint32(10,!0),a=e.getUint32(14,!0);if(40!==a)throw new Error("Unsupported DIB header size ".concat(a," in BMP"));var n=e.getInt32(18,!0),s=e.getInt32(22,!0),o=e.getUint16(26,!0);if(1!==o)throw new Error("Unsupported number of color planes ".concat(o," in BMP"));var h=e.getUint16(28,!0),u=e.getUint32(30,!0);if(0!==u)throw new Error("Unsupported compression method ".concat(u," in BMP"));var c=e.getUint32(46,!0);return console.log(n,s,h,c,i,r),{data:new Uint8ClampedArray,width:n,height:s,flipY:!0,generateMipmaps:!0,minFilter:g.LinearMipmapLinearFilter}}}]),i}(g.DataTextureLoader),at=function(t){Object(C.a)(i,t);var e=Object(B.a)(i);function i(){return Object(U.a)(this,i),e.apply(this,arguments)}return Object(P.a)(i,[{key:"load",value:function(t,e,i,r){var a=this;fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){e(a.parse(t))})).catch((function(t){r(t)}))}},{key:"parse",value:function(t){for(var e=new Uint8ClampedArray(t),i=[],r=[],a=[],n=[],s=[],o=0;o<300;o++)for(var h=0;h<400;h++){var u=e[400*o+h];void 0!==r[u]?r[u]=Math.min(h,r[u]):r[u]=h,void 0!==a[u]?a[u]=Math.max(h,a[u]):a[u]=h,void 0!==n[u]?n[u]=Math.min(o,n[u]):n[u]=o,void 0!==s[u]?s[u]=Math.max(o,s[u]):s[u]=o}return r.forEach((function(t,e){i.push({id:e,x:r[e],y:n[e],width:a[e]-r[e]+1,height:s[e]-n[e]+1})})),{map:e,areas:i}}}]),i}(g.Loader);function nt(t){var e=new Uint8ClampedArray(t.image.data.buffer,t.image.data.byteOffset,t.image.data.length);return new ImageData(e,t.image.width,t.image.height)}function st(){var t=nt(Object(p.f)(it.a,"HUNTDAT/MENU/OPT_OFF.TGA")),e=nt(Object(p.f)(it.a,"HUNTDAT/MENU/OPT_ON.TGA")),i=Object(p.f)(at,"HUNTDAT/MENU/OPT_MAP.RAW"),r=(Object(p.f)(rt,"HUNTDAT/MENU/LANDPIC/AREA1.BMP"),a.a.useRef(null)),n=-1;var s=a.a.useRef(null);a.a.useEffect((function(){s.current&&(r.current=s.current.getContext("2d"),r.current&&r.current.putImageData(t,0,0))}));return Object(D.jsx)("div",{style:{position:"relative"},children:Object(D.jsx)("canvas",{style:{height:"100%",width:"auto"},ref:s,width:"800",height:"600",onMouseMove:function(a){var s=function(t,e){var r=i.map[400*e+t];return r?i.areas[r]:null}(Math.floor(a.clientX/2),Math.floor(a.clientY/2));if(r.current&&n!==(null===s||void 0===s?void 0:s.id)){if(n>0){console.log("off ".concat(n));var o=i.areas[n];r.current.putImageData(t,0,0,2*o.x,2*o.y,2*o.width,2*o.height)}s?(console.log("on ".concat(s.id)),r.current.putImageData(e,0,0,2*s.x,2*s.y,2*s.width,2*s.height),n=s.id):n=-1}},onMouseDown:function(t){console.log("mouseDown",t)},onKeyDown:function(t){console.log("keyDown",t)}})})}function ot(){return Object(D.jsx)(a.a.Suspense,{fallback:null,children:Object(D.jsx)(st,{})})}var ht=i(176),ut=i.n(ht),ct=i(10),dt=i(19),ft=function(t){var e=t.drawContent,i=t.width,r=t.height,n=Object(dt.a)(t,["drawContent","width","height"]),s=a.a.useRef(null);return a.a.useEffect((function(){var t=s.current,a=null===t||void 0===t?void 0:t.getContext("2d");t&&a&&(void 0!==i&&(a.canvas.width=i),void 0!==r&&(a.canvas.height=r),e?e(a):(a.fillStyle="#000000",a.fillRect(0,0,a.canvas.width,a.canvas.height)))}),[e,r,i]),Object(D.jsx)("canvas",Object(ct.a)({ref:s},n))},lt=function(t,e){for(var i=new ImageData(t.mapSize,t.mapSize),r=0;r<t.mapSize*t.mapSize;r++)i.data[4*r+0]=t[e][r],i.data[4*r+1]=t[e][r],i.data[4*r+2]=t[e][r],i.data[4*r+3]=255;return i},pt=function(t){var e=t.value,i=void 0===e?0:e,r=t.bitCount,a=void 0===r?8:r,n=t.onChange;return Object(D.jsxs)("select",{value:i,onChange:function(t){return n(parseFloat(t.target.value))},children:[Object(D.jsx)("option",{value:"-1",children:"n/a"}),new Array(a).fill(0).map((function(t,e){return Object(D.jsxs)("option",{value:e,children:["bit ",e]},e)}))]})};function mt(){var t=a.a.useState(null),e=Object(u.a)(t,2),i=e[0],r=e[1],n=a.a.useState(null),s=Object(u.a)(n,2),o=s[0],h=s[1],c=a.a.useState(-1),d=Object(u.a)(c,2),f=d[0],l=d[1],p=a.a.useState(-1),m=Object(u.a)(p,2),_=m[0],v=m[1],y=a.a.useState(-1),g=Object(u.a)(y,2),x=g[0],S=g[1],j=a.a.useState(1),w=Object(u.a)(j,2),O=w[0],z=w[1];var M=function(){var t;switch(O){case 0:t=function(t,e,i,r){for(var a=new ImageData(t.mapSize,t.mapSize),n=function(t,e){return 0!==(t&1<<e)?0:255},s=0;s<t.mapSize*t.mapSize;s++){var o=t.flagsMap[s];a.data[4*s+0]=-1!==e?n(o,e):0,a.data[4*s+1]=-1!==i?n(o,i):0,a.data[4*s+2]=-1!==r?n(o,r):0,a.data[4*s+3]=255}return a}(i,f,_,x);break;case 1:t=lt(i,"heightMap");break;case 2:t=lt(i,"waterMap")}return t};return Object(D.jsx)("div",{onDragOver:function(t){t.preventDefault()},onDrop:function(t){var e;if(t.preventDefault(),null===(e=t.dataTransfer.files)||void 0===e?void 0:e.length){var i=t.dataTransfer.files[0].name,a=URL.createObjectURL(t.dataTransfer.files[0]);fetch(a).then((function(t){return t.arrayBuffer()})).then((function(t){var e=new ut.a(new b.a(t));h(i),r(e)}))}},style:{width:"100%",height:"100%",margin:"5px",userSelect:"text"},children:i&&o?Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("h1",{children:o}),Object(D.jsxs)("select",{value:O,onChange:function(t){return z(parseInt(t.target.value))},children:[Object(D.jsx)("option",{value:"0",children:"Flags"}),Object(D.jsx)("option",{value:"1",children:"Heightmap"}),Object(D.jsx)("option",{value:"2",children:"Watermap"})]}),0===O&&Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(pt,{value:f,bitCount:16,onChange:function(t){return l(t)}}),Object(D.jsx)(pt,{value:_,bitCount:16,onChange:function(t){return v(t)}}),Object(D.jsx)(pt,{value:x,bitCount:16,onChange:function(t){return S(t)}})]}),Object(D.jsx)("button",{onClick:function(){var t=M();if(t){var e=document.createElement("canvas"),i=e.getContext("2d");if(i){i.canvas.width=t.width,i.canvas.height=t.height,i.putImageData(t,0,0);var r=e.toDataURL("image/png"),a=(null===o||void 0===o?void 0:o.replace(/\.MAP$/i,""))||"";switch(O){case 0:a+="-r".concat(f,"g").concat(_,"b").concat(x,".png");break;case 1:a+="-height.png";break;case 2:a+="-water.png"}var n=document.createElement("a");n.setAttribute("download",a),n.setAttribute("href",r.replace("image/png","image/octet-stream")),n.click()}}},children:"Download"}),Object(D.jsx)("br",{}),Object(D.jsx)("br",{}),Object(D.jsx)(ft,{width:i.mapSize,height:i.mapSize,drawContent:function(t){var e=M();e&&t.putImageData(e,0,0)}})]}):Object(D.jsx)("h1",{children:"Drop a Carnivores 1/2/IceAge MAP file here"})})}var _t=i(379),vt=i(382),yt=(i(373),function(t){Object(C.a)(i,t);var e=Object(B.a)(i);function i(){return Object(U.a)(this,i),e.apply(this,arguments)}return Object(P.a)(i,[{key:"load",value:function(t,e,i,r){var a=t.split("~"),n=Object(u.a)(a,2),s=n[0],o=n[1];return"3DF"===s?(new H).load(o,e,i,r):"CAR"===s?(new q).load(o,e,i,r):null}}]),i}(g.Loader));function bt(t){var e=t.model,i=t.animation,r=Object(_t.a)(e.animations),n=r.actions,s=r.ref;return a.a.useEffect((function(){var t;return null===(t=n[i])||void 0===t||t.play(),function(){var t;null===(t=n[i])||void 0===t||t.stop()}})),Object(D.jsx)("primitive",{ref:s,object:e})}function gt(t){var e=t.modelUri,i=Object(p.f)(yt,e),r=a.a.useState({animation:""}),n=Object(u.a)(r,2),s=n[0],o=n[1],h=a.a.useMemo((function(){var t=[""];return i.animations.forEach((function(e){return t.push(e.name)})),t}),[i]);return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsxs)(p.a,{className:"canvasStyle",linear:!0,camera:{position:[0,500,-500],far:1e4},children:[Object(D.jsx)(vt.a,{target:[0,0,0]}),Object(D.jsx)("axesHelper",{args:[1e3]}),Object(D.jsx)("gridHelper",{args:[1e3,62.5]}),Object(D.jsx)(bt,{model:i,animation:s.animation})]}),Object(D.jsx)(c.c,{data:s,onUpdate:function(t){return o(t)},children:Object(D.jsx)(c.b,{path:"animation",options:h})})]})}function xt(){var t=a.a.useState("CAR~HUNTDAT/HUNTER1.CAR"),e=Object(u.a)(t,2),i=e[0],r=e[1];return Object(D.jsx)("div",{onDragOver:function(t){t.preventDefault()},onDrop:function(t){var e;if(t.preventDefault(),null===(e=t.dataTransfer.files)||void 0===e?void 0:e.length){var i,a=t.dataTransfer.files[0].name;a.toLowerCase().endsWith(".3df")?i="3DF":a.toLowerCase().endsWith(".car")&&(i="CAR");var n=URL.createObjectURL(t.dataTransfer.files[0]);r("".concat(i,"~").concat(n))}},className:"modelContainer",children:Object(D.jsx)(a.a.Suspense,{fallback:null,children:Object(D.jsx)(gt,{modelUri:i})})})}function St(){return Object(D.jsx)(o.a,{children:Object(D.jsxs)(h.c,{children:[Object(D.jsx)(h.a,{exact:!0,path:"/",children:Object(D.jsx)(et,{})}),Object(D.jsx)(h.a,{path:"/main",children:Object(D.jsx)(ot,{})}),Object(D.jsx)(h.a,{path:"/edit-map",children:Object(D.jsx)(mt,{})}),Object(D.jsx)(h.a,{path:"/edit-model",children:Object(D.jsx)(xt,{})})]})})}var jt=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,383)).then((function(e){var i=e.getCLS,r=e.getFID,a=e.getFCP,n=e.getLCP,s=e.getTTFB;i(t),r(t),a(t),n(t),s(t)}))};s.a.render(Object(D.jsx)(a.a.StrictMode,{children:Object(D.jsx)(St,{})}),document.getElementById("root")),jt()}},[[376,1,2]]]);
//# sourceMappingURL=main.42de3296.chunk.js.map