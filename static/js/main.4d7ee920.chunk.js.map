{"version":3,"sources":["kaitai/Vertex.js","kaitai/Face.js","kaitai/Map.js","kaitai/Rsc.js","kaitai/carnivores_map.js","kaitai/Car.js","kaitai/C3df.js","kaitai/Ivector.js","legacy/CPCTerrainMaterial.ts","components/Terrain.tsx","legacy/hunt.ts","Player.tsx","legacy/utils.ts","components/Sky.tsx","legacy/C3DFGeometry.ts","components/Scenery.tsx","components/World.tsx","pages/Home.tsx","components/Canvas.tsx","pages/MapEditor.tsx","legacy/CARLoader.ts","pages/ModelEditor.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["root","factory","define","undefined","this","KaitaiStream","Vertex","_io","_parent","_root","_read","prototype","x","readF4le","y","z","owner","readS2le","hide","readU2le","amd","module","exports","require","Face","v1","readU4le","v2","v3","tax","readS4le","tbx","tcx","tay","tby","tcy","fDoubleSide","readBitsIntBe","fDarkBack","fOpacity","fMortal","fPhong","fEnvmap","fNeedvc","fUnused","fDarkFront","alignToByte","dMask","distant","next","group","reserved","readBytes","Map","heightMap","Array","mapSize","i","readU1","textureMap1","version","textureMap2","objectMap","flagsMap","FlagsV1","FlagsV2","dawnLightMap","dayLightMap","nightLightMap","waterMap","objectHeightMap","fogsMap","Math","floor","ambientMap","fTexDirection","readBitsIntLe","fModelDirection","fNoWay","fReverse","fWater","unused1","fTex2Direction","unused2","fWater2","Object","defineProperty","get","_m_mapSize","_m_yScale","_m_version","size","_m_tileSize","_m_isValid","C3df","Rsc","AudioReverb","freeze","GENERIC","PLATE","FOREST","MOUNTAIN","CANYON","CAVE","SPECIAL2","UNUSED","0","1","2","3","4","5","6","7","textureCount","modelCount","dawnSkyRgb","Rgb","daySkyRgb","nightSkyRgb","dawnSkyTRgb","daySkyTRgb","nightSkyTRgb","textures","Texture","models","Model","dawnSkyTexture","skyTextureWidth","skyTextureHeight","daySkyTexture","nightSkyTexture","cloudsMap","fogCount","fogList","FogEntry","randomSoundCount","randomSounds","RandomSound","ambientSoundCount","ambientSounds","AmbientSound","waterCount","waters","Water","r","g","b","radius","yLo","yHi","lineLength","lIntensity","circleRad","cIntensity","fPlaceWater","fPlaceGround","fPlaceUser","fCircle","fBound","fNoBmp","fNoLight","fDefaultLight","fGroundLight","fNoSoft","fNoSoft2","fIsAnimated","grRad","refLight","lastAniTime","boundR","model","billboard","animation","ModelAnimation","Trd","rNumber","rVolume","rFrequency","rEnvironment","rfNotAtNight","rfUnused","vc0","vc1","vc2","kps","frameCount","frames","textureIndex","level","opacity","fogRgb","yBegin","mortal","transp","fLimit","pcmSize","pcm","rData","rsfxCount","aVolume","data","width","height","_m_width","_m_height","_m_skyTextureWidth","_m_skyTextureHeight","Carnivores1Map","isV1","lightMap","isV2","_m_isV1","_m_isV2","Ivector","Car","name","bytesToStr","bytesTerminate","msc","animationCount","soundEffectCount","vertCount","faceCount","textureSize","faces","vertices","textureData","animations","Animation","soundEffects","SoundEffect","animSoundMap","pcmLength","framesPerSecond","Frame","_m_textureWidth","_m_textureHeight","textureWidth","nodeCount","nodes","Node","textureHeight","ix","iy","iz","_m_x","_m_y","_m_z","CPCTerrainMaterial","vertexMap","fragmentMap","yScale","textureArray","heightmapMatrix","map","fog","defines","onBeforeCompile","s","uniforms","value","vs","vertexShader","replace","fs","fragmentShader","MeshBasicMaterial","Terrain","rsc","viewDistance","position","material","React","useMemo","Uint8Array","tex","DataTexture","RGIntegerFormat","UnsignedByteType","internalFormat","buildVertexMap","flags","RGBIntegerFormat","buildFragmentMap","Uint16Array","offset","j","pixel","DataTexture2DArray","type","UnsignedShort565Type","format","RGBFormat","wrapT","wrapS","RepeatWrapping","createTextureArray","Matrix4","makeScale","tileSize","geometry","geo","PlaneBufferGeometry","rotateX","PI","translate","getLandings","landingList","getHeight","push","Vector3","mapUrl","rscUrl","getLandH","getLandQHNoObj","a","max","hmap","compensation","cx","cy","dx","dy","h1","h2","h3","h4","fetch","then","body","arrayBuffer","mapBuffer","rscBuffer","MAP","RSC","console","log","landings","getHeightAt","controls","forward","backward","left","right","run","handleKeys","event","down","altKey","key","toLowerCase","Player","useEffect","document","addEventListener","removeEventListener","velocity","direction","_vector","initPos","length","random","initial","clock","Clock","useFrame","camera","delta","getDelta","copy","Number","normalize","spd","setFromMatrixColumn","matrix","addScaledVector","crossVectors","up","createTexture","texData","useAlpha","RGBAFormat","UnsignedShort5551Type","needsUpdate","Sky","skyTexture","anisotropy","repeat","set","halfMapWorld","args","side","DoubleSide","C3DFGeometry","c3dfObject","uv","forEach","f","c","setAttribute","Float32BufferAttribute","computeVertexNormals","BufferGeometry","Scenery","parent","Group","matrices","obj","makeTranslation","apply","toArray","mdl","count","mesh","InstancedMesh","transparent","alphaTest","fromArray","setMatrixAt","add","object","World","useState","world","setWorld","loadArea","shadows","linear","fov","near","far","Stats","PointerLockControls","Suspense","fallback","Html","center","Home","onDragOver","ev","preventDefault","onDrop","dataTransfer","files","toUpperCase","endsWith","URL","createObjectURL","className","Canvas","drawContent","props","canvasRef","useRef","canvas","current","context","getContext","fillStyle","fillRect","ref","generateHeightmap","field","imageData","ImageData","BitSelect","bitCount","onChange","parseFloat","target","fill","_","MapEditor","setMap","mapName","setMapName","bitR","setBitR","bitG","setBitG","bitB","setBitB","mode","setMode","getImageData","bitToColorChannel","bit","val","generateFlagsMap","url","buf","style","margin","userSelect","parseInt","onClick","createElement","ctx","putImageData","dataImage","toDataURL","link","click","CARLoader","manager","onLoad","onProgress","onError","buffer","parse","catch","e","car","CAR","flatMap","morphVertices","addVert","origVIdx","u","v","frame","idx","morphAttributes","globalFrameIndex","anim","frIdx","attr","mat","morphTargets","MorphBlendMesh","createAnimation","Loader","ModelViewer","modelUri","useLoader","keys","animationsMap","setData","intvHandle","setInterval","update","clearInterval","onUpdate","updated","stopAnimation","morphTargetInfluences","playAnimation","path","options","OrbitControls","ModelEditor","setModelUri","overflow","App","exact","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.4d7ee920.chunk.js","sourcesContent":["// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined; // IRA\n\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n      define(['kaitai-struct/KaitaiStream'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n      module.exports = factory(require('kaitai-struct/KaitaiStream'));\n    } else {\n      root.Vertex = factory(root.KaitaiStream);\n    }\n  }(this, function (KaitaiStream) {\n  /**\n   * @see {@link https://carnivores.fandom.com/wiki/3DF|Source}\n   */\n  \n  var Vertex = (function() {\n    function Vertex(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n  \n      this._read();\n    }\n    Vertex.prototype._read = function() {\n      this.x = this._io.readF4le();\n      this.y = this._io.readF4le();\n      this.z = this._io.readF4le();\n      this.owner = this._io.readS2le();\n      this.hide = this._io.readU2le();\n    }\n  \n    return Vertex;\n  })();\n  return Vertex;\n  }));\n  ","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined; // IRA\n\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n      define(['kaitai-struct/KaitaiStream'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n      module.exports = factory(require('kaitai-struct/KaitaiStream'));\n    } else {\n      root.Face = factory(root.KaitaiStream);\n    }\n  }(this, function (KaitaiStream) {\n  /**\n   * @see {@link https://carnivores.fandom.com/wiki/3DF|Source}\n   */\n  \n  var Face = (function() {\n    function Face(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n  \n      this._read();\n    }\n    Face.prototype._read = function() {\n      this.v1 = this._io.readU4le();\n      this.v2 = this._io.readU4le();\n      this.v3 = this._io.readU4le();\n      this.tax = this._io.readS4le();\n      this.tbx = this._io.readS4le();\n      this.tcx = this._io.readS4le();\n      this.tay = this._io.readS4le();\n      this.tby = this._io.readS4le();\n      this.tcy = this._io.readS4le();\n      this.fDoubleSide = this._io.readBitsIntBe(1) != 0;\n      this.fDarkBack = this._io.readBitsIntBe(1) != 0;\n      this.fOpacity = this._io.readBitsIntBe(1) != 0;\n      this.fMortal = this._io.readBitsIntBe(1) != 0;\n      this.fPhong = this._io.readBitsIntBe(1) != 0;\n      this.fEnvmap = this._io.readBitsIntBe(1) != 0;\n      this.fNeedvc = this._io.readBitsIntBe(1) != 0;\n      this.fUnused = this._io.readBitsIntBe(7);\n      this.fDarkFront = this._io.readBitsIntBe(1) != 0;\n      this._io.alignToByte();\n      this.dMask = this._io.readU2le();\n      this.distant = this._io.readS4le();\n      this.next = this._io.readU4le();\n      this.group = this._io.readU4le();\n      this.reserved = this._io.readBytes(12);\n    }\n  \n    return Face;\n  })();\n  return Face;\n  }));\n  ","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.Map = factory(root.KaitaiStream);\n  }\n}(typeof self !== 'undefined' ? self : this, function (KaitaiStream) {\n/**\n * @see {@link https://carnivores.fandom.com/wiki/Carnivores_2_MAP|Source}\n */\n\nvar Map = (function() {\n  function Map(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Map.prototype._read = function() {\n    this.heightMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      this.heightMap[i] = this._io.readU1();\n    }\n    this.textureMap1 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.version) {\n      case 1:\n        this.textureMap1[i] = this._io.readU1();\n        break;\n      case 2:\n        this.textureMap1[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.textureMap2 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.version) {\n      case 1:\n        this.textureMap2[i] = this._io.readU1();\n        break;\n      case 2:\n        this.textureMap2[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.objectMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.flagsMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.version) {\n      case 1:\n        this.flagsMap[i] = new FlagsV1(this._io, this, this._root);\n        break;\n      case 2:\n        this.flagsMap[i] = new FlagsV2(this._io, this, this._root);\n        break;\n      }\n    }\n    if (this.version == 2) {\n      this.dawnLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.dayLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    if (this.version == 2) {\n      this.nightLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.waterMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.objectHeightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.fogsMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n    this.ambientMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n  }\n\n  var FlagsV1 = Map.FlagsV1 = (function() {\n    function FlagsV1(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FlagsV1.prototype._read = function() {\n      this.fTexDirection = this._io.readBitsIntLe(2);\n      this.fModelDirection = this._io.readBitsIntLe(3);\n      this.fNoWay = this._io.readBitsIntLe(1) != 0;\n      this.fReverse = this._io.readBitsIntLe(1) != 0;\n      this.fWater = this._io.readBitsIntLe(1) != 0;\n    }\n\n    /**\n     * 0: no rotation (right-side-up)\n     * 1: rotated 90 degrees clockwise\n     * 2: rotated 180 degrees (upside-down)\n     * 3: rotated 90 degrees counter-clockwise\n     */\n\n    /**\n     * Represents an angle, fully calculated as\n     * (value * 2 * PI / 8) and used when rendering models on the tile.\n     */\n\n    /**\n     * Indicates how the cell is diagonally split among both textures\n     *   true: 2 - 1\n     *   false: 1 - 2\n     */\n\n    /**\n     * Marks the cell as having water in it, must be set for the Water Index\n     * map to have any effect.\n     */\n\n    return FlagsV1;\n  })();\n\n  var FlagsV2 = Map.FlagsV2 = (function() {\n    function FlagsV2(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FlagsV2.prototype._read = function() {\n      this.fTexDirection = this._io.readBitsIntLe(2);\n      this.fModelDirection = this._io.readBitsIntLe(2);\n      this.fReverse = this._io.readBitsIntLe(1) != 0;\n      this.fNoWay = this._io.readBitsIntLe(1) != 0;\n      this.unused1 = this._io.readBitsIntLe(1) != 0;\n      this.fWater = this._io.readBitsIntLe(1) != 0;\n      this.fTex2Direction = this._io.readBitsIntLe(2);\n      this.unused2 = this._io.readBitsIntLe(5);\n      this.fWater2 = this._io.readBitsIntLe(1) != 0;\n    }\n\n    /**\n     * 0: no rotation (right-side-up)\n     * 1: rotated 90 degrees clockwise\n     * 2: rotated 180 degrees (upside-down)\n     * 3: rotated 90 degrees counter-clockwise\n     */\n\n    /**\n     * Represents an angle, fully calculated as\n     * (value * 2 * PI / 4) and used when rendering models on the tile.\n     */\n\n    /**\n     * Indicates how the cell is diagonally split among both textures\n     *   true: 2 - 1\n     *   false: 1 - 2\n     */\n\n    return FlagsV2;\n  })();\n  Object.defineProperty(Map.prototype, 'mapSize', {\n    get: function() {\n      if (this._m_mapSize !== undefined)\n        return this._m_mapSize;\n      this._m_mapSize = (this.version * 512);\n      return this._m_mapSize;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'yScale', {\n    get: function() {\n      if (this._m_yScale !== undefined)\n        return this._m_yScale;\n      this._m_yScale = (this.version * 32);\n      return this._m_yScale;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'version', {\n    get: function() {\n      if (this._m_version !== undefined)\n        return this._m_version;\n      this._m_version = (this._io.size == 2228224 ? 1 : (this._io.size == 14155776 ? 2 : 0));\n      return this._m_version;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'tileSize', {\n    get: function() {\n      if (this._m_tileSize !== undefined)\n        return this._m_tileSize;\n      this._m_tileSize = 256;\n      return this._m_tileSize;\n    }\n  });\n  Object.defineProperty(Map.prototype, 'isValid', {\n    get: function() {\n      if (this._m_isValid !== undefined)\n        return this._m_isValid;\n      this._m_isValid =  ((this.version == 1) || (this.version == 2)) ;\n      return this._m_isValid;\n    }\n  });\n\n  /**\n   * Terrain heightmap\n   * \n   * The terrain geometry is a `map_size`x`map_size` grid of 256x256\n   * tiles, where the integer height from the heightmap is multiplied by 32\n   * for the original Carnivores, and 64 for Carnivores 2 and Ice Age.\n   */\n\n  /**\n   * Textur map 1\n   * \n   * In the original Carnivores, this specifies the texture to on the\n   * first* triangle of a tile. For Carnivores 2 and Ice Age, the texture\n   * specified here is used for the entire tile.\n   * \n   * Triangle order (for original Carnivores):\n   * +-----+\n   * | \\ 1 |\n   * |  \\  |\n   * | 2 \\ |\n   * +-----+\n   */\n\n  /**\n   * Texture map 2\n   * \n   * In the original Carnivores, this specifies the texture of the second\n   * triangle of a tile. For Carnivores 2 and Ice Age, the texture specified\n   * here is used for a 4x4 tile in the distance (aka LOD texture).\n   */\n\n  /**\n   * Object map\n   * \n   * This map specifies if an object is placed on a tile, and if so, which\n   * one. The following values are used:\n   * \n   *   < 254: object index (see RSC file format)\n   *     254: spawn location (or trophy placement location for trophy room)\n   *     255: no object\n   */\n\n  /**\n   * Map of flags per tile. different between original and 2 / Ice Age!\n   */\n\n  /**\n   * Water heightmap\n   * Only read when the water flag is set for a tile.\n   * Specifies sea floor height.\n   */\n\n  /**\n   * Object heightmap\n   * \n   * Map of heights for tiles with objects. However, it is only used when\n   * the object flags in the RSC file specify place_user (other options there\n   * are place_ground or place_water).\n   */\n\n  /**\n   * Fog map, which areas are covered in fog in game.\n   */\n\n  /**\n   * Ambient sounds map\n   */\n\n  return Map;\n})();\nreturn Map;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream', './C3df'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'), require('./C3df'));\n  } else {\n    root.Rsc = factory(root.KaitaiStream, root.C3df);\n  }\n}(typeof self !== 'undefined' ? self : this, function (KaitaiStream, C3df) {\n/**\n * @see {@link https://www.tapatalk.com/groups/the_carnivores_saga/carnivores-2-and-ice-age-rsc-files-t2316.html|Source}\n */\n\nvar Rsc = (function() {\n  Rsc.AudioReverb = Object.freeze({\n    GENERIC: 0,\n    PLATE: 1,\n    FOREST: 2,\n    MOUNTAIN: 3,\n    CANYON: 4,\n    CAVE: 5,\n    SPECIAL2: 6,\n    UNUSED: 7,\n\n    0: \"GENERIC\",\n    1: \"PLATE\",\n    2: \"FOREST\",\n    3: \"MOUNTAIN\",\n    4: \"CANYON\",\n    5: \"CAVE\",\n    6: \"SPECIAL2\",\n    7: \"UNUSED\",\n  });\n\n  function Rsc(_io, _parent, _root, version) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n    this.version = version;\n\n    this._read();\n  }\n  Rsc.prototype._read = function() {\n    this.textureCount = this._io.readU4le();\n    this.modelCount = this._io.readU4le();\n    if (this.version == 2) {\n      this.dawnSkyRgb = new Rgb(this._io, this, this._root);\n    }\n    this.daySkyRgb = new Rgb(this._io, this, this._root);\n    if (this.version == 2) {\n      this.nightSkyRgb = new Rgb(this._io, this, this._root);\n    }\n    if (this.version == 2) {\n      this.dawnSkyTRgb = new Rgb(this._io, this, this._root);\n    }\n    this.daySkyTRgb = new Rgb(this._io, this, this._root);\n    if (this.version == 2) {\n      this.nightSkyTRgb = new Rgb(this._io, this, this._root);\n    }\n    this.textures = new Array(this.textureCount);\n    for (var i = 0; i < this.textureCount; i++) {\n      this.textures[i] = new Texture(this._io, this, this._root);\n    }\n    this.models = new Array(this.modelCount);\n    for (var i = 0; i < this.modelCount; i++) {\n      this.models[i] = new Model(this._io, this, this._root);\n    }\n    if (this.version == 2) {\n      this.dawnSkyTexture = this._io.readBytes(((this.skyTextureWidth * this.skyTextureHeight) * 2));\n    }\n    this.daySkyTexture = this._io.readBytes(((this.skyTextureWidth * this.skyTextureHeight) * 2));\n    if (this.version == 2) {\n      this.nightSkyTexture = this._io.readBytes(((this.skyTextureWidth * this.skyTextureHeight) * 2));\n    }\n    this.cloudsMap = this._io.readBytes((128 * 128));\n    this.fogCount = this._io.readU4le();\n    this.fogList = new Array(this.fogCount);\n    for (var i = 0; i < this.fogCount; i++) {\n      this.fogList[i] = new FogEntry(this._io, this, this._root);\n    }\n    this.randomSoundCount = this._io.readU4le();\n    this.randomSounds = new Array(this.randomSoundCount);\n    for (var i = 0; i < this.randomSoundCount; i++) {\n      this.randomSounds[i] = new RandomSound(this._io, this, this._root);\n    }\n    this.ambientSoundCount = this._io.readU4le();\n    this.ambientSounds = new Array(this.ambientSoundCount);\n    for (var i = 0; i < this.ambientSoundCount; i++) {\n      this.ambientSounds[i] = new AmbientSound(this._io, this, this._root);\n    }\n    if (this.version == 2) {\n      this.waterCount = this._io.readU4le();\n    }\n    if (this.version == 2) {\n      this.waters = new Array(this.waterCount);\n      for (var i = 0; i < this.waterCount; i++) {\n        this.waters[i] = new Water(this._io, this, this._root);\n      }\n    }\n  }\n\n  var Rgb = Rsc.Rgb = (function() {\n    function Rgb(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Rgb.prototype._read = function() {\n      this.r = this._io.readU4le();\n      this.g = this._io.readU4le();\n      this.b = this._io.readU4le();\n    }\n\n    return Rgb;\n  })();\n\n  var Model = Rsc.Model = (function() {\n    function Model(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Model.prototype._read = function() {\n      this.radius = this._io.readS4le();\n      this.yLo = this._io.readS4le();\n      this.yHi = this._io.readS4le();\n      this.lineLength = this._io.readS4le();\n      this.lIntensity = this._io.readS4le();\n      this.circleRad = this._io.readS4le();\n      this.cIntensity = this._io.readS4le();\n      this.fPlaceWater = this._io.readBitsIntLe(1) != 0;\n      this.fPlaceGround = this._io.readBitsIntLe(1) != 0;\n      this.fPlaceUser = this._io.readBitsIntLe(1) != 0;\n      this.fCircle = this._io.readBitsIntLe(1) != 0;\n      this.fBound = this._io.readBitsIntLe(1) != 0;\n      this.fNoBmp = this._io.readBitsIntLe(1) != 0;\n      this.fNoLight = this._io.readBitsIntLe(1) != 0;\n      this.fDefaultLight = this._io.readBitsIntLe(1) != 0;\n      this.fGroundLight = this._io.readBitsIntLe(1) != 0;\n      this.fNoSoft = this._io.readBitsIntLe(1) != 0;\n      this.fNoSoft2 = this._io.readBitsIntLe(1) != 0;\n      this.fUnused = this._io.readBitsIntLe(20);\n      this.fIsAnimated = this._io.readBitsIntLe(1) != 0;\n      this._io.alignToByte();\n      this.grRad = this._io.readS4le();\n      this.refLight = this._io.readS4le();\n      this.lastAniTime = this._io.readU4le();\n      this.boundR = this._io.readF4le();\n      this.reserved = this._io.readBytes(16);\n      this.model = new C3df(this._io, this, null);\n      if (this._root.version == 2) {\n        this.billboard = new Texture(this._io, this, this._root);\n      }\n      if (this.fIsAnimated) {\n        this.animation = new ModelAnimation(this._io, this, this._root);\n      }\n    }\n\n    return Model;\n  })();\n\n  var Trd = Rsc.Trd = (function() {\n    function Trd(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Trd.prototype._read = function() {\n      this.rNumber = this._io.readU4le();\n      this.rVolume = this._io.readU4le();\n      this.rFrequency = this._io.readU4le();\n      this.rEnvironment = this._io.readU2le();\n      this.rfNotAtNight = this._io.readBitsIntLe(1) != 0;\n      this.rfUnused = this._io.readBitsIntLe(15);\n    }\n\n    /**\n     * if set, sound does not play at night\n     */\n\n    return Trd;\n  })();\n\n  var ModelAnimation = Rsc.ModelAnimation = (function() {\n    function ModelAnimation(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    ModelAnimation.prototype._read = function() {\n      this.vc0 = this._io.readU4le();\n      this.vc1 = this._io.readU4le();\n      this.vc2 = this._io.readU4le();\n      this.kps = this._io.readU4le();\n      this.frameCount = this._io.readU4le();\n      this.frames = new Array(((this.frameCount * 3) * this.vc1));\n      for (var i = 0; i < ((this.frameCount * 3) * this.vc1); i++) {\n        this.frames[i] = this._io.readS2le();\n      }\n    }\n\n    return ModelAnimation;\n  })();\n\n  var Water = Rsc.Water = (function() {\n    function Water(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Water.prototype._read = function() {\n      this.textureIndex = this._io.readU4le();\n      this.level = this._io.readU4le();\n      this.opacity = this._io.readF4le();\n      this.fogRgb = this._io.readU4le();\n    }\n\n    return Water;\n  })();\n\n  var FogEntry = Rsc.FogEntry = (function() {\n    function FogEntry(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FogEntry.prototype._read = function() {\n      this.fogRgb = this._io.readU4le();\n      this.yBegin = this._io.readF4le();\n      this.mortal = this._io.readU4le();\n      this.transp = this._io.readF4le();\n      this.fLimit = this._io.readF4le();\n    }\n\n    return FogEntry;\n  })();\n\n  var AmbientSound = Rsc.AmbientSound = (function() {\n    function AmbientSound(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    AmbientSound.prototype._read = function() {\n      this.pcmSize = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmSize);\n      this.rData = new Array(16);\n      for (var i = 0; i < 16; i++) {\n        this.rData[i] = new Trd(this._io, this, this._root);\n      }\n      this.rsfxCount = this._io.readU4le();\n      this.aVolume = this._io.readU4le();\n    }\n\n    return AmbientSound;\n  })();\n\n  var RandomSound = Rsc.RandomSound = (function() {\n    function RandomSound(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    RandomSound.prototype._read = function() {\n      this.pcmSize = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmSize);\n    }\n\n    return RandomSound;\n  })();\n\n  var Texture = Rsc.Texture = (function() {\n    function Texture(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Texture.prototype._read = function() {\n      this.data = this._io.readBytes(((this.width * this.height) * 2));\n    }\n    Object.defineProperty(Texture.prototype, 'width', {\n      get: function() {\n        if (this._m_width !== undefined)\n          return this._m_width;\n        this._m_width = 128;\n        return this._m_width;\n      }\n    });\n    Object.defineProperty(Texture.prototype, 'height', {\n      get: function() {\n        if (this._m_height !== undefined)\n          return this._m_height;\n        this._m_height = 128;\n        return this._m_height;\n      }\n    });\n\n    /**\n     * raw RGBA5551 bitmap data\n     */\n\n    return Texture;\n  })();\n  Object.defineProperty(Rsc.prototype, 'skyTextureWidth', {\n    get: function() {\n      if (this._m_skyTextureWidth !== undefined)\n        return this._m_skyTextureWidth;\n      this._m_skyTextureWidth = 256;\n      return this._m_skyTextureWidth;\n    }\n  });\n  Object.defineProperty(Rsc.prototype, 'skyTextureHeight', {\n    get: function() {\n      if (this._m_skyTextureHeight !== undefined)\n        return this._m_skyTextureHeight;\n      this._m_skyTextureHeight = 256;\n      return this._m_skyTextureHeight;\n    }\n  });\n\n  return Rsc;\n})();\nreturn Rsc;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\n/* eslint-disable */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.Carnivores1Map = factory(root.KaitaiStream);\n  }\n}(this, function (KaitaiStream) {\nvar Carnivores1Map = (function() {\n  function Carnivores1Map(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Carnivores1Map.prototype._read = function() {\n    this.heightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.textureMap1 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.textureMap1[i] = this._io.readU1();\n        break;\n      case false:\n        this.textureMap1[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.textureMap2 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.textureMap2[i] = this._io.readU1();\n        break;\n      case false:\n        this.textureMap2[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.objectMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.flagsMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.flagsMap[i] = this._io.readU1();\n        break;\n      case false:\n        this.flagsMap[i] = this._io.readU2le();\n        break;\n      }\n    }\n    if (this.isV1) {\n      this.lightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.dawnLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.dayLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.nightLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.waterMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.objectHeightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.fogsMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n    this.ambientMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n  }\n  Object.defineProperty(Carnivores1Map.prototype, 'isV1', {\n    get: function() {\n      if (this._m_isV1 !== undefined)\n        return this._m_isV1;\n      this._m_isV1 = this._io.size == 2228224;\n      return this._m_isV1;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'isV2', {\n    get: function() {\n      if (this._m_isV2 !== undefined)\n        return this._m_isV2;\n      this._m_isV2 = this._io.size == 14155776;\n      return this._m_isV2;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'isValid', {\n    get: function() {\n      if (this._m_isValid !== undefined)\n        return this._m_isValid;\n      this._m_isValid =  ((this.isV1) || (this.isV2)) ;\n      return this._m_isValid;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'mapSize', {\n    get: function() {\n      if (this._m_mapSize !== undefined)\n        return this._m_mapSize;\n      this._m_mapSize = (this.isV1 ? 512 : 1024);\n      return this._m_mapSize;\n    }\n  });\n\n  /**\n   * Terrain heightmap, for water tiles it specifies the water surface height\n   */\n\n  /**\n   * Terrain texture map, every byte specifies a texture index for the terrain\n   */\n\n  /**\n   * Object placement map, every byte specifies an object (< 254), a spawn location (254), or no model (255)\n   */\n\n  /**\n   * Flags map, specifies render flags per tile. This includes rotation of terrain texture, of object, and more.\n   */\n\n  /**\n   * Light map, specifies lighting of placed objects\n   */\n\n  /**\n   * Water heightmap, specifies \"sea floor\" terrain heights\n   */\n\n  /**\n   * Object heightmap, height placement of objects (flags map can specify to align to sea floor level or terrain ground level too)\n   */\n\n  /**\n   * Fog map, which areas are covered in fog in game.\n   */\n\n  /**\n   * Ambient sounds map\n   */\n\n  return Carnivores1Map;\n})();\nreturn Carnivores1Map;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\n\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream', './Vertex', './Face', './Ivector'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'), require('./Vertex'), require('./Face'), require('./Ivector'));\n  } else {\n    root.Car = factory(root.KaitaiStream, root.Vertex, root.Face, root.Ivector);\n  }\n}(this, function (KaitaiStream, Vertex, Face, Ivector) {\n/**\n * @see {@link https://carnivores.fandom.com/wiki/CAR|Source}\n */\n\nvar Car = (function() {\n  function Car(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Car.prototype._read = function() {\n    this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(24), 0, false), \"utf8\");\n    this.msc = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(8), 0, false), \"utf8\");\n    this.animationCount = this._io.readU4le();\n    this.soundEffectCount = this._io.readU4le();\n    this.vertCount = this._io.readU4le();\n    this.faceCount = this._io.readU4le();\n    this.textureSize = this._io.readU4le();\n    this.faces = new Array(this.faceCount);\n    for (var i = 0; i < this.faceCount; i++) {\n      this.faces[i] = new Face(this._io, this, null);\n    }\n    this.vertices = new Array(this.vertCount);\n    for (var i = 0; i < this.vertCount; i++) {\n      this.vertices[i] = new Vertex(this._io, this, null);\n    }\n    this.textureData = this._io.readBytes(this.textureSize);\n    this.animations = new Array(this.animationCount);\n    for (var i = 0; i < this.animationCount; i++) {\n      this.animations[i] = new Animation(this._io, this, this._root);\n    }\n    this.soundEffects = new Array(this.soundEffectCount);\n    for (var i = 0; i < this.soundEffectCount; i++) {\n      this.soundEffects[i] = new SoundEffect(this._io, this, this._root);\n    }\n    this.animSoundMap = new Array(64);\n    for (var i = 0; i < 64; i++) {\n      this.animSoundMap[i] = this._io.readS4le();\n    }\n  }\n\n  var SoundEffect = Car.SoundEffect = (function() {\n    function SoundEffect(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    SoundEffect.prototype._read = function() {\n      this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(32), 0, false), \"utf8\");\n      this.pcmLength = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmLength);\n    }\n\n    return SoundEffect;\n  })();\n\n  var Animation = Car.Animation = (function() {\n    function Animation(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Animation.prototype._read = function() {\n      this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(32), 0, false), \"utf8\");\n      this.framesPerSecond = this._io.readU4le();\n      this.frameCount = this._io.readU4le();\n      this.frames = new Array(this.frameCount);\n      for (var i = 0; i < this.frameCount; i++) {\n        this.frames[i] = new Frame(this._io, this, this._root);\n      }\n    }\n\n    return Animation;\n  })();\n\n  var Frame = Car.Frame = (function() {\n    function Frame(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Frame.prototype._read = function() {\n      this.vertices = new Array(this._root.vertCount);\n      for (var i = 0; i < this._root.vertCount; i++) {\n        this.vertices[i] = new Ivector(this._io, this, null);\n      }\n    }\n\n    return Frame;\n  })();\n\n  /**\n   * width of texture in pixels\n   */\n  Object.defineProperty(Car.prototype, 'textureWidth', {\n    get: function() {\n      if (this._m_textureWidth !== undefined)\n        return this._m_textureWidth;\n      this._m_textureWidth = 256;\n      return this._m_textureWidth;\n    }\n  });\n\n  /**\n   * height of texture in pixels\n   */\n  Object.defineProperty(Car.prototype, 'textureHeight', {\n    get: function() {\n      if (this._m_textureHeight !== undefined)\n        return this._m_textureHeight;\n      this._m_textureHeight = Math.floor(Math.floor(this.textureSize / 2) / this.textureWidth);\n      return this._m_textureHeight;\n    }\n  });\n\n  /**\n   * Name of model\n   */\n\n  /**\n   * some revision string? always msc: <number>\n   */\n\n  /**\n   * Texture data in RGBA5551 format\n   */\n\n  /**\n   * mapping of animation (index) to sound (value)\n   */\n\n  return Car;\n})();\nreturn Car;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream', './Vertex', './Face'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'), require('./Vertex'), require('./Face'));\n  } else {\n    root.C3df = factory(root.KaitaiStream, root.Vertex, root.Face);\n  }\n}(typeof self !== 'undefined' ? self : this, function (KaitaiStream, Vertex, Face) {\n/**\n * @see {@link https://carnivores.fandom.com/wiki/3DF|Source}\n */\n\nvar C3df = (function() {\n  function C3df(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  C3df.prototype._read = function() {\n    this.vertCount = this._io.readU4le();\n    this.faceCount = this._io.readU4le();\n    this.nodeCount = this._io.readU4le();\n    this.textureSize = this._io.readU4le();\n    this.faces = new Array(this.faceCount);\n    for (var i = 0; i < this.faceCount; i++) {\n      this.faces[i] = new Face(this._io, this, null);\n    }\n    this.vertices = new Array(this.vertCount);\n    for (var i = 0; i < this.vertCount; i++) {\n      this.vertices[i] = new Vertex(this._io, this, null);\n    }\n    this.nodes = new Array(this.nodeCount);\n    for (var i = 0; i < this.nodeCount; i++) {\n      this.nodes[i] = new Node(this._io, this, this._root);\n    }\n    this.textureData = this._io.readBytes(((this.textureWidth * this.textureHeight) * 2));\n  }\n\n  var Node = C3df.Node = (function() {\n    function Node(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Node.prototype._read = function() {\n      this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(32), 0, false), \"utf8\");\n      this.x = this._io.readF4le();\n      this.y = this._io.readF4le();\n      this.z = this._io.readF4le();\n      this.owner = this._io.readS2le();\n      this.hide = this._io.readU2le();\n    }\n\n    return Node;\n  })();\n  Object.defineProperty(C3df.prototype, 'textureWidth', {\n    get: function() {\n      if (this._m_textureWidth !== undefined)\n        return this._m_textureWidth;\n      this._m_textureWidth = 256;\n      return this._m_textureWidth;\n    }\n  });\n  Object.defineProperty(C3df.prototype, 'textureHeight', {\n    get: function() {\n      if (this._m_textureHeight !== undefined)\n        return this._m_textureHeight;\n      this._m_textureHeight = Math.floor(Math.floor(this.textureSize / 2) / this.textureWidth);\n      return this._m_textureHeight;\n    }\n  });\n\n  return C3df;\n})();\nreturn C3df;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\nconst define = undefined, self = undefined;\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n      define(['kaitai-struct/KaitaiStream'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n      module.exports = factory(require('kaitai-struct/KaitaiStream'));\n    } else {\n      root.Ivector = factory(root.KaitaiStream);\n    }\n  }(this, function (KaitaiStream) {\n  var Ivector = (function() {\n    function Ivector(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n  \n      this._read();\n    }\n    Ivector.prototype._read = function() {\n      this.ix = this._io.readS2le();\n      this.iy = this._io.readS2le();\n      this.iz = this._io.readS2le();\n    }\n    Object.defineProperty(Ivector.prototype, 'x', {\n      get: function() {\n        if (this._m_x !== undefined)\n          return this._m_x;\n        this._m_x = (this.ix / 16.0);\n        return this._m_x;\n      }\n    });\n    Object.defineProperty(Ivector.prototype, 'y', {\n      get: function() {\n        if (this._m_y !== undefined)\n          return this._m_y;\n        this._m_y = (this.iy / 16.0);\n        return this._m_y;\n      }\n    });\n    Object.defineProperty(Ivector.prototype, 'z', {\n      get: function() {\n        if (this._m_z !== undefined)\n          return this._m_z;\n        this._m_z = (this.iz / 16.0);\n        return this._m_z;\n      }\n    });\n  \n    return Ivector;\n  })();\n  return Ivector;\n  }));\n  ","import { DataTexture, DataTexture2DArray, Matrix4, MeshBasicMaterial } from \"three\";\n\ninterface CPCTerrainMaterialProps {\n    vertexMap: DataTexture; // integer DataTexture containing heightmap, lightmap\n    fragmentMap: DataTexture; // integer DataTexture containing texturemap{1,2}, flagmap\n    textureArray: DataTexture2DArray, // DataTexture array with terrain textures\n    mapSize: number; // size of map in tiles, e.g. 512 for C1, 1024 for C2/IA\n    version: number; // version 1 for C1, 2 for C2/IA\n    yScale: number; // y scaling of heights, 32 for C1, 64 for C2\n    heightmapMatrix: Matrix4; // transformation from world coordinates of map to uv\n}\n\n// CarnivoresPCTerrainMaterial\nexport default class CPCTerrainMaterial extends MeshBasicMaterial {\n    constructor({ vertexMap, fragmentMap, mapSize, version, yScale, textureArray, heightmapMatrix }: CPCTerrainMaterialProps) {\n        super({\n            map: textureArray,\n            fog: true, // for future use\n        });\n\n        this.defines = {\n            'MAP_SIZE': `${mapSize}.0`,\n            'CARNIVORES': version,\n            'MAP_HSCALE': `${yScale}.0`,\n        };\n        this.onBeforeCompile = s => {\n            // Create our (integer) data textures for\n            // fragment and vertex shader\n            s.uniforms['vertexMap'] = { value: vertexMap, };\n            s.uniforms['fragmentMap'] = { value: fragmentMap, };\n            s.uniforms['heightmapMatrix'] = { value: heightmapMatrix, };\n    \n            // Adjust vertex shader\n            let vs = s.vertexShader;\n            vs = vs.replace('#include <common>', `\n                precision highp usampler2D;\n                uniform usampler2D vertexMap;\n                uniform mat4 heightmapMatrix;\n                varying vec4 vLighting;\n            `)\n            vs = vs.replace('#include <color_vertex>', `\n            vUv = (heightmapMatrix * modelMatrix * vec4(position, 1.0)).xz;\n            uvec4 tex = texture(vertexMap, vUv);\n            #if CARNIVORES == 1\n            float light = 1.0 - (float(tex.g) / 64.0);\n            #else\n            float light = float(tex.g) / 255.0;\n            #endif\n            vLighting = vec4(light, light, light, 1.0);\n            #include <color_vertex>\n            `)\n            vs = vs.replace('#include <begin_vertex>', `\n            #include <begin_vertex>\n            transformed.y += float(tex.r) * MAP_HSCALE;\n            `)\n            s.vertexShader = vs;\n\n            // Adjust the fragment shader\n            let fs = s.fragmentShader;\n            fs = fs.replace('#include <map_pars_fragment>', `\n            precision highp sampler2DArray;\n            precision highp usampler2D;\n            uniform sampler2DArray map;\n            uniform usampler2D fragmentMap;\n            varying vec4 vLighting;\n            `);\n            fs = fs.replace('#include <map_fragment>', `\n            vec2 tilePos = vUv * MAP_SIZE;\n            vec2 localTileUv = tilePos - floor(tilePos);\n            uvec4 tex = texture(fragmentMap, vUv);\n            float triside = ((1.0-localTileUv.x) - localTileUv.y);\n            diffuseColor = vLighting;\n            switch(tex.b & 3u) {\n                case 0u:\n                    //diffuseColor = vec4(1.0, 1.0, 1.0, 1.0);\n                    break;\n                case 1u:\n                    float t = localTileUv.x;\n                    localTileUv.x = localTileUv.y;\n                    localTileUv.y = 1.0 - t;\n                    //diffuseColor = vec4(0.5, 0.0, 0.0, 1.0);\n                    break;\n                case 2u:\n                    localTileUv.x = 1.0 - localTileUv.x;\n                    localTileUv.y = 1.0 - localTileUv.y;\n                    //diffuseColor = vec4(0.5, 0.5, 0.0, 1.0);\n                    break;\n                case 3u:\n                    float x = localTileUv.x;\n                    localTileUv.x = 1.0 - localTileUv.y;\n                    localTileUv.y = x;\n                    //diffuseColor = vec4(0.0, 0.0, 1.0, 1.0);\n                    break;\n            }\n            uint depth = tex.r;\n            #if CARNIVORES == 1\n            if (triside >= 0.0) {\n                depth = (tex.b & 64u) != 0u ? tex.r : tex.g;\n            } else {\n                depth = (tex.b & 64u) != 0u ? tex.g : tex.r;\n            }\n            #endif\n            #ifdef DEBUG_REVERSE_FLAG\n            if ((tex.b & 64u) != 0u) {\n                diffuseColor = vec4(0.6, 0.6, 0.6, 1.0);\n            } else {\n                diffuseColor = vec4(1.0, 1.0, 1.0, 1.0);\n            }\n            #endif\n            vec4 texelColor = texture( map, vec3(localTileUv, depth) );\n            texelColor = mapTexelToLinear( texelColor );\n            diffuseColor *= texelColor;\n            //diffuseColor = vec4(localTileUv, 0.0, 1.0);\n            `)\n            s.fragmentShader = fs;\n        }\n    \n    }\n}","import { Vector3 } from \"@react-three/fiber\";\nimport React from \"react\";\nimport {\n    DataTexture,\n    DataTexture2DArray,\n    Matrix4,\n    PlaneBufferGeometry,\n    RepeatWrapping,\n    RGBFormat,\n    RGBIntegerFormat,\n    RGIntegerFormat,\n    UnsignedByteType,\n    UnsignedShort565Type\n} from \"three\";\nimport CPCTerrainMaterial from \"../legacy/CPCTerrainMaterial\";\n\nfunction buildVertexMap(map: any) {\n    const numChannels = 2;\n    const data = new Uint8Array(map.mapSize * map.mapSize * numChannels);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        data[i*numChannels+0] = map.heightMap[i]; // R\n        data[i*numChannels+1] = map.dayLightMap[i]; // G\n    }\n    let tex = new DataTexture(data, map.mapSize, map.mapSize, RGIntegerFormat, UnsignedByteType);\n    tex.internalFormat = 'RG8UI';\n    return tex;\n}\n\nfunction buildFragmentMap(map: any) {\n    const numChannels = 3;\n    const data = new Uint8Array(map.mapSize * map.mapSize * numChannels);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        const flags = map.flagsMap[i];\n        data[i*numChannels+0] = map.textureMap1[i]; // R\n        data[i*numChannels+1] = map.textureMap2[i]; // G\n        data[i*numChannels+2] = flags.fTexDirection | (flags.fReverse << 6); // B\n    }\n    let tex = new DataTexture(data, map.mapSize, map.mapSize, RGBIntegerFormat, UnsignedByteType);\n    tex.internalFormat = 'RGB8UI';\n    return tex;\n}\n\nfunction createTextureArray(rsc: any) {\n    // create data array\n    const data = new Uint16Array(rsc.textureCount * rsc.textures[0].width * rsc.textures[0].height);\n\n    // copy texture data\n    let offset = 0;\n    for (let i = 0; i < rsc.textureCount; i++) {\n        for (let j = 0; j < rsc.textures[0].width * rsc.textures[0].height; j++) {\n            // read RGBA5551...\n            let pixel = (rsc.textures[i].data[j*2+1] << 8) | rsc.textures[i].data[j*2];\n            let r = (pixel >> 10) & 0x1f;\n            let g = ((pixel >>  5) & 0x1f) << 1;\n            let b = (pixel >>  0) & 0x1f;\n            // write RGB565 (since we do not need transparency here)\n            data[offset++] = (r << 11) + (g << 5) + b;\n        }\n    }\n\n    let tex = new DataTexture2DArray(data, rsc.textures[0].width, rsc.textures[0].height, rsc.textureCount);\n    tex.type = UnsignedShort565Type;\n    tex.format = RGBFormat;\n    tex.wrapT = tex.wrapS = RepeatWrapping;\n    return tex;\n}\n\ninterface Props {\n    rsc: any;\n    map: any;\n    viewDistance?: number; // view distance in tiles\n    position?: Vector3; // location in world space\n}\n\nfunction Terrain({\n    rsc, map,\n    viewDistance = map.mapSize / 2,\n    position = [ 0,0,0 ],\n}: Props) {\n    const material = React.useMemo(() => {\n        const { mapSize, version, yScale } = map;\n        const vertexMap = buildVertexMap(map);\n        const fragmentMap = buildFragmentMap(map);\n        \n        const textureArray = createTextureArray(rsc);\n\n        // World coordinates to uv transform (TODO investigate uvScaleMap/uvTransform?)\n        const heightmapMatrix = new Matrix4().makeScale(\n            1 / (map.mapSize * map.tileSize),\n            1,\n            1 / (map.mapSize * map.tileSize),\n        );\n        return new CPCTerrainMaterial({\n            vertexMap,\n            fragmentMap,\n            mapSize,\n            version,\n            yScale,\n            textureArray,\n            heightmapMatrix,\n        });\n    }, [map, rsc])\n\n    const geometry = React.useMemo(() => {\n        let geo = new PlaneBufferGeometry(\n            map.mapSize * map.tileSize, map.mapSize * map.tileSize,\n            map.mapSize - 1, map.mapSize - 1\n        );\n        // Lay it flat\n        geo.rotateX(-Math.PI / 2);\n        // and make it start at (0,0)\n        geo.translate(\n            map.mapSize * map.tileSize / 2,\n            0,\n            map.mapSize * map.tileSize / 2\n        );\n        return geo;\n    }, [/*viewDistance, */map.mapSize, map.tileSize]);\n\n    return (\n        <mesh position={position} geometry={geometry} material={material} />\n    )\n}\n\nexport default Terrain;\n","// Legacy file, feel free to move code out.\n// It should turn into CPC(Load).ts, only\n// handling loading the MAP/RSC file and\n// compensating for any C1/C2 differences\n// where necessary.\nimport KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport {\n    Vector3,\n} from 'three';\n\nimport MAP from '../kaitai/Map';\nimport RSC from '../kaitai/Rsc';\n\nfunction getLandings(map: any) {\n\n    const mapSize = map.mapSize;\n    const landingList: Vector3[] = [];\n\n    function getHeight(x: number, y: number) {\n        return map.heightMap[y * map.mapSize + x] * map.yScale;\n    }\n\n    for (let y = 0; y < mapSize; y++) {\n        for (let x = 0; x < mapSize; x++) {\n            const obj = map.objectMap[y * mapSize + x];\n            if (obj === 254) {\n                // Landing list\n                landingList.push(\n                    new Vector3(\n                        x * map.tileSize,\n                        getHeight(x, y),\n                        y * map.tileSize    \n                    )\n                );\n            }\n        }\n    }\n\n    return landingList;\n}\n\nexport async function loadArea(mapUrl: string, rscUrl: string) {\n    const mapBuffer = await fetch(mapUrl).then(body => body.arrayBuffer());\n    const rscBuffer = await fetch(rscUrl).then(body => body.arrayBuffer());\n\n    const map = new MAP(new KaitaiStream(mapBuffer));\n    const rsc = new RSC(new KaitaiStream(rscBuffer), undefined, undefined, map.version);\n    console.log(rsc, map)\n\n    const landings = getLandings(map);\n\n    function getLandH(x: number, z: number) {\n        const { tileSize, mapSize } = map;\n\n        // XXX problem for C1/C2 compatibility!\n        // C1: waterMap has water \"floor\" heights, while heightmap has water \"level\" heights\n        // C2: heightMap has water \"floor\" heights, waterMap contains indices into water table\n        //     specifying water levels.\n        const hmap = map.version == 1 ? 'waterMap' : 'heightMap';\n        const compensation = map.version == 1 ? 48 : 0;\n\n        if (x < 0) x = 0;\n        if (z < 0) z = 0;\n\n        const cx = Math.floor(x / tileSize);\n        const cy = Math.floor(z / tileSize);\n        const dx = Math.floor(x % tileSize);\n        const dy = Math.floor(z % tileSize);\n     \n        let h1 = map[hmap]![cy * mapSize + cx];\n        let h2 = map[hmap]![cy * mapSize + cx +1];\n        let h3 = map[hmap]![(cy + 1) * mapSize + cx +1];\n        let h4 = map[hmap]![(cy + 1) * mapSize + cx];\n\n        if (map.flagsMap![cy * mapSize + cx].fReverse) {\n            if (256 - dx > dy)\n                h3 = h2 + h4 - h1;\n            else\n                h1 = h2 + h4 - h3;\n        } else {\n            if (dx > dy) {\n                h4 = h1 + h3 - h2;\n            } else {\n                h2 = h1 + h3 - h4;\n            }\n        }\n     \n        let h = \n            (h1 * (256 - dx) + h2 * dx) * (256 - dy) +\n            (h4 * (256 - dx) + h3 * dx) * dy;\n     \n        return  (h / 256 / 256 - compensation) * map.yScale;\n    }\n\n    function getLandQHNoObj(x: number, z: number) {  \n        return Math.max(\n            getLandH(x, z),\n            getLandH(x-90, z-90),\n            getLandH(x+90, z-90),\n            getLandH(x-90, z+90),\n            getLandH(x+90, z+90),\n         \n            getLandH(x+128, z),\n            getLandH(x-128, z),\n            getLandH(x, z+128),\n            getLandH(x, z-128),\n        );\n    }\n\n    return {\n        map,\n        rsc,\n        landings,\n        getHeightAt: getLandQHNoObj,\n    };\n}\n","import React from 'react'\n\nimport { useFrame } from '@react-three/fiber';\nimport { Clock, Vector3 } from 'three';\n\nconst controls = {\n    forward: false,\n    backward: false,\n    left: false,\n    right: false,\n    run: false,\n}\n\nfunction handleKeys(event: KeyboardEvent) {\n    const down = event.type === 'keydown';\n    // ALT-W/S/A/D seems to trigger in-browser functionality\n    // when the browser changes focus, we loose keyup events, and\n    // the player keeps moving.\n    // XXX is this better handled by calling event.preventDefault()?\n    if (event.altKey) return;\n    switch(event.key.toLowerCase()) {\n        case 'w': controls.forward = down; break;\n        case 's': controls.backward = down; break;\n        case 'a': controls.left = down; break;\n        case 'd': controls.right = down; break;\n        case 'shift': controls.run = down; break;\n        default: console.log(event.key, down);\n    }\n}\n\ninterface Props {\n    getHeightAt: (x: number, z: number) => number;\n    landings: Vector3[];\n}\n\nexport default function Player({ getHeightAt, landings }: Props) {\n    React.useEffect(() => {\n        document.addEventListener('keydown', handleKeys);\n        document.addEventListener('keyup', handleKeys);\n        return () => {\n            document.removeEventListener('keydown', handleKeys);\n            document.removeEventListener('keyup', handleKeys);\n        }\n    })\n\n    const velocity = new Vector3();\n    const direction = new Vector3();\n    const _vector = new Vector3();\n\n    const initPos = landings[Math.floor(landings.length * Math.random())];\n    let initial = true;\n\n    const velocityDrag = 10.0;\n    const mass = 100.0;\n    const gravity = 9.8;\n    const speed = 7000.0;\n    const eyeHeight = 220;\n    const clock  = new Clock();\n\n    useFrame(({ camera }) => {\n        let delta = clock.getDelta();\n\n        if (initial) {\n            camera.position.copy(initPos);\n            initial = false;\n        }\n\n        velocity.x -= velocity.x * velocityDrag * delta;\n        velocity.z -= velocity.z * velocityDrag * delta;\n\n        velocity.y -= gravity * mass * delta;\n\n        direction.z = Number( controls.forward ) - Number( controls.backward );\n        direction.x = Number( controls.right ) - Number( controls.left );\n        direction.normalize(); // this ensures consistent movements in all directions\n\n        const spd = speed * (controls.run ? 4 : 1);\n        if ( controls.forward || controls.backward ) velocity.z -= direction.z * spd * delta;\n        if ( controls.left || controls.right ) velocity.x -= direction.x * spd * delta;\n\n        // move right\n        _vector.setFromMatrixColumn( camera.matrix, 0 );\n        camera.position.addScaledVector( _vector, - velocity.x * delta );\n\n        // move forward\n        _vector.setFromMatrixColumn( camera.matrix, 0 );\n        _vector.crossVectors( camera.up, _vector );\n        camera.position.addScaledVector( _vector, -velocity.z * delta );\n\n        // move down\n        camera.position.y += ( velocity.y * delta );\n\n        const height = getHeightAt(camera.position.x, camera.position.z);\n        if ( camera.position.y < height + eyeHeight ) {\n\n            velocity.y = 0;\n            camera.position.y = height + eyeHeight;\n\n            //onGround = true;\n        }\n    })\n\n    return null\n}\n","import { DataTexture, RGBAFormat, UnsignedShort5551Type } from \"three\";\n\nexport function createTexture(texData: Uint8Array, width: number, height: number, useAlpha: boolean = true) {\n    let data = new Uint16Array(width * height);\n    let offset = 0;\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        const j = y * width + x;\n        let pixel = (texData[j*2+1] << 8) | texData[j*2];\n        let r = ((pixel >> 10) & 0x1f);\n        let g = ((pixel >>  5) & 0x1f);\n        let b = ((pixel >>  0) & 0x1f);\n        let a = useAlpha ? (pixel ? 1 : 0) : 1;\n        data[offset++] = (r << 11) + (g << 6) + (b << 1) | a;\n      }\n    }\n  \n    const tex = new DataTexture(\n        data, width, height,\n        RGBAFormat, UnsignedShort5551Type,\n    );\n    tex.needsUpdate = true;\n    return tex;\n  }\n","import { useFrame } from '@react-three/fiber';\nimport React from 'react';\nimport { DoubleSide, RepeatWrapping } from 'three';\nimport { createTexture } from '../legacy/utils';\n\ninterface Props {\n    rsc: any;\n    map: any;\n}\n\nfunction Sky({ map, rsc }: Props) {\n    const skyTexture = React.useMemo(() => {\n        let tex = createTexture(rsc.daySkyTexture, rsc.skyTextureWidth, rsc.skyTextureHeight);\n        tex.wrapS = tex.wrapT = RepeatWrapping;\n        tex.anisotropy = 16;\n        tex.repeat.set(10, 10);\n        return tex;\n    }, [rsc]);\n\n    const halfMapWorld = map.mapSize * map.tileSize / 2;\n\n    useFrame(() => {\n        skyTexture.offset.x += 0.0002;\n    })\n\n    return (\n        <mesh position={[halfMapWorld,0,halfMapWorld]}>\n            <sphereBufferGeometry args={[map.mapSize * map.tileSize]} />\n            <meshBasicMaterial map={skyTexture} side={DoubleSide} />\n        </mesh>\n    )\n}\n\nexport default Sky;\n","import { BufferGeometry, Float32BufferAttribute } from \"three\"\n\nexport default class C3DFGeometry extends BufferGeometry {\n    constructor(c3dfObject: any) {\n        super();\n\n        const { faces, vertices } = c3dfObject;\n\n        let position: number[] = [];\n        let uv: number[] = [];\n        faces.forEach((f: any) => {\n            let a = f.v1, b = f.v2, c = f.v3;\n    \n            // *2 taken from LoadModel from original code\n            position.push(vertices[a].x * 2, vertices[a].y * 2, vertices[a].z * 2);\n            uv.push(f.tax / 256, f.tay / 256);\n            position.push(vertices[b].x * 2, vertices[b].y * 2, vertices[b].z * 2);\n            uv.push(f.tbx / 256, f.tby / 256);\n            position.push(vertices[c].x * 2, vertices[c].y * 2, vertices[c].z * 2);\n            uv.push(f.tcx / 256, f.tcy / 256);\n        });\n    \n        this.setAttribute('position', new Float32BufferAttribute(position, 3));\n        this.setAttribute('uv', new Float32BufferAttribute(uv, 2));\n        this.computeVertexNormals();\n    }\n}","import React from 'react';\nimport { DoubleSide, Group, InstancedMesh, Matrix4, MeshBasicMaterial } from 'three';\nimport C3DFGeometry from '../legacy/C3DFGeometry';\nimport { createTexture } from '../legacy/utils';\n\ninterface Props {\n    map: any;\n    rsc: any;\n    getHeightAt: (x: number, z: number) => number;\n}\n\nfunction Scenery({ map, rsc, getHeightAt }: Props) {\n    const group = React.useMemo(() => {\n        const { mapSize, objectMap, tileSize } = map;\n        const parent = new Group();\n        // Create matrices for all scenery\n        const matrices: number[][] = [];\n        const matrix = new Matrix4();\n        for (let y = 0; y < mapSize; y++) {\n            for (let x = 0; x < mapSize; x++) {\n                const obj = objectMap[y * mapSize + x];\n                if (obj < 254) {\n                    matrix.makeTranslation(\n                        x * tileSize,\n                        getHeightAt(x * tileSize, y * tileSize),\n                        y * tileSize);\n                    if (!matrices[obj]) {\n                        matrices[obj] = matrix.toArray();\n                    } else {\n                        matrices[obj].push.apply(matrices[obj], matrix.toArray())\n                    }\n                }\n            }\n        }\n\n        rsc.models.forEach((mdl: any, obj: number) => {\n            if (matrices[obj]) {\n                const count = matrices[obj].length / 16;\n                const geo = new C3DFGeometry(mdl.model);\n                const tex = createTexture(mdl.model.textureData, mdl.model.textureWidth, mdl.model.textureHeight);\n                const mesh = new InstancedMesh(\n                    geo, new MeshBasicMaterial({ map: tex, fog: true, transparent: true, alphaTest: 0.5, side: DoubleSide }),\n                    count,\n                );\n                for (let i = 0; i < count; i++) {\n                    matrix.fromArray(matrices[obj], i * 16)\n                    mesh.setMatrixAt(i, matrix)\n                }\n                parent.add(mesh)\n            }\n        })\n\n        return parent;\n    }, [rsc, map, getHeightAt]);\n\n    return (\n        <primitive object={group} />\n    )\n}\n\nexport default Scenery;","import React from 'react';\nimport { Html, PointerLockControls, Stats } from '@react-three/drei';\nimport Terrain from './Terrain';\nimport { loadArea } from '../legacy/hunt';\nimport Player from '../Player';\nimport Sky from './Sky';\nimport Scenery from './Scenery';\nimport { Canvas } from '@react-three/fiber';\n\ninterface Props {\n    mapUrl: string;\n    rscUrl: string;\n}\n\nfunction World({ mapUrl, rscUrl }: Props) {\n    const [world, setWorld] = React.useState<any>();\n\n    React.useEffect(() => {\n        loadArea(mapUrl, rscUrl).then(world => {\n            setWorld(world);\n        })\n    }, [mapUrl, rscUrl]);\n\n    return world ? (\n        <>\n            <Canvas\n                shadows\n                linear\n                camera={{\n                    fov: 30,\n                    near: 1,\n                    far: 1000000,\n                }}\n            >\n                <Stats />\n                <PointerLockControls />\n\n                <React.Suspense fallback={<Html center>Loading, please wait</Html>}>\n\n                    <Sky rsc={world.rsc} map={world.map} />\n                    <Terrain rsc={world.rsc} map={world.map} />\n                    <Scenery rsc={world.rsc} map={world.map} getHeightAt={world.getHeightAt} />\n                    <Player landings={world.landings} getHeightAt={world.getHeightAt} />\n\n                </React.Suspense>\n\n            </Canvas>\n\n        </>\n    ) : <></>\n}\n/*\n    <fog near={10*256} far={140*256} attach=\"fog\" />\n*/\n\nexport default World;\n","import React from 'react'\n\nimport './Home.css'\nimport World from '../components/World'\n\nexport default function Home() {\n    const [ world, setWorld ] = React.useState({\n        map: 'HUNTDAT/AREAS/AREA1.MAP',\n        rsc: 'HUNTDAT/AREAS/AREA1.RSC',\n    });\n\n    function dragOver(ev: React.DragEvent) {\n        ev.preventDefault();\n    } \n\n    function drop(ev: React.DragEvent) {\n        ev.preventDefault();\n        if (ev.dataTransfer.files?.length) {\n            let map = null;\n            let rsc = null;\n            for (let i = 0; i < ev.dataTransfer.files.length; i++) {\n                const f = ev.dataTransfer.files[i];\n                if (f.name.toUpperCase().endsWith('.MAP')) {\n                    map = URL.createObjectURL(f);\n                } else if (f.name.toUpperCase().endsWith('.RSC')) {\n                    rsc = URL.createObjectURL(f);\n                }\n            }\n            if (map && rsc) {\n                setWorld({ map, rsc });\n            }\n        }\n    }\n\n    return (\n        <div\n            onDragOver={dragOver}\n            onDrop={drop}\n            className={'dndContainer'}\n        >\n            <World\n                mapUrl={world.map}\n                rscUrl={world.rsc}\n            />\n        </div>\n    )\n}\n","//https://medium.com/@pdx.lucasm/canvas-with-react-js-32e133c05258\nimport React from 'react';\n\ninterface CanvasProps {\n    width?: number;\n    height?: number;\n    drawContent?: (context: CanvasRenderingContext2D) => void;\n}\n\nconst Canvas: React.FC<CanvasProps> = ({drawContent, width, height, ...props}) => {\n    const canvasRef = React.useRef<HTMLCanvasElement>(null)\n\n    React.useEffect(() => {\n        const canvas = canvasRef.current\n        const context = canvas?.getContext('2d')\n        if (canvas && context) {\n            if (width !== undefined) {\n                context.canvas.width = width;\n            }\n            if (height !== undefined) {\n                context.canvas.height = height;\n            }\n            if (drawContent) {\n                drawContent(context);\n            } else {\n                context.fillStyle = '#000000'\n                context.fillRect(0, 0, context.canvas.width, context.canvas.height)\n            }\n        }\n    }, [drawContent, height, width])\n\n\n    return (\n        <canvas\n            ref={canvasRef}\n            {...props}\n        />\n    );\n}\n\nexport default Canvas;\n","import React from 'react'\n\nimport KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport MAP from '../kaitai/carnivores_map';\nimport Canvas from '../components/Canvas';\n\nconst generateHeightmap = (map: any, field: string) => {\n    let imageData = new ImageData(map.mapSize, map.mapSize);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        imageData.data[i*4+0] = map[field][i];\n        imageData.data[i*4+1] = map[field][i];\n        imageData.data[i*4+2] = map[field][i];\n        imageData.data[i*4+3] = 0xff;\n    }\n    return imageData;\n}\n\nconst generateFlagsMap = (map: any, r: number, g: number, b: number) => {\n    let imageData = new ImageData(map.mapSize, map.mapSize);\n    const bitToColorChannel = (flags: number, bit: number) => ((flags & (1 << bit)) !== 0 ? 0 : 255);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        let val = map.flagsMap[i];\n        imageData.data[i*4+0] = r !== -1 ? bitToColorChannel(val, r) : 0;\n        imageData.data[i*4+1] = g !== -1 ? bitToColorChannel(val, g) : 0;\n        imageData.data[i*4+2] = b !== -1 ? bitToColorChannel(val, b) : 0;\n        imageData.data[i*4+3] = 0xff;\n    }\n    return imageData;\n}\n\ninterface BitSelectProps {\n    bitCount: number;\n    value: number;\n    onChange: (bit: number) => void;\n}\n\nconst BitSelect: React.FC<BitSelectProps> = ({\n    value = 0,\n    bitCount = 8,\n    onChange,\n}) => {\n    return (\n        <select value={value} onChange={event => onChange(parseFloat(event.target.value))}>\n            <option value=\"-1\">n/a</option>\n            {new Array(bitCount).fill(0).map((_,i) => (\n                <option key={i} value={i}>bit {i}</option>\n            ))}\n        </select>\n    )\n}\n\nexport default function MapEditor() {\n    const [ map, setMap ] = React.useState<any>(null);\n    const [ mapName, setMapName ] = React.useState<string|null>(null);\n    const [ bitR, setBitR ] = React.useState(-1);\n    const [ bitG, setBitG ] = React.useState(-1);\n    const [ bitB, setBitB ] = React.useState(-1);\n    const [ mode, setMode ] = React.useState(1);\n\n    function dragOver(ev: React.DragEvent) {\n        ev.preventDefault();\n    } \n\n    function drop(ev: React.DragEvent) {\n        ev.preventDefault();\n        if (ev.dataTransfer.files?.length) {\n            const mapName = ev.dataTransfer.files[0].name;\n            const url = URL.createObjectURL(ev.dataTransfer.files[0]);\n            // fetch URL (retrieves local file, no physical network involved)\n            fetch(url).then(body => body.arrayBuffer()).then(buf => {\n                // Create KaitaiStream and load map\n                const map = new MAP(new KaitaiStream(buf));\n                setMapName(mapName);\n                setMap(map);\n            });\n        }\n    }\n\n    const getImageData = () => {\n        let imageData: ImageData | undefined;\n\n        switch(mode) {\n            case 0: // Flags\n                imageData = generateFlagsMap(map, bitR, bitG, bitB);\n                break;\n\n            case 1: // Heightmap\n                imageData = generateHeightmap(map, 'heightMap');\n                break;\n\n            case 2: // Watertmap\n                imageData = generateHeightmap(map, 'waterMap');\n                break;\n        }\n\n        return imageData;\n    }\n\n    const drawMapContent = (ctx: CanvasRenderingContext2D) => {\n        const imageData = getImageData();\n        if (imageData) {\n            ctx.putImageData(imageData, 0, 0);\n        }\n    }\n\n    const downloadImageData = () => {\n        const imageData = getImageData();\n        if (imageData) {\n            var canvas = document.createElement('canvas');\n            var ctx = canvas.getContext(\"2d\");\n            if (ctx) {\n                ctx.canvas.width = imageData.width;\n                ctx.canvas.height = imageData.height;\n                ctx.putImageData(imageData, 0, 0);\n                var dataImage = canvas.toDataURL(\"image/png\");\n\n                let name: string = mapName?.replace(/\\.MAP$/i, '') || '';\n                switch(mode) {\n                    case 0:\n                        name += `-r${bitR}g${bitG}b${bitB}.png`;\n                        break;\n                    case 1: \n                        name += '-height.png';\n                        break;\n                    case 2: \n                        name += '-water.png';\n                        break;\n                }\n\n                const link = document.createElement('a');\n                link.setAttribute('download', name);\n                link.setAttribute('href', dataImage.replace(\"image/png\", \"image/octet-stream\"));\n                link.click();\n            }\n        }\n    }\n\n    return (\n        <div onDragOver={dragOver} onDrop={drop} style={{width: '100%', height: '100%', margin: '5px', userSelect: 'text'}}>\n            {map && mapName ? (\n                <>\n                    <h1>{mapName}</h1>\n                    <select value={mode} onChange={ev => setMode(parseInt(ev.target.value))}>\n                        <option value=\"0\">Flags</option>\n                        <option value=\"1\">Heightmap</option>\n                        <option value=\"2\">Watermap</option>\n                    </select>\n                    {\n                        mode === 0 && (\n                            <>\n                                <BitSelect value={bitR} bitCount={16} onChange={bit => setBitR(bit)} />\n                                <BitSelect value={bitG} bitCount={16} onChange={bit => setBitG(bit)} />\n                                <BitSelect value={bitB} bitCount={16} onChange={bit => setBitB(bit)} />      \n                            </>\n                        )\n                    }\n                    <button\n                        onClick={downloadImageData}\n                        >\n                            Download\n                    </button>\n                    <br/>\n                    <br/>\n                    <Canvas\n                        width={map.mapSize}\n                        height={map.mapSize}\n                        drawContent={drawMapContent}\n                    />\n                </>\n            ) : (\n                <h1>Drop a Carnivores 1/2/IceAge MAP file here</h1>\n            )}\n        </div>\n    )\n}","import {\n    BufferGeometry,\n    DoubleSide,\n    Float32BufferAttribute,\n    Loader,\n    LoadingManager,\n    MeshBasicMaterial,\n} from 'three'\n\nimport {\n    MorphBlendMesh\n} from 'three/examples/jsm/misc/MorphBlendMesh';\n\nimport CAR from '../kaitai/Car';\nimport KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport { createTexture } from './utils';\n\nexport default class CARLoader extends Loader {\n\tconstructor(manager?: LoadingManager) {\n\t\tsuper(manager);\n\t}\n\n    load(\n        url: string,\n        onLoad: (character: MorphBlendMesh) => void,\n        onProgress: (event: ProgressEvent) => void, // XXX no progress support yet\n        onError: (event: Error | ErrorEvent ) => void,\n     ) {\n         fetch(url).then(body => body.arrayBuffer()).then(buffer => {\n             onLoad( this.parse(buffer) );\n         }).catch(e => {\n             onError(e);\n         })\n    }\n\n    parse(buffer: ArrayBuffer) {\n        const car = new CAR(new KaitaiStream(buffer));\n        const frames = car.animations!.flatMap(a => a.frames);\n        const morphVertices = new Array(frames.length);\n        let position: number[] = [];\n        let uv: number[] = [];\n\n        const { faces, vertices } = car;\n\n        for (let i = 0; i < frames.length; i++) {\n            morphVertices[i] = new Array<number>();\n        }\n\n        function addVert(origVIdx: number, u: number, v: number) {\n            let { x, y, z } = vertices![origVIdx];\n            // *2 taken from LoadCharacterInfo from original code\n            x *= 2; y *= 2; z *= 2;\n            position.push(x, y, z);\n            uv.push(u, v);\n\n            frames.forEach((frame,idx) => {\n                morphVertices[idx].push(\n                    frame.vertices[origVIdx].x * 2, // these are already converted\n                    frame.vertices[origVIdx].y * 2, //    from short to float\n                    frame.vertices[origVIdx].z * 2,\n                )\n            })\n        }\n\n        faces!.forEach((f: any) => {\n            let a = f.v1, b = f.v2, c = f.v3;\n            addVert(a, f.tax / 256, f.tay / 256);\n            addVert(b, f.tbx / 256, f.tby / 256);\n            addVert(c, f.tcx / 256, f.tcy / 256);\n        });\n      \n        // Setup basic model geo data\n        let geo = new BufferGeometry();\n        geo.setAttribute('position', new Float32BufferAttribute(position, 3));\n        geo.setAttribute('uv', new Float32BufferAttribute(uv, 2));\n\n        // Add animation data\n        geo.morphAttributes.position = [];\n        let globalFrameIndex = 0;\n        car.animations?.forEach(anim => {\n            let name = anim.name;\n            anim.frames.forEach((_: any, frIdx: number) => {\n                const attr = new Float32BufferAttribute(morphVertices[globalFrameIndex], 3);\n                attr.name = `${name}.${frIdx}`;\n                geo.morphAttributes.position.push(attr);\n                ++globalFrameIndex;\n            })\n        })\n\n        let mat = new MeshBasicMaterial({\n            map: createTexture(car.textureData, car.textureWidth, car.textureHeight, false),\n            side: DoubleSide,\n            morphTargets: true,\n        })\n\n        let mesh = new MorphBlendMesh(geo, mat);\n\n        // Create animation clips\n        globalFrameIndex = 0;\n        car.animations?.forEach(anim => {\n            mesh.createAnimation(anim.name, globalFrameIndex, globalFrameIndex + anim.frameCount -1, anim.framesPerSecond);\n            globalFrameIndex += anim.frameCount;\n        })\n\n        return mesh;\n    }\n}","import { OrbitControls } from '@react-three/drei';\nimport { Canvas, useLoader } from '@react-three/fiber';\nimport React from 'react';\nimport { useEffect } from 'react';\nimport DatGui, { DatSelect } from 'react-dat-gui';\nimport { Clock } from 'three';\n\nimport CARLoader from '../legacy/CARLoader';\n\ninterface Props {\n    modelUri: string;\n}\nfunction ModelViewer({ modelUri }: Props) {\n    const model = useLoader(CARLoader, modelUri);\n    const animations = Object.keys(model.animationsMap);\n    const [ data, setData ] = React.useState({ animation: '' });\n    const clock = new Clock();\n\n    useEffect(() => {\n        const intvHandle = setInterval(() => {\n            const delta = clock.getDelta();\n            model.update(delta);    \n        }, 1000/60);\n        return () => clearInterval(intvHandle);\n    });\n\n    function handleUpdate(updated: any) {\n        console.log(data, updated);\n        if (data.animation) {\n            model.stopAnimation(data.animation);\n            for (let i = 0; i < model.morphTargetInfluences!.length; i++) {\n                model.morphTargetInfluences![i] = 0;\n            }        \n        }\n        model.playAnimation(updated.animation);\n        setData(updated);\n    }\n\n    return (\n    <>\n        <DatGui data={data} onUpdate={handleUpdate}>\n            <DatSelect path=\"animation\" options={animations} />\n        </DatGui>\n\n        <Canvas\n            linear\n            camera={{\n                position: [0,500,-500],\n                far: 10000,\n            }}\n        >\n            <OrbitControls target={[0, 200, 0]} />\n            <primitive object={model} />\n        </Canvas>\n    </>\n    )\n}\n\nexport default function ModelEditor() {\n    const [ modelUri, setModelUri ] = React.useState('HUNTDAT/HUNTER1.CAR');\n    \n    function dragOver(ev: React.DragEvent) {\n        ev.preventDefault();\n    } \n\n    function drop(ev: React.DragEvent) {\n        ev.preventDefault();\n        if (ev.dataTransfer.files?.length) {\n            const mapName = ev.dataTransfer.files[0].name;\n            const url = URL.createObjectURL(ev.dataTransfer.files[0]);\n            setModelUri(url);\n        }\n    }\n\n    return (\n        <div onDragOver={dragOver} onDrop={drop} style={{width: '100%', height: '100%', overflow: 'hidden'}}>\n            <React.Suspense fallback={null}>\n                <ModelViewer modelUri={modelUri} />\n            </React.Suspense>\n        </div>\n    )\n}","import React from 'react'\n\nimport {\n  HashRouter as Router,\n  Switch,\n  Route,\n} from 'react-router-dom';\n\nimport Home from './pages/Home';\nimport MapEditor from './pages/MapEditor';\nimport ModelEditor from './pages/ModelEditor';\n\nexport default function App() {\n  return (\n    <Router>\n      <Switch>\n        <Route exact path=\"/\">\n          <Home />\n        </Route>\n        <Route path=\"/edit-map\">\n          <MapEditor />\n        </Route>\n        <Route path=\"/edit-model\">\n          <ModelEditor />\n        </Route>\n      </Switch>\n    </Router>\n  )\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}