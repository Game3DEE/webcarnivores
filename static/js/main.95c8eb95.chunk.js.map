{"version":3,"sources":["legacy/hunt.ts","Player.tsx","pages/Home.tsx","components/Canvas.tsx","pages/MapEditor.tsx","pages/ModelEditor.tsx","App.tsx","reportWebVitals.ts","index.tsx","kaitai/carnivores_map.js","kaitai/carnivores1_rsc.js"],"names":["areaPath","mapScale","terrainTexSize","createMapGeometry","map","geo","PlaneBufferGeometry","mapSize","rotateX","Math","PI","i","attributes","position","setY","heightMap","computeVertexNormals","toNonIndexed","createTextureAtlas","rsc","textureDim","ceil","sqrt","textureCount","textureStride","data","Uint8Array","top","floor","left","offset","y","x","pixel","textures","texSize","console","log","byteLength","tex","DataTexture","RGBFormat","UnsignedByteType","needsUpdate","setupTerrainUV","geometry","atlasTexture","image","width","uvStep","uv","uvidx","tidx","textureMap1","rot","flagsMap","ty","tx","coords","a","b","c","d","e","f","setX","createInstancedModels","parent","matrices","halfMapSize","getHeight","matrix","Matrix4","obj","objectMap","makeTranslation","push","apply","toArray","indicator","Mesh","SphereBufferGeometry","MeshLambertMaterial","color","set","add","models","forEach","mdl","count","length","vertices","faces","idx","BufferGeometry","index","findUvForVertex","vIdx","u","v","z","v1","v2","v3","tax","tay","tbx","tby","tcx","tcy","setAttribute","Float32BufferAttribute","setIndex","createGeometry","texData","height","RGBAFormat","createTexture","textureData","textureSize","mesh","InstancedMesh","transparent","alphaTest","fromArray","setMatrixAt","area","scene","Group","fetch","then","body","arrayBuffer","mapBuffer","rscBuffer","MAP","KaitaiStream","RSC","error","undefined","controls","forward","backward","right","run","handleKeys","event","down","type","key","toLowerCase","Player","getHeightAt","React","useEffect","document","addEventListener","removeEventListener","motion","Vector3","velocity","quat","Quaternion","onGround","clock","Clock","useFrame","camera","delta","getDelta","speed","getWorldQuaternion","makeRotationY","applyMatrix4","nextPosition","clone","ground","Terrain","setLoading","useThree","time","loadArea","world","timeEnd","Home","useState","isLoading","className","shadows","linear","fov","near","far","Stats","args","shadow-mapSize-width","shadow-mapSize-height","shadow-camera-left","shadow-camera-right","shadow-camera-top","shadow-camera-bottom","shadow-camera-far","castShadow","PointerLockControls","Canvas","drawContent","props","canvasRef","useRef","canvas","current","context","getContext","fillStyle","fillRect","ref","generateHeightmap","field","imageData","ImageData","BitSelect","value","bitCount","onChange","parseFloat","target","Array","fill","_","MapEditor","setMap","mapName","setMapName","bitR","setBitR","bitG","setBitG","bitB","setBitB","mode","setMode","getImageData","r","g","bitToColorChannel","flags","bit","val","generateFlagsMap","onDragOver","ev","preventDefault","onDrop","dataTransfer","files","name","url","URL","createObjectURL","buf","style","margin","userSelect","parseInt","onClick","createElement","ctx","putImageData","dataImage","toDataURL","replace","link","click","ModelEditor","App","exact","path","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById","define","Carnivores1Map","_io","_parent","_root","this","_read","prototype","readBytes","isV1","readU1","readU2le","textureMap2","lightMap","isV2","dawnLightMap","dayLightMap","nightLightMap","waterMap","objectHeightMap","fogsMap","ambientMap","Object","defineProperty","get","_m_isV1","size","_m_isV2","_m_isValid","_m_mapSize","CarnivoresRsc","readU4le","modelCount","skyRgb","Rgb","skyTRgb","Texture","Model","skyTexture","skyTextureSize","skyMap","fogCount","fogList","FogEntry","randomSoundCount","randomSounds","RandomSound","ambientSoundCount","ambientSounds","AmbientSound","Vertex","readF4le","owner","readS2le","hide","modelInfo","ModelInfo","vertCount","faceCount","nodeCount","Face","nodes","Node","isAnimated","animation","ModelAnimation","Trd","rNumber","rVolume","rFrequency","rEnvironment","radius","readS4le","yLo","yHi","lineLength","lIntensity","circleRad","cIntensity","grRad","refLight","lastAniTime","boundR","reserved","_m_isAnimated","_m_notLighted","_m_needsBound","vc0","vc1","vc2","kps","frameCount","frames","dMask","distant","next","group","fogRgb","yBegin","mortal","transp","fLimit","pcmSize","pcm","rData","rsfxCount","aVolume","bytesToStr","bytesTerminate","_m_size","_m_skyTextureSize"],"mappings":"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","file":"static/js/main.95c8eb95.chunk.js","sourcesContent":["import KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport {\n    BufferGeometry,\n    DataTexture,\n    Float32BufferAttribute,\n    Group,\n    InstancedMesh,\n    Matrix4,\n    Mesh,\n    MeshLambertMaterial,\n    PlaneBufferGeometry,\n    RGBAFormat,\n    RGBFormat,\n    SphereBufferGeometry,\n    Texture,\n    UnsignedByteType\n} from 'three';\n\nimport MAP from '../kaitai/carnivores_map';\nimport RSC from '../kaitai/carnivores1_rsc';\n\nconst areaPath = 'HUNTDAT/AREAS';\n\nconst mapScale = 256; // size of one map square\nconst mapHScale = 32; // Y scale for heightfield\nconst terrainTexSize = 128; // terrain textures are 128x128 pix\n\nfunction createMapGeometry(map: any) {\n    // Create a plane with divisions as base for map heightfield\n    const geo = new PlaneBufferGeometry(\n        map.mapSize * mapScale, map.mapSize * mapScale,\n        map.mapSize - 1, map.mapSize - 1\n    );\n\n    // Lay it flat\n    geo.rotateX(-Math.PI / 2);\n\n    // Set heights based on heightfield\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        geo.attributes.position.setY(i, map.heightMap[i] * mapHScale);\n    }\n\n    // Compute normals for lighting\n    geo.computeVertexNormals();\n\n    // Return a non-indexed version of the geometry, since we're going to need\n    // to generate the UVs for the texture atlas mapping\n    return geo.toNonIndexed();\n}\n\n// Create a texture atlas for all terrain textures\n// this makes it possible to simply use UV assignments per \"square\"\n// in the terrain to render the correct textures\n// (and since it is all in one texture it helps prevent re-binding of textures)\nfunction createTextureAtlas(rsc: any) {\n    // Calculate W/H of atlas (we make a square texture atlas)\n    const textureDim = Math.ceil(Math.sqrt(rsc.textureCount));\n    const textureStride = textureDim * terrainTexSize * 3; // bytes used per single pixel row\n\n    // Allocate storage for texture atlas\n    const data = new Uint8Array(textureDim * textureStride * terrainTexSize)\n\n    // Now go over all textures...\n    for (let i = 0; i < rsc.textureCount; i++) {\n        // Determine where in the atlas grid this texture should go\n        let top = Math.floor(i / textureDim)\n        let left = Math.floor(i % textureDim)\n        // ... and the actual byte offset in our data\n        let offset = (top * textureStride * terrainTexSize) + (left * terrainTexSize * 3);\n        // Now go over the texture and decode the 16 bit texture into our 24 bit one\n        for (let y = 0; y < terrainTexSize; y++) {\n            for (let x = 0; x < terrainTexSize; x++) {\n                let pixel = rsc.textures[i].data[y * terrainTexSize + x]\n                data[offset++] = ((pixel >> 10) & 0x1f) << 3;\n                data[offset++] = ((pixel >> 5) & 0x1f) << 3;\n                data[offset++] = ((pixel >> 0) & 0x1f) << 3;\n            }\n            offset -= terrainTexSize * 3;\n            offset += textureStride;\n        }\n    }\n    // Done! Now simply create a ThreeJS texture from the data\n    const texSize = textureDim * terrainTexSize;\n    console.log(rsc, texSize, textureDim, data.byteLength)\n    const tex = new DataTexture(data, texSize, texSize, RGBFormat, UnsignedByteType);\n    tex.needsUpdate = true;\n\n    return tex;\n}\n\n// Set up the UVs for our texture atlas based on the texture map\nfunction setupTerrainUV(geometry: BufferGeometry, atlasTexture: Texture, map: any) {\n    // Get number of textures per row in our atlas\n    const textureDim = atlasTexture.image.width / terrainTexSize;\n    // size of one texture in our map in UV coordinates (they are 0...1)\n    const uvStep = 1 / textureDim;\n    const uv = geometry.attributes.uv;\n    let uvidx = 0;\n    // Loop through the entire map\n    for (let y = 0; y < map.mapSize - 1; y++) {\n        for (let x = 0; x < map.mapSize - 1; x++) {\n            // Get the texture number\n            const tidx = map.textureMap1[map.mapSize * y + x];\n            // get the rotation of the texture\n            const rot = map.flagsMap[map.mapSize * y + x] & 3;\n            // calculate position of texture from atlas in UV coords\n            const ty = Math.floor(tidx / textureDim) * uvStep;\n            const tx = Math.floor(tidx % textureDim) * uvStep;\n            // Okay, the code here gets a little messy, and could be optimised,\n            // but at least it reads nicer then the Carnivores code itself :P\n\n            // Four positions in uvmap to use\n            const coords = [\n                [tx, ty],\n                [tx, ty + uvStep],\n                [tx + uvStep, ty], // first triangle UV\n                [tx + uvStep, ty + uvStep],\n            ];\n            // map coordinates to all 6 vertices used for this grid square\n            let a = 0, b = 1, c = 2, d = 1, e = 3, f = 2;\n            // ... and take rotation into account\n            switch (rot) {\n                case 0: break; // default no rotation\n                case 1: // 90deg\n                    a = 1; b = d = 3; c = f = 0; e = 2;\n                    break;\n                case 2: // 180deg\n                    a = 3; b = d = 2; c = f = 1; e = 0;\n                    break;\n                case 3: // 270deg\n                    a = 2; b = d = 0; c = f = 3; e = 1;\n                    break;\n            }\n            // Okay, now simply set the UV for those 6 vertices\n            uv.setX(uvidx + 0, coords[a][0]);\n            uv.setY(uvidx + 0, coords[a][1]);\n            uv.setX(uvidx + 1, coords[b][0]);\n            uv.setY(uvidx + 1, coords[b][1]);\n            uv.setX(uvidx + 2, coords[c][0]);\n            uv.setY(uvidx + 2, coords[c][1]);\n\n            uv.setX(uvidx + 3, coords[d][0]);\n            uv.setY(uvidx + 3, coords[d][1]);\n            uv.setX(uvidx + 4, coords[e][0]);\n            uv.setY(uvidx + 4, coords[e][1]);\n            uv.setX(uvidx + 5, coords[f][0]);\n            uv.setY(uvidx + 5, coords[f][1]);\n\n            // .. and move on\n            uvidx += 6;\n        }\n    }\n    // Tell ThreeJS we modified the UVs...\n    uv.needsUpdate = true;\n}\n\nfunction createGeometry(vertices: any[], faces: any[]) {\n    let geo = new BufferGeometry();\n    let position: number[] = [];\n    let uv: number[] = [];\n    let index: number[] = [];\n    vertices.forEach(v => {\n        position.push(v.x, v.y, v.z);\n    });\n    function findUvForVertex(vIdx: number, u: number, v: number) {\n        // TODO: look for duplicate UVs and reuse\n        uv[vIdx * 2 + 0] = u;\n        uv[vIdx * 2 + 1] = v;\n        return vIdx;\n    }\n    let idx;\n    faces.forEach(f => {\n        let a = f.v1, b = f.v2, c = f.v3;\n\n        idx = findUvForVertex(a, f.tax / 256, f.tay / 256);\n        index.push(idx);\n        idx = findUvForVertex(b, f.tbx / 256, f.tby / 256);\n        index.push(idx);\n        idx = findUvForVertex(c, f.tcx / 256, f.tcy / 256);\n        index.push(idx);\n    });\n\n    geo.setAttribute('position', new Float32BufferAttribute(position, 3));\n    geo.setAttribute('uv', new Float32BufferAttribute(uv, 2));\n    geo.setIndex(index);\n    geo.computeVertexNormals();\n\n    return geo;\n}\n\nfunction createTexture(texData: Uint16Array, texSize: number) {\n    let width = 256;\n    let height = texSize / (width * 2);\n  \n    let data = new Uint8Array(width * height * 4);\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        let pixel = texData[y * width + x];\n        let offset = (y * width + x) * 4;\n        data[offset++] = ((pixel >> 10) & 0x1f) << 3;\n        data[offset++] = ((pixel >>  5) & 0x1f) << 3;\n        data[offset++] = ((pixel >>  0) & 0x1f) << 3;\n        data[offset++] = pixel ? 0xff : 0;\n      }\n    }\n  \n    const tex = new DataTexture(data, width, height, RGBAFormat, UnsignedByteType);\n    tex.needsUpdate = true;\n    return tex;\n  }\n\nfunction createInstancedModels(rsc: any, map: any, parent: Group) {\n\n    const matrices: number[][] = [];\n\n    const mapSize = map.mapSize;\n    const halfMapSize = mapSize / 2;\n\n    function getHeight(x: number, y: number) {\n        return map.heightMap[y * map.mapSize + x] * mapHScale;\n    }\n\n    const matrix = new Matrix4();\n    for (let y = 0; y < mapSize; y++) {\n        for (let x = 0; x < mapSize; x++) {\n            const obj = map.objectMap[y * mapSize + x];\n            if (obj < 254) {\n                matrix.makeTranslation(\n                    (x - halfMapSize) * mapScale,\n                    getHeight(x, y),\n                    (y - halfMapSize) * mapScale)\n                if (!matrices[obj]) {\n                    matrices[obj] = matrix.toArray();\n                } else {\n                    matrices[obj].push.apply(matrices[obj], matrix.toArray())\n                }\n            } else if (obj === 254) {\n                // Landing list\n                const indicator = new Mesh(\n                    new SphereBufferGeometry(128),\n                    new MeshLambertMaterial({ color: 0xff0000 }),\n                )\n                indicator.position.set(\n                    (x - halfMapSize) * mapScale,\n                    getHeight(x, y),\n                    (y - halfMapSize) * mapScale);\n\n                parent.add(indicator);\n            } else if (obj === 255) {\n                // empty\n            }\n        }\n    }\n\n    rsc.models.forEach((mdl: any, obj: number) => {\n        if (matrices[obj]) {\n            const count = matrices[obj].length / 16;\n            const geo = createGeometry(mdl.vertices, mdl.faces);\n            const tex = createTexture(mdl.textureData, mdl.textureSize);\n            const mesh = new InstancedMesh(\n                geo, new MeshLambertMaterial({ map: tex, transparent: true, alphaTest: 0.5 }),\n                count,\n            );\n            for (let i = 0; i < count; i++) {\n                matrix.fromArray(matrices[obj], i * 16)\n                mesh.setMatrixAt(i, matrix)\n            }\n            parent.add(mesh)\n        }\n    })\n}\n\nexport async function loadArea(area: string) {\n    let scene = new Group();\n\n    try {\n        const mapBuffer = await fetch(`${areaPath}/${area}.MAP`).then(body => body.arrayBuffer());\n        const rscBuffer = await fetch(`${areaPath}/${area}.RSC`).then(body => body.arrayBuffer());\n\n        const map = new MAP(new KaitaiStream(mapBuffer));\n        const rsc = new RSC(new KaitaiStream(rscBuffer));\n\n        const geo = createMapGeometry(map)\n        const atlasTexture = createTextureAtlas(rsc);\n        setupTerrainUV(geo, atlasTexture, map);\n\n        createInstancedModels(rsc, map, scene);\n\n        // Okay, terrain done!\n        scene.add(new Mesh(\n            geo,\n            new MeshLambertMaterial({ map: atlasTexture }),\n        ));\n    } catch (e) {\n        console.error(e)\n        return undefined;\n    }\n\n    return scene;\n}\n","import React from 'react'\n\nimport { useFrame } from '@react-three/fiber';\nimport { Clock, Matrix4, Quaternion, Vector3 } from 'three';\n\nconst controls = {\n    forward: false,\n    backward: false,\n    left: false,\n    right: false,\n    run: false,\n}\n\nfunction handleKeys(event: KeyboardEvent) {\n    const down = event.type === 'keydown';\n    switch(event.key.toLowerCase()) {\n        case 'w': controls.forward = down; break;\n        case 's': controls.backward = down; break;\n        case 'a': controls.left = down; break;\n        case 'd': controls.right = down; break;\n        case 'shift': controls.run = down; break;\n        default: console.log(event.key, down);\n    }\n}\n\ninterface Props {\n    getHeightAt: (x: number, z: number) => number;\n}\n\nexport default function Player({ getHeightAt }: Props) {\n    React.useEffect(() => {\n        document.addEventListener('keydown', handleKeys);\n        document.addEventListener('keyup', handleKeys);\n        return () => {\n            document.removeEventListener('keydown', handleKeys);\n            document.removeEventListener('keyup', handleKeys);\n        }\n    })\n\n    const motion = new Vector3();\n    const velocity = new Vector3();\n    const quat = new Quaternion();\n    const matrix = new Matrix4();\n    let onGround = false;\n\n    const clock = new Clock();\n    useFrame(({ camera }) => {\n        const delta = clock.getDelta();\n        let speed = delta * 32.0;\n        if (controls.run) {\n            // Holding shift increases speed\n            speed *= 1.5;\n        }\n        motion.set(0,0,0);\n        if (controls.forward) {\n            motion.z -= speed;\n        }\n        if (controls.backward) {\n            motion.z += speed;\n        }\n        if (controls.left) {\n            motion.x -= speed;\n        }\n        if (controls.right) {\n            motion.x += speed;\n        }\n\n        camera.getWorldQuaternion(quat);\n        matrix.makeRotationY(quat.y);\n        motion.applyMatrix4(matrix);\n        velocity.add(motion);\n        let nextPosition = camera.position.clone();\n        nextPosition.add(velocity);\n        if (onGround) {\n            velocity.x *= 0.95;\n            velocity.z *= 0.95;\n        } else {\n            // Less friction in air\n            velocity.x *= 0.97;\n            velocity.z *= 0.97;\n            // Gravity\n            velocity.y -= delta * 3;\n        }\n        let x = nextPosition.x;\n        let y = nextPosition.y;\n        let z = nextPosition.z;\n        /* Constrain position to terrain bounds\n        if (x < 0 || x >= terrain.width - 1) {\n            x = this.position.x;\n        }\n        if (z < 0 || z >= terrain.height - 1) {\n            z = this.position.z;\n        }*/\n        camera.position.x = x;\n        camera.position.z = z;\n        let ground = 7 + getHeightAt(x, z);\n        if (onGround || y <= ground) {\n            y = ground;\n            velocity.y = 0;\n            onGround = true;\n        }\n        camera.position.y = y;\n    })\n\n    return null; // No object for player, since we're using the camera\n}\n","import React from 'react'\n\nimport { Stats, OrbitControls, PointerLockControls } from '@react-three/drei'\nimport { Canvas, useThree } from '@react-three/fiber'\n\nimport { loadArea } from '../legacy/hunt'\n\nimport './Home.css'\nimport Player from '../Player'\n\ninterface Props {\n    setLoading: (isLoading: boolean) => void;\n}\n\nfunction Terrain({ setLoading }: Props) {\n    const { scene } = useThree();\n\n    function getHeightAt(x: number, z: number): number {\n        return 1500;\n    }\n\n    console.log('Terrain')\n    React.useEffect(() => {\n        console.time(\"loadArea\");\n        loadArea(\"AREA1\").then(world => {\n            console.timeEnd(\"loadArea\");\n            if (world) {\n                scene.add(world)\n            }\n            setLoading(false);\n        })\n    }, [setLoading, scene])\n    return <Player getHeightAt={getHeightAt} />;\n}\n\nexport default function Home() {\n    const [ isLoading, setLoading ] = React.useState(true);\n\n    return (\n        <>\n            {isLoading && (<div className=\"center\"><p>Loading, please wait</p></div>)}\n            <Canvas\n                shadows\n                linear\n                camera={{\n                    position: [ 0, 12000, 12000 ],\n                    fov: 30,\n                    near: 1,\n                    far: 1000000,\n                }}\n            >\n                <Stats />\n                <directionalLight\n                    args={[0xdfebff, 1]}\n                    position={[50, 200, 100]}\n                    shadow-mapSize-width={1024}\n                    shadow-mapSize-height={1024}\n                    shadow-camera-left={-300}\n                    shadow-camera-right={300}\n                    shadow-camera-top={300}\n                    shadow-camera-bottom={-300}\n                    shadow-camera-far={1000}\n                    castShadow\n                />\n                <ambientLight\n                    args={[0x666666]}\n                />\n\n                <PointerLockControls />\n\n                <Terrain setLoading={setLoading} />\n            </Canvas>\n        </>\n    )\n}\n","//https://medium.com/@pdx.lucasm/canvas-with-react-js-32e133c05258\nimport React from 'react';\n\ninterface CanvasProps {\n    width?: number;\n    height?: number;\n    drawContent?: (context: CanvasRenderingContext2D) => void;\n}\n\nconst Canvas: React.FC<CanvasProps> = ({drawContent, width, height, ...props}) => {\n    const canvasRef = React.useRef<HTMLCanvasElement>(null)\n\n    React.useEffect(() => {\n        const canvas = canvasRef.current\n        const context = canvas?.getContext('2d')\n        if (canvas && context) {\n            if (width !== undefined) {\n                context.canvas.width = width;\n            }\n            if (height !== undefined) {\n                context.canvas.height = height;\n            }\n            if (drawContent) {\n                drawContent(context);\n            } else {\n                context.fillStyle = '#000000'\n                context.fillRect(0, 0, context.canvas.width, context.canvas.height)\n            }\n        }\n    }, [drawContent, height, width])\n\n\n    return (\n        <canvas\n            ref={canvasRef}\n            {...props}\n        />\n    );\n}\n\nexport default Canvas;\n","import React from 'react'\n\nimport KaitaiStream from 'kaitai-struct/KaitaiStream';\nimport MAP from '../kaitai/carnivores_map';\nimport Canvas from '../components/Canvas';\n\nconst generateHeightmap = (map: any, field: string) => {\n    let imageData = new ImageData(map.mapSize, map.mapSize);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        imageData.data[i*4+0] = map[field][i];\n        imageData.data[i*4+1] = map[field][i];\n        imageData.data[i*4+2] = map[field][i];\n        imageData.data[i*4+3] = 0xff;\n    }\n    return imageData;\n}\n\nconst generateFlagsMap = (map: any, r: number, g: number, b: number) => {\n    let imageData = new ImageData(map.mapSize, map.mapSize);\n    const bitToColorChannel = (flags: number, bit: number) => ((flags & (1 << bit)) !== 0 ? 0 : 255);\n    for (let i = 0; i < map.mapSize * map.mapSize; i++) {\n        let val = map.flagsMap[i];\n        imageData.data[i*4+0] = r !== -1 ? bitToColorChannel(val, r) : 0;\n        imageData.data[i*4+1] = g !== -1 ? bitToColorChannel(val, g) : 0;\n        imageData.data[i*4+2] = b !== -1 ? bitToColorChannel(val, b) : 0;\n        imageData.data[i*4+3] = 0xff;\n    }\n    return imageData;\n}\n\ninterface BitSelectProps {\n    bitCount: number;\n    value: number;\n    onChange: (bit: number) => void;\n}\n\nconst BitSelect: React.FC<BitSelectProps> = ({\n    value = 0,\n    bitCount = 8,\n    onChange,\n}) => {\n    return (\n        <select value={value} onChange={event => onChange(parseFloat(event.target.value))}>\n            <option value=\"-1\">n/a</option>\n            {new Array(bitCount).fill(0).map((_,i) => (\n                <option key={i} value={i}>bit {i}</option>\n            ))}\n        </select>\n    )\n}\n\nexport default function MapEditor() {\n    const [ map, setMap ] = React.useState<any>(null);\n    const [ mapName, setMapName ] = React.useState<string|null>(null);\n    const [ bitR, setBitR ] = React.useState(-1);\n    const [ bitG, setBitG ] = React.useState(-1);\n    const [ bitB, setBitB ] = React.useState(-1);\n    const [ mode, setMode ] = React.useState(1);\n\n    function dragOver(ev: React.DragEvent) {\n        ev.preventDefault();\n    } \n\n    function drop(ev: React.DragEvent) {\n        ev.preventDefault();\n        if (ev.dataTransfer.files?.length) {\n            const mapName = ev.dataTransfer.files[0].name;\n            const url = URL.createObjectURL(ev.dataTransfer.files[0]);\n            // fetch URL (retrieves local file, no physical network involved)\n            fetch(url).then(body => body.arrayBuffer()).then(buf => {\n                // Create KaitaiStream and load map\n                const map = new MAP(new KaitaiStream(buf));\n                setMapName(mapName);\n                setMap(map);\n            });\n        }\n    }\n\n    const getImageData = () => {\n        let imageData: ImageData | undefined;\n\n        switch(mode) {\n            case 0: // Flags\n                imageData = generateFlagsMap(map, bitR, bitG, bitB);\n                break;\n\n            case 1: // Heightmap\n                imageData = generateHeightmap(map, 'heightMap');\n                break;\n\n            case 2: // Watertmap\n                imageData = generateHeightmap(map, 'waterMap');\n                break;\n        }\n\n        return imageData;\n    }\n\n    const drawMapContent = (ctx: CanvasRenderingContext2D) => {\n        const imageData = getImageData();\n        if (imageData) {\n            ctx.putImageData(imageData, 0, 0);\n        }\n    }\n\n    const downloadImageData = () => {\n        const imageData = getImageData();\n        if (imageData) {\n            var canvas = document.createElement('canvas');\n            var ctx = canvas.getContext(\"2d\");\n            if (ctx) {\n                ctx.canvas.width = imageData.width;\n                ctx.canvas.height = imageData.height;\n                ctx.putImageData(imageData, 0, 0);\n                var dataImage = canvas.toDataURL(\"image/png\");\n\n                let name: string = mapName?.replace(/\\.MAP$/i, '') || '';\n                switch(mode) {\n                    case 0:\n                        name += `-r${bitR}g${bitG}b${bitB}.png`;\n                        break;\n                    case 1: \n                        name += '-height.png';\n                        break;\n                    case 2: \n                        name += '-water.png';\n                        break;\n                }\n\n                const link = document.createElement('a');\n                link.setAttribute('download', name);\n                link.setAttribute('href', dataImage.replace(\"image/png\", \"image/octet-stream\"));\n                link.click();\n            }\n        }\n    }\n\n    return (\n        <div onDragOver={dragOver} onDrop={drop} style={{width: '100%', height: '100%', margin: '5px', userSelect: 'text'}}>\n            {map && mapName ? (\n                <>\n                    <h1>{mapName}</h1>\n                    <select value={mode} onChange={ev => setMode(parseInt(ev.target.value))}>\n                        <option value=\"0\">Flags</option>\n                        <option value=\"1\">Heightmap</option>\n                        <option value=\"2\">Watermap</option>\n                    </select>\n                    {\n                        mode === 0 && (\n                            <>\n                                <BitSelect value={bitR} bitCount={16} onChange={bit => setBitR(bit)} />\n                                <BitSelect value={bitG} bitCount={16} onChange={bit => setBitG(bit)} />\n                                <BitSelect value={bitB} bitCount={16} onChange={bit => setBitB(bit)} />      \n                            </>\n                        )\n                    }\n                    <button\n                        onClick={downloadImageData}\n                        >\n                            Download\n                    </button>\n                    <br/>\n                    <br/>\n                    <Canvas\n                        width={map.mapSize}\n                        height={map.mapSize}\n                        drawContent={drawMapContent}\n                    />\n                </>\n            ) : (\n                <h1>Drop a Carnivores 1/2/IceAge MAP file here</h1>\n            )}\n        </div>\n    )\n}","import React from 'react'\n\nexport default function ModelEditor() {\n    return (\n        <div />\n    )\n}","import React from 'react'\n\nimport {\n  HashRouter as Router,\n  Switch,\n  Route,\n} from 'react-router-dom';\n\nimport Home from './pages/Home';\nimport MapEditor from './pages/MapEditor';\nimport ModelEditor from './pages/ModelEditor';\n\nexport default function App() {\n  return (\n    <Router>\n      <Switch>\n        <Route exact path=\"/\">\n          <Home />\n        </Route>\n        <Route path=\"/edit-map\">\n          <MapEditor />\n        </Route>\n        <Route path=\"/edit-model\">\n          <ModelEditor />\n        </Route>\n      </Switch>\n    </Router>\n  )\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\n/* eslint-disable */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.Carnivores1Map = factory(root.KaitaiStream);\n  }\n}(this, function (KaitaiStream) {\nvar Carnivores1Map = (function() {\n  function Carnivores1Map(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  Carnivores1Map.prototype._read = function() {\n    this.heightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.textureMap1 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.textureMap1[i] = this._io.readU1();\n        break;\n      case false:\n        this.textureMap1[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.textureMap2 = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.textureMap2[i] = this._io.readU1();\n        break;\n      case false:\n        this.textureMap2[i] = this._io.readU2le();\n        break;\n      }\n    }\n    this.objectMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.flagsMap = new Array((this.mapSize * this.mapSize));\n    for (var i = 0; i < (this.mapSize * this.mapSize); i++) {\n      switch (this.isV1) {\n      case true:\n        this.flagsMap[i] = this._io.readU1();\n        break;\n      case false:\n        this.flagsMap[i] = this._io.readU2le();\n        break;\n      }\n    }\n    if (this.isV1) {\n      this.lightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.dawnLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.dayLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    if (this.isV2) {\n      this.nightLightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    }\n    this.waterMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.objectHeightMap = this._io.readBytes((this.mapSize * this.mapSize));\n    this.fogsMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n    this.ambientMap = this._io.readBytes(Math.floor((this.mapSize * this.mapSize) / 4));\n  }\n  Object.defineProperty(Carnivores1Map.prototype, 'isV1', {\n    get: function() {\n      if (this._m_isV1 !== undefined)\n        return this._m_isV1;\n      this._m_isV1 = this._io.size == 2228224;\n      return this._m_isV1;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'isV2', {\n    get: function() {\n      if (this._m_isV2 !== undefined)\n        return this._m_isV2;\n      this._m_isV2 = this._io.size == 14155776;\n      return this._m_isV2;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'isValid', {\n    get: function() {\n      if (this._m_isValid !== undefined)\n        return this._m_isValid;\n      this._m_isValid =  ((this.isV1) || (this.isV2)) ;\n      return this._m_isValid;\n    }\n  });\n  Object.defineProperty(Carnivores1Map.prototype, 'mapSize', {\n    get: function() {\n      if (this._m_mapSize !== undefined)\n        return this._m_mapSize;\n      this._m_mapSize = (this.isV1 ? 512 : 1024);\n      return this._m_mapSize;\n    }\n  });\n\n  /**\n   * Terrain heightmap, for water tiles it specifies the water surface height\n   */\n\n  /**\n   * Terrain texture map, every byte specifies a texture index for the terrain\n   */\n\n  /**\n   * Object placement map, every byte specifies an object (< 254), a spawn location (254), or no model (255)\n   */\n\n  /**\n   * Flags map, specifies render flags per tile. This includes rotation of terrain texture, of object, and more.\n   */\n\n  /**\n   * Light map, specifies lighting of placed objects\n   */\n\n  /**\n   * Water heightmap, specifies \"sea floor\" terrain heights\n   */\n\n  /**\n   * Object heightmap, height placement of objects (flags map can specify to align to sea floor level or terrain ground level too)\n   */\n\n  /**\n   * Fog map, which areas are covered in fog in game.\n   */\n\n  /**\n   * Ambient sounds map\n   */\n\n  return Carnivores1Map;\n})();\nreturn Carnivores1Map;\n}));\n","// This is a generated file! Please edit source .ksy file and use kaitai-struct-compiler to rebuild\n/* eslint-disable */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['kaitai-struct/KaitaiStream'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('kaitai-struct/KaitaiStream'));\n  } else {\n    root.CarnivoresRsc = factory(root.KaitaiStream);\n  }\n}(this, function (KaitaiStream) {\nvar CarnivoresRsc = (function() {\n  function CarnivoresRsc(_io, _parent, _root) {\n    this._io = _io;\n    this._parent = _parent;\n    this._root = _root || this;\n\n    this._read();\n  }\n  CarnivoresRsc.prototype._read = function() {\n    this.textureCount = this._io.readU4le();\n    this.modelCount = this._io.readU4le();\n    this.skyRgb = new Rgb(this._io, this, this._root);\n    this.skyTRgb = new Rgb(this._io, this, this._root);\n    this.textures = new Array(this.textureCount);\n    for (var i = 0; i < this.textureCount; i++) {\n      this.textures[i] = new Texture(this._io, this, this._root);\n    }\n    this.models = new Array(this.modelCount);\n    for (var i = 0; i < this.modelCount; i++) {\n      this.models[i] = new Model(this._io, this, this._root);\n    }\n    this.skyTexture = new Array(Math.floor(this.skyTextureSize / 2));\n    for (var i = 0; i < Math.floor(this.skyTextureSize / 2); i++) {\n      this.skyTexture[i] = this._io.readU2le();\n    }\n    this.skyMap = this._io.readBytes((128 * 128));\n    this.fogCount = this._io.readU4le();\n    this.fogList = new Array(this.fogCount);\n    for (var i = 0; i < this.fogCount; i++) {\n      this.fogList[i] = new FogEntry(this._io, this, this._root);\n    }\n    this.randomSoundCount = this._io.readU4le();\n    this.randomSounds = new Array(this.randomSoundCount);\n    for (var i = 0; i < this.randomSoundCount; i++) {\n      this.randomSounds[i] = new RandomSound(this._io, this, this._root);\n    }\n    this.ambientSoundCount = this._io.readU4le();\n    this.ambientSounds = new Array(this.ambientSoundCount);\n    for (var i = 0; i < this.ambientSoundCount; i++) {\n      this.ambientSounds[i] = new AmbientSound(this._io, this, this._root);\n    }\n  }\n\n  var Rgb = CarnivoresRsc.Rgb = (function() {\n    function Rgb(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Rgb.prototype._read = function() {\n      this.r = this._io.readU4le();\n      this.g = this._io.readU4le();\n      this.b = this._io.readU4le();\n    }\n\n    return Rgb;\n  })();\n\n  var Vertex = CarnivoresRsc.Vertex = (function() {\n    function Vertex(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Vertex.prototype._read = function() {\n      this.x = this._io.readF4le();\n      this.y = this._io.readF4le();\n      this.z = this._io.readF4le();\n      this.owner = this._io.readS2le();\n      this.hide = this._io.readU2le();\n    }\n\n    return Vertex;\n  })();\n\n  var Model = CarnivoresRsc.Model = (function() {\n    function Model(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Model.prototype._read = function() {\n      this.modelInfo = new ModelInfo(this._io, this, this._root);\n      this.vertCount = this._io.readU4le();\n      this.faceCount = this._io.readU4le();\n      this.nodeCount = this._io.readU4le();\n      this.textureSize = this._io.readU4le();\n      this.faces = new Array(this.faceCount);\n      for (var i = 0; i < this.faceCount; i++) {\n        this.faces[i] = new Face(this._io, this, this._root);\n      }\n      this.vertices = new Array(this.vertCount);\n      for (var i = 0; i < this.vertCount; i++) {\n        this.vertices[i] = new Vertex(this._io, this, this._root);\n      }\n      this.nodes = new Array(this.nodeCount);\n      for (var i = 0; i < this.nodeCount; i++) {\n        this.nodes[i] = new Node(this._io, this, this._root);\n      }\n      this.textureData = new Array(Math.floor(this.textureSize / 2));\n      for (var i = 0; i < Math.floor(this.textureSize / 2); i++) {\n        this.textureData[i] = this._io.readU2le();\n      }\n      if (this.modelInfo.isAnimated) {\n        this.animation = new ModelAnimation(this._io, this, this._root);\n      }\n    }\n\n    return Model;\n  })();\n\n  var Trd = CarnivoresRsc.Trd = (function() {\n    function Trd(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Trd.prototype._read = function() {\n      this.rNumber = this._io.readU4le();\n      this.rVolume = this._io.readU4le();\n      this.rFrequency = this._io.readU4le();\n      this.rEnvironment = this._io.readU4le();\n    }\n\n    return Trd;\n  })();\n\n  var ModelInfo = CarnivoresRsc.ModelInfo = (function() {\n    function ModelInfo(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    ModelInfo.prototype._read = function() {\n      this.radius = this._io.readS4le();\n      this.yLo = this._io.readS4le();\n      this.yHi = this._io.readS4le();\n      this.lineLength = this._io.readS4le();\n      this.lIntensity = this._io.readS4le();\n      this.circleRad = this._io.readS4le();\n      this.cIntensity = this._io.readS4le();\n      this.flags = this._io.readU4le();\n      this.grRad = this._io.readS4le();\n      this.refLight = this._io.readS4le();\n      this.lastAniTime = this._io.readU4le();\n      this.boundR = this._io.readF4le();\n      this.reserved = this._io.readBytes(16);\n    }\n    Object.defineProperty(ModelInfo.prototype, 'isAnimated', {\n      get: function() {\n        if (this._m_isAnimated !== undefined)\n          return this._m_isAnimated;\n        this._m_isAnimated = (this.flags & 2147483648) != 0;\n        return this._m_isAnimated;\n      }\n    });\n    Object.defineProperty(ModelInfo.prototype, 'notLighted', {\n      get: function() {\n        if (this._m_notLighted !== undefined)\n          return this._m_notLighted;\n        this._m_notLighted = (this.flags & 64) != 0;\n        return this._m_notLighted;\n      }\n    });\n    Object.defineProperty(ModelInfo.prototype, 'needsBound', {\n      get: function() {\n        if (this._m_needsBound !== undefined)\n          return this._m_needsBound;\n        this._m_needsBound = (this.flags & 16) != 0;\n        return this._m_needsBound;\n      }\n    });\n\n    return ModelInfo;\n  })();\n\n  var ModelAnimation = CarnivoresRsc.ModelAnimation = (function() {\n    function ModelAnimation(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    ModelAnimation.prototype._read = function() {\n      this.vc0 = this._io.readU4le();\n      this.vc1 = this._io.readU4le();\n      this.vc2 = this._io.readU4le();\n      this.kps = this._io.readU4le();\n      this.frameCount = this._io.readU4le();\n      this.frames = new Array(((this.frameCount * 3) * this.vc1));\n      for (var i = 0; i < ((this.frameCount * 3) * this.vc1); i++) {\n        this.frames[i] = this._io.readS2le();\n      }\n    }\n\n    return ModelAnimation;\n  })();\n\n  var Face = CarnivoresRsc.Face = (function() {\n    function Face(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Face.prototype._read = function() {\n      this.v1 = this._io.readU4le();\n      this.v2 = this._io.readU4le();\n      this.v3 = this._io.readU4le();\n      this.tax = this._io.readS4le();\n      this.tbx = this._io.readS4le();\n      this.tcx = this._io.readS4le();\n      this.tay = this._io.readS4le();\n      this.tby = this._io.readS4le();\n      this.tcy = this._io.readS4le();\n      this.flags = this._io.readU2le();\n      this.dMask = this._io.readU2le();\n      this.distant = this._io.readS4le();\n      this.next = this._io.readU4le();\n      this.group = this._io.readU4le();\n      this.reserved = this._io.readBytes(12);\n    }\n\n    return Face;\n  })();\n\n  var FogEntry = CarnivoresRsc.FogEntry = (function() {\n    function FogEntry(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    FogEntry.prototype._read = function() {\n      this.fogRgb = this._io.readU4le();\n      this.yBegin = this._io.readF4le();\n      this.mortal = this._io.readU4le();\n      this.transp = this._io.readF4le();\n      this.fLimit = this._io.readF4le();\n    }\n\n    return FogEntry;\n  })();\n\n  var AmbientSound = CarnivoresRsc.AmbientSound = (function() {\n    function AmbientSound(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    AmbientSound.prototype._read = function() {\n      this.pcmSize = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmSize);\n      this.rData = new Array(16);\n      for (var i = 0; i < 16; i++) {\n        this.rData[i] = new Trd(this._io, this, this._root);\n      }\n      this.rsfxCount = this._io.readU4le();\n      this.aVolume = this._io.readU4le();\n    }\n\n    return AmbientSound;\n  })();\n\n  var Node = CarnivoresRsc.Node = (function() {\n    function Node(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Node.prototype._read = function() {\n      this.name = KaitaiStream.bytesToStr(KaitaiStream.bytesTerminate(this._io.readBytes(32), 0, false), \"utf8\");\n      this.x = this._io.readF4le();\n      this.y = this._io.readF4le();\n      this.z = this._io.readF4le();\n      this.owner = this._io.readS2le();\n      this.hide = this._io.readU2le();\n    }\n\n    return Node;\n  })();\n\n  var RandomSound = CarnivoresRsc.RandomSound = (function() {\n    function RandomSound(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    RandomSound.prototype._read = function() {\n      this.pcmSize = this._io.readU4le();\n      this.pcm = this._io.readBytes(this.pcmSize);\n    }\n\n    return RandomSound;\n  })();\n\n  var Texture = CarnivoresRsc.Texture = (function() {\n    function Texture(_io, _parent, _root) {\n      this._io = _io;\n      this._parent = _parent;\n      this._root = _root || this;\n\n      this._read();\n    }\n    Texture.prototype._read = function() {\n      this.data = new Array(Math.floor(this.size / 2));\n      for (var i = 0; i < Math.floor(this.size / 2); i++) {\n        this.data[i] = this._io.readU2le();\n      }\n    }\n    Object.defineProperty(Texture.prototype, 'size', {\n      get: function() {\n        if (this._m_size !== undefined)\n          return this._m_size;\n        this._m_size = ((128 * 128) * 2);\n        return this._m_size;\n      }\n    });\n\n    return Texture;\n  })();\n  Object.defineProperty(CarnivoresRsc.prototype, 'skyTextureSize', {\n    get: function() {\n      if (this._m_skyTextureSize !== undefined)\n        return this._m_skyTextureSize;\n      this._m_skyTextureSize = ((256 * 256) * 2);\n      return this._m_skyTextureSize;\n    }\n  });\n\n  return CarnivoresRsc;\n})();\nreturn CarnivoresRsc;\n}));\n"],"sourceRoot":""}